# BBWS Admin Portal - High-Level Design

**Version**: 1.0
**Created**: 2025-12-14
**Status**: Draft
**Document Type**: High-Level Design (HLD)
**Application**: Admin Portal
**Phase**: 2 (Operations)

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-12-14 | Agentic Architect | Initial version |

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Application Overview](#2-application-overview)
3. [Bounded Contexts](#3-bounded-contexts)
4. [Screens](#4-screens)
5. [Microservices](#5-microservices)
6. [API Endpoints](#6-api-endpoints)
7. [Authentication](#7-authentication)
8. [DynamoDB Schema](#8-dynamodb-schema)
9. [Infrastructure](#9-infrastructure)
10. [Repositories](#10-repositories)
11. [Implementation Plan](#11-implementation-plan)
12. [LLDs Reference](#12-llds-reference)
13. [Appendices](#13-appendices)

---

## 1. Executive Summary

### 1.1 Purpose

The BBWS Admin Portal is the internal console for BBWS staff to manage all customers, support tickets, campaigns, and platform operations. It provides cross-tenant visibility and administrative capabilities.

### 1.2 Business Value

- **Operational Efficiency**: Single dashboard for all operations
- **SLA Management**: Monitor and enforce SLA compliance
- **Revenue Visibility**: Track subscriptions and revenue
- **Campaign Management**: Create and manage marketing campaigns
- **Support Operations**: Handle all customer tickets

### 1.3 Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Authentication | Cognito Admin Pool (Invite-only + MFA) | Separate from customers, enhanced security |
| Access Control | Role-based (super-admin, admin, support-agent) | Granular permissions |
| Cross-Tenant Access | Allowed | Staff need to view all customers |
| Audit Logging | S3 + Athena | Compliance, investigation |

---

## 2. Application Overview

### 2.1 Application Definition

| Attribute | Value |
|-----------|-------|
| **HLD File** | `BBWS_Admin_Portal_HLD.md` |
| **URL (PROD)** | `https://admin.kimmyai.io` |
| **URL (SIT)** | `https://sit.admin.kimmyai.io` |
| **URL (DEV)** | `https://dev.admin.kimmyai.io` |
| **API Base (PROD)** | `https://admin-api.kimmyai.io/v1.0` |
| **API Base (DEV)** | `https://dev.admin-api.kimmyai.io/v1.0` |
| **Authentication** | Cognito Admin Pool (JWT + MFA required) |
| **Target Users** | BBWS staff (support, sales, admins) |
| **Priority** | Phase 2 (Operations) |

### 2.2 Staff Roles

| Role | Description | Capabilities |
|------|-------------|--------------|
| `super-admin` | Platform administrators | Full access, user management |
| `admin` | Operations managers | Tenant/campaign management |
| `support-agent` | Support staff | Ticket handling, limited tenant view |

### 2.3 Scope

**In Scope:**
- Admin dashboard (metrics, KPIs)
- All tenants view (cross-tenant)
- All organisations view
- All sites view (health, status)
- Campaign management (create, offers, targets)
- Product management (pricing tiers, SLA)
- SLA breach dashboard
- Support ticket queue (all tickets)
- Ticket assignment & escalation
- SLA configuration
- User administration
- Audit logs
- Reports & analytics
- System health monitoring

**Out of Scope:**
- Customer self-service (Private Portal)
- Public marketing (Public Portal)

---

## 3. Bounded Contexts

### 3.1 Context Overview

The Admin Portal operates across all five bounded contexts:

```
┌─────────────────────────────────────────────────────────────────┐
│                    ADMIN PORTAL CONTEXTS                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  MARKETING CONTEXT                       │   │
│  │  Campaign → Offer → Target                               │   │
│  │  Full CRUD, analytics, distribution                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  TENANTS CONTEXT                         │   │
│  │  All orgs, tenants, sites (cross-tenant view)           │   │
│  │  Suspend, adjust plan, force actions                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  PRODUCTS CONTEXT                        │   │
│  │  Product definitions, SLA configuration                  │   │
│  │  Breach tracking, compensation                           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  ORDERS CONTEXT                          │   │
│  │  All subscriptions, revenue reports                      │   │
│  │  Manual adjustments, failed payments                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  SUPPORT CONTEXT                         │   │
│  │  Ticket queue, assignment, escalation                    │   │
│  │  SLA monitoring, compliance reports                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Screens

### 4.1 Screen Summary (37 Total)

| Category | Screens | Count |
|----------|---------|-------|
| Dashboard & Auth | AP-001 to AP-002 | 2 |
| Campaigns | AP-010 to AP-018 | 9 |
| Tenants | AP-020 to AP-023 | 4 |
| Organisations | AP-030 to AP-031 | 2 |
| Sites | AP-040 to AP-042 | 3 |
| Subscriptions | AP-050 to AP-053 | 4 |
| Support | AP-060 to AP-068 | 9 |
| Platform | AP-070 to AP-073 | 4 |
| **Total** | | **37** |

### 4.2 Screen List

#### Dashboard & Auth (2 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 1 | AP-001 | Admin Dashboard | Metrics, KPIs, alerts |
| 2 | AP-002 | Admin Login | MFA-required login |

#### Campaign Management (9 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 3 | AP-010 | Campaigns List | List all campaigns |
| 4 | AP-011 | Create Campaign | New campaign wizard |
| 5 | AP-012 | Campaign Details | View/edit campaign |
| 6 | AP-013 | Campaign Offers | List offers in campaign |
| 7 | AP-014 | Create Offer | Add promo offer |
| 8 | AP-015 | Offer Details | View/edit offer |
| 9 | AP-016 | Offer Targets | Distribution list |
| 10 | AP-017 | Add Target | Add email/SMS/social |
| 11 | AP-018 | Campaign Analytics | Performance charts |

#### Tenant Administration (4 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 12 | AP-020 | All Tenants | Cross-tenant list |
| 13 | AP-021 | Tenant Admin View | View tenant as admin |
| 14 | AP-022 | Suspend Tenant | Suspend confirmation |
| 15 | AP-023 | Adjust Plan | Override plan |

#### Organisation Administration (2 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 16 | AP-030 | All Organisations | List all orgs |
| 17 | AP-031 | Organisation Admin View | View org as admin |

#### Site Administration (3 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 18 | AP-040 | All Sites | List all sites |
| 19 | AP-041 | Site Admin View | View site as admin |
| 20 | AP-042 | Site Health Dashboard | Health monitoring |

#### Subscription Administration (4 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 21 | AP-050 | All Subscriptions | List all subscriptions |
| 22 | AP-051 | Subscription Admin View | View subscription |
| 23 | AP-052 | Failed Payments | Payment issues |
| 24 | AP-053 | Revenue Reports | Financial reports |

#### Support Administration (9 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 25 | AP-060 | All Tickets | Ticket queue |
| 26 | AP-061 | Ticket Admin View | View ticket |
| 27 | AP-062 | Add Follow-up | Agent response |
| 28 | AP-063 | Assign Ticket | Assign to agent |
| 29 | AP-064 | Escalate Ticket | Manual escalation |
| 30 | AP-065 | SLA Dashboard | Breach monitoring |
| 31 | AP-066 | SLA Configuration | Configure SLAs |
| 32 | AP-067 | Escalation Matrix | Escalation emails |
| 33 | AP-068 | Support Metrics | Team performance |

#### Platform Administration (4 screens)

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 34 | AP-070 | Admin Users | Manage admin users |
| 35 | AP-071 | Invite Admin | Invite admin user |
| 36 | AP-072 | Audit Logs | View audit trail |
| 37 | AP-073 | System Health | Platform health |

---

## 5. Microservices

### 5.1 Service Overview (11 Total)

| # | Service | Repo | API Prefix | Functions | Description |
|---|---------|------|------------|-----------|-------------|
| 1 | Admin Auth Service | `bbws-admin-svc-auth` | `/admin/auth/*` | 6 | Admin login, MFA, users |
| 2 | Admin Marketing Service | `bbws-admin-svc-marketing` | `/admin/campaigns/*` | 12 | Campaigns, offers, targets |
| 3 | Admin Organisation Service | `bbws-admin-svc-organisation` | `/admin/organisations/*` | 4 | All orgs |
| 4 | Admin Tenant Service | `bbws-admin-svc-tenant` | `/admin/tenants/*` | 6 | All tenants |
| 5 | Admin Site Service | `bbws-admin-svc-site` | `/admin/sites/*` | 5 | All sites |
| 6 | Admin Product Service | `bbws-admin-svc-product` | `/admin/products/*` | 12 | Products, SLA |
| 7 | Admin Billing Service | `bbws-admin-svc-billing` | `/admin/subscriptions/*` | 6 | All subscriptions |
| 8 | Admin Ticket Service | `bbws-admin-svc-ticket` | `/admin/tickets/*` | 11 | Ticket queue |
| 9 | Admin Audit Service | `bbws-admin-svc-audit` | `/admin/audit/*` | 3 | Audit logs |
| 10 | Admin System Service | `bbws-admin-svc-system` | `/admin/system/*` | 4 | Health, metrics |
| 11 | Admin SLA Service | `bbws-admin-svc-sla` | `/admin/sla/*` | 3 | SLA breaches |

### 5.2 Lambda Function Count

| Service | Functions | Total |
|---------|-----------|-------|
| Auth | login, me, list-users, invite, get-user, update-role | 6 |
| Marketing | list-campaigns, create, get, update, delete, list-offers, create-offer, update-offer, list-targets, add-target, send, analytics | 12 |
| Organisation | list, get, update, suspend | 4 |
| Tenant | list, search, get, update, suspend, adjust-plan | 6 |
| Site | list, search, get, health, force-action | 5 |
| Product | list, create, get, update, get-sla, update-sla, update-priority-sla, list-breaches, get-breach, acknowledge, resolve, compensate | 12 |
| Billing | list, search, get, adjust, revenue, failed-payments | 6 |
| Ticket | list, search, queue, metrics, get, update, assign, escalate, add-followup, breaches, sla-report | 11 |
| Audit | logs, get-log, reports | 3 |
| System | health, metrics, alerts, acknowledge-alert | 4 |
| SLA | breaches, search-breaches, compliance-report | 3 |
| **Total** | | **68** |

---

## 6. API Endpoints

### 6.1 API Structure

**Base URL (PROD)**: `https://admin-api.kimmyai.io/v1.0`
**Auth**: Cognito Admin Pool JWT + MFA (required)
**Prefix**: `/admin/`

### 6.2 Campaign Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/admin/campaigns` | List all campaigns |
| POST | `/admin/campaigns` | Create campaign |
| GET | `/admin/campaigns/{id}` | Get campaign |
| PUT | `/admin/campaigns/{id}` | Update campaign |
| DELETE | `/admin/campaigns/{id}` | Delete campaign |
| GET | `/admin/campaigns/{id}/offers` | List offers |
| POST | `/admin/campaigns/{id}/offers` | Create offer |
| PUT | `/admin/campaigns/{id}/offers/{id}` | Update offer |
| GET | `/admin/campaigns/{id}/offers/{id}/targets` | List targets |
| POST | `/admin/campaigns/{id}/offers/{id}/targets` | Add target |
| POST | `/admin/campaigns/{id}/offers/{id}/targets/send` | Send to all |
| GET | `/admin/campaigns/{id}/analytics` | Analytics |

### 6.3 Tenant Endpoints (Cross-Tenant)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/admin/tenants` | List all tenants |
| GET | `/admin/tenants/search` | Search tenants |
| GET | `/admin/tenants/{id}` | Get tenant |
| PUT | `/admin/tenants/{id}` | Update tenant |
| POST | `/admin/tenants/{id}/suspend` | Suspend tenant |
| POST | `/admin/tenants/{id}/adjust-plan` | Override plan |

### 6.4 Ticket Endpoints (All Tickets)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/admin/tickets` | List all tickets |
| GET | `/admin/tickets/search` | Search tickets |
| GET | `/admin/tickets/queue` | Support queue |
| GET | `/admin/tickets/metrics` | Support metrics |
| GET | `/admin/tickets/{id}` | Get ticket |
| PUT | `/admin/tickets/{id}` | Update ticket |
| PUT | `/admin/tickets/{id}/assign` | Assign to agent |
| POST | `/admin/tickets/{id}/escalate` | Escalate |
| POST | `/admin/tickets/{id}/followups` | Add follow-up |

### 6.5 SLA Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/admin/sla/breaches` | All SLA breaches |
| GET | `/admin/sla/breaches/search` | Search breaches |
| GET | `/admin/sla/reports` | Compliance report |
| GET | `/admin/products/{id}/sla` | Get SLA config |
| PUT | `/admin/products/{id}/sla` | Update SLA config |
| POST | `/admin/products/{id}/sla/breaches/{id}/acknowledge` | Acknowledge |
| POST | `/admin/products/{id}/sla/breaches/{id}/resolve` | Resolve |
| POST | `/admin/products/{id}/sla/breaches/{id}/compensate` | Compensate |

---

## 7. Authentication

### 7.1 Admin Cognito Pool

| Attribute | Value |
|-----------|-------|
| Pool Name | `bbws-admin-pool-{env}` |
| Sign-in | Email only |
| MFA | **Required** (TOTP) |
| Self-Registration | **Disabled** (invite-only) |
| Password Policy | Min 12, upper, lower, number, special |

### 7.2 MFA Requirement

All admin users must:
1. Be invited by existing super-admin
2. Set up TOTP MFA on first login
3. Provide MFA code on every login

---

## 8. DynamoDB Schema

### 8.1 Admin-Specific Entities

| Entity | PK | SK |
|--------|----|----|
| AdminUser | `ADMIN#{user_id}` | `METADATA` |
| Campaign | `CAMPAIGN#{campaign_id}` | `METADATA` |
| Offer | `CAMPAIGN#{campaign_id}` | `OFFER#{offer_id}` |
| Target | `OFFER#{offer_id}` | `TARGET#{target_id}` |
| SLABreach | `BREACH#{breach_id}` | `METADATA` |

### 8.2 Cross-Tenant GSIs

| GSI Name | Purpose |
|----------|---------|
| AllTenantsIndex | List all tenants |
| AllOrgsIndex | List all organisations |
| AllTicketsIndex | List all tickets |
| AllSitesIndex | List all sites |
| BreachStatusIndex | List open breaches |

---

## 9. Infrastructure

### 9.1 AWS Services

| Service | Purpose |
|---------|---------|
| S3 | SPA hosting, audit logs |
| CloudFront | CDN |
| API Gateway | REST API |
| Lambda | Backend services |
| DynamoDB | Database |
| Cognito | Admin authentication |
| SES | Notifications |
| Athena | Audit log queries |

### 9.2 Cron Jobs (3 Total)

| # | Job | Schedule | Description |
|---|-----|----------|-------------|
| 1 | SLA Checker | rate(15 min) | SLA breach detection |
| 2 | Payment Retry | rate(6 hours) | Retry failed payments |
| 3 | Tenant Suspension | Daily | Suspend for non-payment |

---

## 10. Repositories

### 10.1 Repository List (16 Total)

| # | Repo | Type | Description |
|---|------|------|-------------|
| 1 | `bbws-admin-portal` | Frontend | React SPA |
| 2 | `bbws-admin-svc-auth` | Backend | Auth service |
| 3 | `bbws-admin-svc-marketing` | Backend | Marketing service |
| 4 | `bbws-admin-svc-organisation` | Backend | Organisation service |
| 5 | `bbws-admin-svc-tenant` | Backend | Tenant service |
| 6 | `bbws-admin-svc-site` | Backend | Site service |
| 7 | `bbws-admin-svc-product` | Backend | Product service |
| 8 | `bbws-admin-svc-billing` | Backend | Billing service |
| 9 | `bbws-admin-svc-ticket` | Backend | Ticket service |
| 10 | `bbws-admin-svc-audit` | Backend | Audit service |
| 11 | `bbws-admin-svc-system` | Backend | System service |
| 12 | `bbws-admin-svc-sla` | Backend | SLA service |
| 13 | `bbws-admin-cron-sla` | Cron | SLA checker |
| 14 | `bbws-admin-cron-payment-retry` | Cron | Payment retry |
| 15 | `bbws-admin-cron-tenant-suspend` | Cron | Tenant suspension |
| 16 | `bbws-admin-terraform` | Infra | Infrastructure |

---

## 11. Implementation Plan

### 11.1 Phase 2 Milestones

| # | Milestone | Deliverables |
|---|-----------|--------------|
| 2.1 | Infrastructure | API Gateway, Lambda, Cognito |
| 2.2 | Admin Auth | Login, MFA, user management |
| 2.3 | Marketing Service | Campaigns, offers, targets |
| 2.4 | Admin Services | Tenant, site, billing services |
| 2.5 | Support Services | Ticket queue, SLA |
| 2.6 | Frontend Scaffold | React + admin routing |
| 2.7 | Dashboard | Admin dashboard |
| 2.8 | Campaign Screens | 9 screens |
| 2.9 | Admin Screens | Tenant, org, site screens |
| 2.10 | Support Screens | 9 screens |
| 2.11 | Platform Screens | Users, audit, health |
| 2.12 | Testing & QA | E2E, security audit |

---

## 12. LLDs Reference

### 12.1 Technical LLDs (13 Documents)

| # | LLD Name | Description |
|---|----------|-------------|
| 1 | AP_Frontend_Architecture_LLD.md | React SPA, admin routes |
| 2 | AP_Auth_Service_LLD.md | Admin auth, MFA |
| 3 | AP_Marketing_Service_LLD.md | Campaign management |
| 4 | AP_Organisation_Service_LLD.md | Cross-tenant orgs |
| 5 | AP_Tenant_Service_LLD.md | All tenants |
| 6 | AP_Site_Service_LLD.md | All sites |
| 7 | AP_Product_Service_LLD.md | Products, SLA |
| 8 | AP_Billing_Service_LLD.md | All subscriptions |
| 9 | AP_Ticket_Service_LLD.md | Ticket queue |
| 10 | AP_Audit_Service_LLD.md | Audit logging |
| 11 | AP_System_Service_LLD.md | Health, metrics |
| 12 | AP_SLA_Service_LLD.md | SLA breaches |
| 13 | AP_Cognito_Admin_Pool_LLD.md | Admin Cognito |

### 12.2 Operational Manuals (10 Documents)

| # | Manual Name | Description |
|---|-------------|-------------|
| 14 | AP_Ops_Deployment_Runbook.md | Deployment procedures |
| 15 | AP_Ops_Monitoring_Runbook.md | Admin dashboards |
| 16 | AP_Ops_Incident_Response_Runbook.md | Incident response |
| 17 | AP_Ops_SLA_Breach_Runbook.md | SLA handling |
| 18 | AP_Ops_Tenant_Suspension_Runbook.md | Suspension procedures |
| 19 | AP_Ops_Campaign_Management_Runbook.md | Campaign issues |
| 20 | AP_Ops_Revenue_Reporting_Runbook.md | Revenue reports |
| 21 | AP_Ops_Audit_Log_Query_Runbook.md | Athena queries |
| 22 | AP_Ops_Admin_User_Management_Runbook.md | Admin users |
| 23 | AP_Ops_Escalation_Matrix_Runbook.md | Escalation config |

---

## 13. Appendices

### Appendix A: User Stories

| Story ID | User Story | Priority |
|----------|------------|----------|
| US-AP-001 | As an admin, I want to view the dashboard | P0 |
| US-AP-002 | As an admin, I want to view all tenants | P0 |
| US-AP-003 | As an admin, I want to manage campaigns | P0 |
| US-AP-004 | As an admin, I want to handle support tickets | P0 |
| US-AP-005 | As an admin, I want to monitor SLA breaches | P0 |
| US-AP-006 | As an admin, I want to view revenue reports | P1 |
| US-AP-007 | As an admin, I want to suspend tenants | P1 |
| US-AP-008 | As an admin, I want to query audit logs | P1 |
| US-AP-009 | As an admin, I want to manage admin users | P1 |
| US-AP-010 | As an admin, I want to configure SLAs | P2 |

### Appendix B: SLA Configuration

| Tier | Priority | First Response | Resolution | Escalate After |
|------|----------|----------------|------------|----------------|
| Free | Low | 48h | 5 days | 72h |
| Free | Critical | 4h | 1 day | 8h |
| Pro | Low | 24h | 3 days | 48h |
| Pro | Critical | 1h | 4h | 2h |
| Enterprise | Low | 12h | 2 days | 24h |
| Enterprise | Critical | 15m | 1h | 30m |

### Appendix C: Escalation Matrix

| Level | Email | Trigger |
|-------|-------|---------|
| L1 | support-level1@bigbeard.co.za | Initial assignment |
| Management | support-management@bigbeard.co.za | SLA breach |
| Executive | support-exec@bigbeard.co.za | Management SLA breach (24h) |

---

## Related Documents

- [BBWS Customer Portal Public HLD](./BBWS_Customer_Portal_Public_HLD.md)
- [BBWS Customer Portal Private HLD](./BBWS_Customer_Portal_Private_HLD.md)
- [Master Plan](/.claude/plans/twinkling-mapping-hamster.md)

---

**End of Document**
