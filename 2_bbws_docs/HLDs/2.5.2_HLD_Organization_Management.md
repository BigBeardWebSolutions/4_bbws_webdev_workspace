# HLD 2.5.2: Organization Management

## High-Level Design Document

**Version**: 1.0
**Author**: Platform Architecture Team
**Date**: 2026-02-17
**Status**: Draft

---

## Document History

| Version | Date | Changes | Owner |
|---------|------|---------|-------|
| 1.0 | 2026-02-17 | Initial HLD for Organization Management domain | Platform Architecture |

---

## 1. Executive Summary

### Purpose

This document provides the architectural design for the Organization Management capability of the BBWS platform. It describes how the platform manages organisational hierarchies (Division > Group > Team) within tenant contexts, providing the structural foundation for user assignments and resource allocation.

### Scope

This HLD defines the architectural boundaries and design for:
- Three-level organisational hierarchy (Division > Group > Team)
- Hierarchy validation and depth constraint enforcement
- Hierarchy-to-tenant mapping and tenant-scoped operations
- Organisation unit metadata management
- Event-driven integration with Tenant and User Management

> **Note:** Tenant lifecycle and context is covered by [HLD 2.5: Tenant Management](../../2_bbws_tenant_management/docs/hld/2.5_HLD_Tenant_Management.md). User profiles are covered by [HLD 2.5.1: User Management](../../2_bbws_user_management/docs/hld/2.5.1_HLD_User_Management.md). For detailed API specifications, see `docs/openapi/`. For implementation details, see `docs/lld/`.

### Relationship to Other Documents

| Document | Relationship |
|----------|--------------|
| **BRS 2.5.2** | Business requirements this architecture implements |
| **LLD 2.5.2** | Detailed implementation specifications |
| **HLD 2.5** | Tenant Management - provides tenant context for all hierarchy operations |
| **HLD 2.5.1** | User Management - user profiles assigned to org units |
| **HLD 2.7** | Instance Management - org context for resource allocation |

---

## 2. Architecture Overview

### 2.1 Design Philosophy

| Principle | Implementation |
|-----------|----------------|
| **Tenant-Scoped Hierarchy** | All org units exist within a tenant boundary |
| **Three-Level Depth** | Division > Group > Team (fixed depth, simple model) |
| **Referential Integrity** | Parent must exist before child can be created |
| **Serverless First** | Lambda + API Gateway + DynamoDB |
| **Event-Driven Updates** | SQS events for cross-service synchronisation |

### 2.2 High-Level Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         BBWS Platform                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌───────────────────────────────────────────────────────────────────────┐ │
│   │                   Organization Management Service                      │ │
│   │                                                                        │ │
│   │   ┌──────────────┐  ┌──────────────┐  ┌──────────────┐               │ │
│   │   │  Division    │  │    Group     │  │    Team      │               │ │
│   │   │  Service     │  │   Service    │  │   Service    │               │ │
│   │   └──────┬───────┘  └──────┬───────┘  └──────┬───────┘               │ │
│   │          │                 │                  │                       │ │
│   │          └─────────────────┼──────────────────┘                       │ │
│   │                            │                                          │ │
│   │                   ┌────────▼────────┐                                 │ │
│   │                   │   Hierarchy     │                                 │ │
│   │                   │   Validator     │                                 │ │
│   │                   └────────┬────────┘                                 │ │
│   │                            │                                          │ │
│   └────────────────────────────┼──────────────────────────────────────────┘ │
│                                │                                             │
│                       ┌────────▼────────────────────┐                       │
│                       │       DynamoDB Table        │                       │
│                       │   (Single Table Design)     │                       │
│                       └─────────────────────────────┘                       │
│                                │                                             │
│                                │ Events                                      │
│                                ▼                                             │
│                       ┌─────────────────────────────┐                       │
│                       │       SQS Queues            │                       │
│                       │  HIERARCHY_CREATED/UPDATED  │                       │
│                       │  HIERARCHY_DELETED          │                       │
│                       └─────────────────────────────┘                       │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. System Context

### 3.1 Context Diagram

```
                              ┌─────────────────┐
                              │    Platform     │
                              │  Admin/Operator │
                              └────────┬────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│                     BBWS Organization Management                          │
│                                                                           │
│   ┌────────────┐   ┌────────────┐   ┌────────────┐   ┌────────────┐     │
│   │  Division  │   │   Group    │   │    Team    │   │ Hierarchy  │     │
│   │  Service   │   │  Service   │   │  Service   │   │ Validator  │     │
│   └────────────┘   └────────────┘   └────────────┘   └────────────┘     │
│                                                                           │
└───────────────────────────────────┬───────────────────────────────────────┘
                                    │
            ┌───────────────────────┼───────────────────────┐
            │                       │                       │
            ▼                       ▼                       ▼
    ┌───────────────┐      ┌───────────────┐      ┌───────────────┐
    │    Tenant     │      │     User      │      │   Instance    │
    │  Management   │      │  Management   │      │  Management   │
    │   (HLD 2.5)   │      │  (HLD 2.5.1)  │      │   (HLD 2.7)   │
    └───────────────┘      └───────────────┘      └───────────────┘
```

### 3.2 Integration Points

| System | Direction | Purpose |
|--------|-----------|---------|
| **Tenant Management (2.5)** | Inbound | Provides tenant context; hierarchy scoped within tenant |
| **User Management (2.5.1)** | Both | Users assigned to org units; user directory filtered by org |
| **Instance Management (2.7)** | Outbound | Org context for resource allocation decisions |
| **DynamoDB Streams** | Outbound | Audit events and cross-service notifications |

---

## 4. Component Architecture

### 4.1 Division Service

**Responsibility**: Manage top-level business units within a tenant.

| Operation | Description | Validation |
|-----------|-------------|------------|
| Create | New division under tenant | Tenant must be ACTIVE; name unique within tenant |
| Read | Get division by ID | Tenant scope enforced |
| Update | Modify division metadata | Tenant scope enforced |
| Delete | Soft delete division | No active child groups |
| List | List divisions for tenant | Paginated, tenant-scoped |

### 4.2 Group Service

**Responsibility**: Manage departments or functions within a division.

| Operation | Description | Validation |
|-----------|-------------|------------|
| Create | New group under division | Parent division must exist and be active |
| Read | Get group by ID | Tenant scope enforced |
| Update | Modify group metadata | Tenant scope enforced |
| Delete | Soft delete group | No active child teams |
| List | List groups for division | Paginated, division-scoped |

### 4.3 Team Service

**Responsibility**: Manage working teams within a group.

| Operation | Description | Validation |
|-----------|-------------|------------|
| Create | New team under group | Parent group must exist and be active |
| Read | Get team by ID | Tenant scope enforced |
| Update | Modify team metadata | Tenant scope enforced |
| Delete | Soft delete team | No active user assignments |
| List | List teams for group | Paginated, group-scoped |

### 4.4 Hierarchy Validator

**Responsibility**: Enforce structural integrity of the organisational hierarchy.

| Rule | Enforcement |
|------|-------------|
| Three-level max depth | Division > Group > Team only |
| Parent existence | Child cannot be created without valid parent |
| Cascade soft delete | Deleting a division soft-deletes child groups and teams |
| Uniqueness | Name unique within parent scope |
| Tenant isolation | All operations scoped to requesting tenant |

---

## 5. Hierarchy Model

```
┌─────────────────────────────────────────────────────┐
│                    TENANT                              │
│                                                        │
│   ┌──────────────┐   ┌──────────────┐                │
│   │  Division A  │   │  Division B  │                │
│   └──────┬───────┘   └──────┬───────┘                │
│          │                  │                          │
│   ┌──────┴──────┐    ┌─────┴──────┐                  │
│   │             │    │            │                   │
│   ▼             ▼    ▼            ▼                   │
│ ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐         │
│ │Group A1│ │Group A2│ │Group B1│ │Group B2│         │
│ └───┬────┘ └───┬────┘ └───┬────┘ └────────┘         │
│     │          │          │                           │
│  ┌──┴──┐   ┌──┴──┐   ┌──┴──┐                        │
│  │     │   │     │   │     │                         │
│  ▼     ▼   ▼     ▼   ▼     ▼                         │
│ ┌────┐┌────┐┌────┐┌────┐┌────┐┌────┐                │
│ │T-A1││T-A2││T-A3││T-A4││T-B1││T-B2│                │
│ └────┘└────┘└────┘└────┘└────┘└────┘                │
│                                                        │
└────────────────────────────────────────────────────────┘
```

---

## 6. Security Architecture

### 6.1 Authentication & Authorization

| Component | Mechanism |
|-----------|-----------|
| API Authentication | Cognito JWT tokens |
| Authorization | Role-based (Admin, Operator, Viewer) |
| Tenant Scoping | JWT claims include tenantId; all queries scoped |
| Service-to-Service | IAM roles for Lambda-to-SQS |

### 6.2 Tenant Isolation

| Layer | Mechanism |
|-------|-----------|
| API | JWT claims enforce tenant scope on every request |
| Data | DynamoDB partition key includes tenant ID |
| Queries | All GSI queries include tenant ID prefix |
| Audit | All operations logged with tenant and user context |

### 6.3 Access Control

| Operation | Required Role |
|-----------|---------------|
| View hierarchy | Any tenant member (Viewer+) |
| Create/update org units | Admin, Operator |
| Delete org units | Admin only |
| Manage team assignments | Admin, Operator |

---

## 7. Technology Decisions

### 7.1 Technology Stack

| Component | Technology | Rationale |
|-----------|------------|-----------|
| API Layer | API Gateway + Lambda | Serverless, auto-scaling |
| Data Store | DynamoDB | Serverless, fast, hierarchical key patterns |
| Async Messaging | SQS | Reliable, serverless queuing |
| Identity | Cognito JWT claims | Tenant context from token |

### 7.2 Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Data Model | Single Table Design | Hierarchical access patterns map well to PK/SK |
| Hierarchy Depth | Fixed 3 levels | Simple, predictable, covers most org structures |
| Delete Strategy | Soft delete with cascade | Preserve audit trail, prevent orphans |
| Hierarchy Events | SQS | Notify downstream services of structural changes |

---

## 8. Non-Functional Requirements

### 8.1 Performance

| Metric | Target | Rationale |
|--------|--------|-----------|
| Hierarchy Read | < 100ms P95 | Frequent lookups by other services |
| Hierarchy Write | < 200ms P95 | Admin operations |
| Full Tree Query | < 500ms P95 | Dashboard rendering |

### 8.2 Availability

| Metric | Target |
|--------|--------|
| API Availability | 99.9% |
| Data Durability | 99.999999999% (DynamoDB) |

### 8.3 Scalability

| Dimension | Target | Approach |
|-----------|--------|----------|
| Divisions per Tenant | 100 | DynamoDB partition design |
| Groups per Division | 100 | Efficient SK patterns |
| Teams per Group | 100 | Efficient SK patterns |
| Total Org Units | 1,000,000+ across platform | DynamoDB auto-scaling |

---

## 9. Constraints

| Constraint | Impact | Mitigation |
|------------|--------|------------|
| DynamoDB Item Size | 400KB limit | Metadata kept small; large docs in S3 |
| Hierarchy Depth | Fixed at 3 levels | Covers Division > Group > Team |
| Cascade Deletes | May be slow for large subtrees | Async processing via SQS |

---

## 10. Platform Services

| Service | HLD | Repo | Description |
|---------|-----|------|-------------|
| Tenant Management | 2.5 | `2_bbws_tenant_management` | Tenant lifecycle and metadata |
| User Management | 2.5.1 | `2_bbws_user_management` | User profiles, directory, roles |
| Organization Management | 2.5.2 | `2_bbws_organization_management` | Org hierarchy (Division > Group > Team) |
| Site Management | 2.6 | `2_bbws_site_management` | WordPress site lifecycle |
| Instance Management | 2.7 | `2_bbws_instance_management` | Environment provisioning |
| Auth Management | 2.1.2 | `2_bbws_auth_management` | Registration, login, sessions |

---

## 11. Related Repositories

| Repository | Purpose |
|------------|---------|
| `2_bbws_tenant_management` | Tenant lifecycle service |
| `2_bbws_user_management` | User profile and role service |
| `2_bbws_organization_management` | Organization hierarchy service |
| `2_bbws_site_management` | WordPress site management service |
| `2_bbws_instance_management` | Environment provisioning service |
| `2_bbws_auth_management` | Authentication service |
| `2_bbws_ecs_terraform` | Shared ECS infrastructure as code |
| `2_bbws_ecs_operations` | Dashboards, alerts, runbooks |
| `2_bbws_wordpress_container` | WordPress Docker image |
| `2_bbws_agents` | AI agents and utilities |
| `2_bbws_docs` | Central documentation |

---

## 12. References

| Document | Path |
|----------|------|
| BRS 2.5.2: Organization Management | `docs/brs/2.5.2_BRS_Organization_Management.md` |
| LLD 2.5.2: Organization Management | `docs/lld/2.5.2_LLD_Organization_Management.md` |
| HLD 2.5: Tenant Management | `HLDs/2.5_HLD_Tenant_Management.md` |
| HLD 2.5.1: User Management | `HLDs/2.5.1_HLD_User_Management.md` |
| HLD 2.7: Instance Management | `HLDs/2.7_HLD_WordPress_Instance_Management.md` |
| Organization API OpenAPI Spec | `docs/openapi/organization_api_openapi.yaml` |

---

**End of Document**
