# BBWS Customer Portal (Private) - High-Level Design

**Version**: 2.2
**Created**: 2025-12-14
**Last Updated**: 2026-01-20
**Status**: Draft
**Document Type**: High-Level Design (HLD)
**Application**: Customer Portal (Private)
**Phase**: 1 (Core Functionality)
**BRS Alignment**: BRS 2.2 v2.6 (10 Epics, 65 User Stories, 48 Business Rules)

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2025-12-14 | Agentic Architect | Initial version |
| 1.1 | 2026-01-05 | Agentic Architect | Added authentication workflow components (moved from Public HLD) |
| 2.0 | 2026-01-20 | HLD Architect Agent | Major update: Aligned with BRS v2.6 - 10 Epics, 65 User Stories; Added Epic-to-Component mapping; Updated Organisation-Tenant-Site hierarchy; Added Email Verification & Password Recovery flows; Enhanced DynamoDB schema with 48 business rules support; Added DR architecture (af-south-1 primary, eu-west-1 failover); Updated API endpoints for all Epics |
| 2.1 | 2026-01-20 | HLD Architect Agent | Added UX/UI Design Reference section (Section 14) with screen routes and design principles; Updated Related Documents to include UX documentation; Aligned screen inventory with BRS Section 14 |
| 2.2 | 2026-01-20 | HLD Architect Agent | Updated Section 13 (LLDs Reference) with correct naming convention `{BRS}.{Seq}_LLD_{Name}.md`; Added repository mapping; Identified existing vs TO CREATE LLDs; Added shared infrastructure LLDs; Added LLD creation priority matrix |

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Application Overview](#2-application-overview)
3. [Epic-to-Component Mapping](#3-epic-to-component-mapping)
4. [Bounded Contexts](#4-bounded-contexts)
5. [Screens](#5-screens)
6. [Microservices](#6-microservices)
7. [API Endpoints](#7-api-endpoints)
8. [Authentication](#8-authentication)
9. [DynamoDB Schema](#9-dynamodb-schema)
10. [Infrastructure](#10-infrastructure)
11. [Repositories](#11-repositories)
12. [Implementation Plan](#12-implementation-plan)
13. [LLDs Reference](#13-llds-reference)
14. [UX/UI Design Reference](#14-uxui-design-reference)
15. [Appendices](#15-appendices)

---

## 1. Executive Summary

### 1.1 Purpose

The BBWS Customer Portal (Private) is the authenticated customer dashboard where customers manage their WordPress sites, subscriptions, billing, and support tickets. This is the core product experience for paying customers. This HLD implements the requirements from **BRS 2.2 v2.6** which defines 10 Epics and 65 User Stories.

### 1.2 Business Value

- **Self-Service Management**: Customers manage sites without support intervention (target: 80% self-service rate)
- **Rapid Site Provisioning**: Site creation reduced from 3-5 days to under 30 minutes
- **Subscription Revenue**: Handle billing, upgrades, and renewals via PayFast
- **Reduced Support Load**: Self-service reduces support tickets by 60%
- **Customer Retention**: Easy site management improves retention (reduce churn by 25%)
- **Multi-Tenant Support**: Organisation hierarchy supports agencies with multiple client tenants

### 1.3 BRS Alignment Summary

| Metric | BRS Reference |
|--------|---------------|
| Total Epics | 10 (BRS Section 2) |
| Total User Stories | 65 (BRS Section 2) |
| Total Business Rules | 48 (BRS Section 6) |
| Total Screens | 45 (BRS Appendix A) |
| Phase 1 Epics | 1-9 (Q1 2026) |
| Phase 2 Epics | 10 - White-Label (Q2 2026) |

### 1.4 Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Frontend Framework | React 18 + TypeScript + Vite | Modern, performant, type-safe |
| Authentication | Cognito Customer Pool (JWT) | Shared pool with Public Portal, MFA support |
| API Gateway | AWS API Gateway + Lambda Authorizer | JWT validation, tenant isolation, POPIA compliance |
| Database | DynamoDB (Single Table Design) | Serverless, scalable, on-demand capacity |
| Primary Region | af-south-1 (Cape Town) | Data residency, POPIA compliance |
| DR Region | eu-west-1 (Ireland) | Multi-site active/active DR |
| Payments | PayFast.io | South African payment gateway |
| Email | AWS SES | Email verification, notifications |

---

## 2. Application Overview

### 2.1 Application Definition

| Attribute | Value |
|-----------|-------|
| **HLD File** | `BBWS_Customer_Portal_Private_HLD.md` |
| **URL (PROD)** | `https://portal.kimmyai.io` |
| **URL (SIT)** | `https://sit.portal.kimmyai.io` |
| **URL (DEV)** | `https://dev.portal.kimmyai.io` |
| **API Base (PROD)** | `https://portal-api.kimmyai.io/v1.0` |
| **API Base (DEV)** | `https://dev.portal-api.kimmyai.io/v1.0` |
| **Authentication** | Cognito Customer Pool (JWT required) |
| **Target Users** | Authenticated customers |
| **Priority** | Phase 1 (Core functionality) |

### 2.2 Scope

**In Scope:**
- Customer dashboard
- Organisation management
- Tenant management
- Site management (WordPress sites)
- DNS-only sites
- WordPress migrations
- Environment promotion (DEV → SIT → PROD)
- Backup management
- Subscription & billing
- Invoice history
- Support tickets (create, view, reply)
- User management (invite, roles)
- Account settings
- MFA setup

**Out of Scope:**
- Public marketing pages (Public Portal)
- Admin/staff functionality (Admin Portal)
- Cross-tenant operations (Admin Portal)

---

## 3. Epic-to-Component Mapping

This section maps each BRS Epic to its implementing architectural components.

### 3.1 Epic Summary Table

| Epic | Name | User Stories | Phase | Primary Service | Screens |
|------|------|--------------|-------|-----------------|---------|
| 1 | User Registration & Email Verification | 10 (US 1.1-1.10) | 1 | Auth Public Service | CPP-006, CPP-010 |
| 2 | Invitation Response | 4 (US 2.1-2.4) | 1 | Invitation Service | CPP-011 |
| 3 | Customer Authentication & Password Recovery | 11 (US 3.1-3.11) | 1 | Portal Auth Service | CPP-007, CPP-008, CPP-009, CP-002, CP-003 |
| 4 | Dashboard & Account Management | 3 (US 4.1-4.3) | 1 | Portal Auth Service | CP-001, CP-002, CP-003 |
| 5 | Organisation & User Management | 8 (US 5.1-5.8) | 1 | Portal Organisation Service | CP-010 to CP-014 |
| 6 | Tenant Management | 5 (US 6.1-6.5) | 1 | Portal Tenant Service | CP-020 to CP-024 |
| 7 | Site Management | 13 (US 7.1-7.13) | 1 | Portal Site Service, Portal Migration Service | CP-030 to CP-055 |
| 8 | Billing & Subscriptions | 6 (US 8.1-8.6) | 1 | Portal Billing Service, Payment Service | CP-060 to CP-066 |
| 9 | Support Tickets | 4 (US 9.1-9.4) | 1 | Portal Ticket Service | CP-070 to CP-074 |
| 10 | White-Label & Marketplace | 4 (US 10.1-10.4) | 2 | Partner Service (future) | TBD |
| | **Total** | **65** | | | **45** |

### 3.2 Epic-to-Service Component Matrix

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    EPIC-TO-SERVICE MAPPING                                   │
├──────────────────┬──────────────────────────────────────────────────────────┤
│                  │                    SERVICES                               │
│   EPIC           │ Auth  │ Org   │ Tenant │ Site  │ Billing │ Ticket │ Inv  │
├──────────────────┼───────┼───────┼────────┼───────┼─────────┼────────┼──────┤
│ 1. Registration  │ ████  │       │   █    │       │         │        │      │
│ 2. Invitation    │       │   █   │   █    │       │         │        │ ████ │
│ 3. Authentication│ ████  │       │        │       │         │        │      │
│ 4. Dashboard     │  ██   │   █   │   █    │  █    │    █    │   █    │      │
│ 5. Organisation  │       │ ████  │   █    │       │         │        │  █   │
│ 6. Tenant        │       │   █   │ ████   │       │         │        │      │
│ 7. Sites         │       │       │   █    │ ████  │         │        │      │
│ 8. Billing       │       │       │   █    │       │  ████   │        │      │
│ 9. Support       │       │       │   █    │       │         │ ████   │      │
│ 10. White-Label  │       │   █   │   █    │       │    █    │        │      │
└──────────────────┴───────┴───────┴────────┴───────┴─────────┴────────┴──────┘
Legend: ████ = Primary Service, █ = Supporting Service
```

### 3.3 Epic-to-DynamoDB Entity Mapping

| Epic | Primary Entities | GSIs Used |
|------|------------------|-----------|
| 1 | User, Organisation, Tenant | UserEmailIndex |
| 2 | Invitation, OrgUser, TenantUser | InvitationTokenIndex, UserEmailIndex |
| 3 | User | UserEmailIndex |
| 4 | User, Tenant, Site, Subscription, Ticket | - |
| 5 | Organisation, OrgUser | UserOrgIndex, OrgTenantsIndex |
| 6 | Tenant, TenantUser | TenantStatusIndex, OrgTenantsIndex |
| 7 | Site, Backup, Migration, DNS-Site | SiteStatusIndex, TenantSitesIndex |
| 8 | Subscription, Order, Payment, Invoice | TenantOrdersIndex |
| 9 | Ticket, FollowUp | TicketStatusIndex |
| 10 | Partner, PartnerCustomer | PartnerCustomersIndex |

### 3.4 Epic-to-Business Rules Mapping

| Epic | Business Rules | Key Rules |
|------|----------------|-----------|
| 1 | BR-001 to BR-013 | Email verification within 24hrs, password requirements, T&C acceptance |
| 2 | BR-034 to BR-038 | 7-day expiry, single-use tokens, decline notifications |
| 3 | BR-001 to BR-023 | Login rate limiting, MFA enforcement, session management |
| 4 | BR-019 to BR-026 | Session timeouts, tenant isolation |
| 5 | BR-039 to BR-048 | Organisation hierarchy, user-tenant assignment |
| 6 | BR-039 to BR-048 | Tenant creation, user switching |
| 7 | BR-027 to BR-030 | Environment promotion order, backup limits |
| 8 | BR-031 to BR-033 | Super-admin billing access, downgrade timing |
| 9 | - | Ticket status management |
| 10 | - | White-label configuration (Phase 2) |

---

## 4. Bounded Contexts

### 4.1 System Context Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         SYSTEM CONTEXT DIAGRAM                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ┌──────────────┐          ┌──────────────────────────────────────┐       │
│    │   Customer   │◄────────►│     BBWS Customer Portal (Private)   │       │
│    │   (Browser)  │   HTTPS  │                                      │       │
│    └──────────────┘          │  ┌────────────────────────────────┐  │       │
│                              │  │     React SPA (S3+CloudFront)  │  │       │
│                              │  └────────────────────────────────┘  │       │
│                              │                  │                   │       │
│                              │                  ▼                   │       │
│                              │  ┌────────────────────────────────┐  │       │
│                              │  │  API Gateway + Lambda Services │  │       │
│                              │  └────────────────────────────────┘  │       │
│                              └──────────────┬───────────────────────┘       │
│                                             │                               │
│         ┌───────────────────────────────────┼───────────────────────────┐   │
│         │                                   │                           │   │
│         ▼                                   ▼                           ▼   │
│  ┌──────────────┐                 ┌──────────────┐              ┌──────────┐│
│  │    Cognito   │                 │   DynamoDB   │              │   SES    ││
│  │ (Customer    │                 │  (Data Store)│              │  (Email) ││
│  │    Pool)     │                 │              │              │          ││
│  └──────────────┘                 └──────────────┘              └──────────┘│
│         │                                   │                               │
│         │                         ┌─────────┴─────────┐                     │
│         │                         │                   │                     │
│         ▼                         ▼                   ▼                     │
│  ┌──────────────┐         ┌──────────────┐    ┌──────────────┐              │
│  │ Public Portal│         │   PayFast    │    │  ECS/Fargate │              │
│  │ (Shared Auth)│         │  (Payments)  │    │  (WordPress) │              │
│  └──────────────┘         └──────────────┘    └──────────────┘              │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘

External Systems:
┌─────────────────────────────────────────────────────────────────────────────┐
│ System              │ Integration    │ Purpose                              │
├─────────────────────┼────────────────┼──────────────────────────────────────┤
│ AWS Cognito         │ SDK            │ Authentication, JWT tokens           │
│ PayFast             │ REST API       │ Payment processing, webhooks         │
│ AWS SES             │ SDK            │ Email notifications, verification    │
│ AWS ECS/Fargate     │ Internal API   │ WordPress site provisioning          │
│ AWS Route 53        │ SDK            │ DNS management                       │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 Bounded Context Overview

The Private Portal operates within four bounded contexts:

```
┌─────────────────────────────────────────────────────────────────┐
│                    BOUNDED CONTEXTS                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  IDENTITY CONTEXT (Epics 1-3)            │   │
│  │  User → Registration → Email Verification                │   │
│  │  Login → Password Recovery → MFA → Session               │   │
│  │  Invitation → Accept/Decline                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  TENANTS CONTEXT (Epics 4-7)             │   │
│  │  Organisation → Tenant → Site → User                     │   │
│  │  Migration, DNS-Site, Environment, Backup                │   │
│  │  Dashboard, Account Settings                             │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  ORDERS CONTEXT (Epic 8)                 │   │
│  │  Subscription → Order → Payment → Invoice                │   │
│  │  PayFast integration, billing cycles                     │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  SUPPORT CONTEXT (Epic 9)                │   │
│  │  Ticket → FollowUp (customer view only)                  │   │
│  │  Create, view, reply to own tickets                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 Entity Relationships

> **Note**: The hierarchy model is **Organisation -> Tenant(s) -> Sites**. Users belong to an Organisation and are assigned to specific Tenants. This model is ideal for agencies managing multiple client tenants. (BRS BR-039 to BR-048)

```
┌─────────────────────────────────────────────────────────────────┐
│                    ENTITY HIERARCHY                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  User (Cognito)                                                 │
│       │                                                         │
│       └── belongs to Organisation (required since v2.6)         │
│               │                                                 │
│               ├── OrgUser (super-admin, admin, user, viewer)   │
│               │       └── assigned to Tenants                   │
│               │                                                 │
│               ├── Invitation (pending org/tenant invites)       │
│               │                                                 │
│               └── Tenant(s) - one or more per organisation     │
│                       │                                         │
│                       ├── TenantUser (role assignment)          │
│                       ├── Site (WordPress)                      │
│                       │       ├── Environment (DEV, SIT, PROD) │
│                       │       └── Backup                        │
│                       ├── DNS-Site                              │
│                       ├── Migration                             │
│                       ├── Subscription                          │
│                       │       ├── Order                         │
│                       │       │       ├── Payment               │
│                       │       │       └── Invoice               │
│                       │       └── Invoice                       │
│                       └── Ticket                                │
│                               └── FollowUp                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 4.3 User Registration Creates Organisation + Tenant

Per BRS BR-039: Registration creates an Organisation and first Tenant automatically.

```
┌─────────────────────────────────────────────────────────────────┐
│                 REGISTRATION FLOW (Epic 1)                       │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   1. User submits registration form (US 1.1)                    │
│      ↓                                                          │
│   2. Cognito creates user account                               │
│      ↓                                                          │
│   3. System creates Organisation (user becomes org admin)       │
│      ↓                                                          │
│   4. System creates first Tenant under Organisation             │
│      ↓                                                          │
│   5. User assigned as super-admin of Tenant                     │
│      ↓                                                          │
│   6. Email verification sent (US 1.5)                           │
│      ↓                                                          │
│   7. User verifies email (US 1.6)                               │
│      ↓                                                          │
│   8. Tenant status: UNVALIDATED → REGISTERED                    │
│      ↓                                                          │
│   9. User completes payment (US 1.9)                            │
│      ↓                                                          │
│  10. Tenant status: REGISTERED → ACTIVE                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 5. Screens

### 5.1 Screen Summary (51 Total including Authentication)

> **Note**: Screens are organised by Epic alignment. Authentication screens (CPP-*) are shared with Public Portal but lead to Private Portal access.

| Category | Screens | Count | Epic |
|----------|---------|-------|------|
| Registration & Email Verification | CPP-006, CPP-010, CPP-012, CPP-013 | 4 | Epic 1 |
| Invitation Response | CPP-011 | 1 | Epic 2 |
| Authentication & Password Recovery | CPP-007 to CPP-009 | 3 | Epic 3 |
| Dashboard & Account | CP-001 to CP-003 | 3 | Epic 4 |
| Organisation | CP-010 to CP-014 | 5 | Epic 5 |
| Tenant | CP-020 to CP-024 | 5 | Epic 6 |
| Sites | CP-030 to CP-039 | 10 | Epic 7 |
| DNS Sites | CP-040 to CP-043 | 4 | Epic 7 |
| Migrations | CP-050 to CP-055 | 6 | Epic 7 |
| Billing | CP-060 to CP-066 | 7 | Epic 8 |
| Support | CP-070 to CP-074 | 5 | Epic 9 |
| **Total** | | **53** | |

### 5.2 Screen List

#### Registration & Email Verification (Epic 1) - 4 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 1 | CPP-006 | Register | Customer registration form | US 1.1-1.4 |
| 2 | CPP-010 | Verify Email | Email verification from link | US 1.6 |
| 3 | CPP-012 | Resend Verification | Request new verification email | US 1.7 |
| 4 | CPP-013 | Welcome/Onboarding | Welcome message and guided tour | US 1.8, 1.10 |

#### Invitation Response (Epic 2) - 1 screen

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 5 | CPP-011 | Accept Invitation | View and respond to org/tenant invite | US 2.1-2.4 |

#### Authentication & Password Recovery (Epic 3) - 3 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 6 | CPP-007 | Login | Login form with MFA support | US 3.1-3.3 |
| 7 | CPP-008 | Forgot Password | Password reset request | US 3.4-3.5 |
| 8 | CPP-009 | Reset Password | Set new password with code | US 3.6-3.7 |

#### Dashboard & Account (Epic 4) - 3 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 9 | CP-001 | Dashboard | Customer home, summary widgets | US 4.1 |
| 10 | CP-002 | Account Settings | Profile management | US 4.2, US 3.8-3.9 |
| 11 | CP-003 | MFA Setup | Enable/disable 2FA | US 4.3, US 3.10 |

#### Organisation Management (Epic 5) - 5 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 12 | CP-010 | My Organisations | List user's organisations | US 5.1 |
| 13 | CP-011 | Organisation Details | View/edit organisation | US 5.2 |
| 14 | CP-012 | Organisation Tenants | List tenants in org | US 5.1 |
| 15 | CP-013 | Organisation Users | Manage org users, assign roles | US 5.4, 5.5, 5.6, 5.7, 5.8 |
| 16 | CP-014 | Invite Org User | Send invitation | US 5.3 |

#### Tenant Management (Epic 6) - 5 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 17 | CP-020 | My Tenants | List user's tenants, tenant switcher | US 6.1, 6.5 |
| 18 | CP-021 | Tenant Details | View/edit tenant | US 6.3 |
| 19 | CP-022 | Tenant Users | Manage tenant users | US 6.4 |
| 20 | CP-023 | Invite Tenant User | Send invitation | US 5.3 |
| 21 | CP-024 | Tenant Subscription | View subscription | US 8.1 |

#### Site Management (Epic 7) - 10 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 22 | CP-030 | Sites List | List WordPress sites | US 7.1 |
| 23 | CP-031 | Create Site | Provision new site | US 7.1 |
| 24 | CP-032 | Site Details | View site info | US 7.2 |
| 25 | CP-033 | Site Settings | Configure site | US 7.2 |
| 26 | CP-034 | Site Environments | Manage DEV/SIT/PROD | US 7.3 |
| 27 | CP-035 | Promote Environment | Confirm promotion | US 7.4 |
| 28 | CP-036 | Site Backups | List/restore backups | US 7.5 |
| 29 | CP-037 | Create Backup | Manual backup | US 7.5 |
| 30 | CP-038 | Restore Backup | Confirm restore | US 7.6 |
| 31 | CP-039 | Launch Site | Remove Basic Auth | US 7.7 |

#### DNS Sites (Epic 7) - 4 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 32 | CP-040 | DNS Sites List | List DNS-only sites | US 7.11 |
| 33 | CP-041 | Create DNS Site | Add DNS-only domain | US 7.11 |
| 34 | CP-042 | DNS Site Details | View DNS site | US 7.13 |
| 35 | CP-043 | DNS Records | Manage DNS records | US 7.12 |

#### Migrations (Epic 7) - 6 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 36 | CP-050 | Migrations List | List migrations | US 7.8 |
| 37 | CP-051 | Start Migration | Begin wizard | US 7.8 |
| 38 | CP-052 | Migration Mode A | Full access import | US 7.9 |
| 39 | CP-053 | Migration Mode B | Scrape & rebuild | US 7.10 |
| 40 | CP-054 | Migration Progress | View status | US 7.8 |
| 41 | CP-055 | Migration Complete | Summary | US 7.8 |

#### Billing (Epic 8) - 7 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 42 | CP-060 | Subscription | View subscription | US 8.1 |
| 43 | CP-061 | Change Plan | Upgrade/downgrade | US 8.2, 8.3 |
| 44 | CP-062 | Payment History | List orders/payments | US 8.4 |
| 45 | CP-063 | Invoice Details | View invoice | US 8.5 |
| 46 | CP-064 | Checkout | PayFast payment | US 8.6 |
| 47 | CP-065 | Payment Success | Confirmation | US 8.6 |
| 48 | CP-066 | Payment Failed | Retry options | US 8.6 |

#### Support (Epic 9) - 5 screens

| # | Screen ID | Screen Name | Description | User Stories |
|---|-----------|-------------|-------------|--------------|
| 49 | CP-070 | My Tickets | List support tickets | US 9.1 |
| 50 | CP-071 | Create Ticket | Submit new ticket | US 9.2 |
| 51 | CP-072 | Ticket Details | View ticket thread | US 9.3 |
| 52 | CP-073 | Ticket Follow-ups | List follow-ups | US 9.3 |
| 53 | CP-074 | Reply to Ticket | Add follow-up | US 9.4 |

---

## 6. Microservices

### 6.1 Service Overview (16 Total)

| # | Service | Repo | API Prefix | Functions | Description |
|---|---------|------|------------|-----------|-------------|
| 1 | Portal Auth Service | `2_2_bbws_portal_svc_auth` | `/portal/auth/*` | 10 | Profile, MFA, session, registration, login, password |
| 2 | Portal Organisation Service | `2_2_bbws_portal_svc_organisation` | `/portal/organisations/*` | 5 | Org CRUD, users |
| 3 | Portal Tenant Service | `2_2_bbws_portal_svc_tenant` | `/portal/tenants/*` | 6 | Tenant CRUD, users |
| 4 | Portal Site Service | `2_2_bbws_portal_svc_site` | `/portal/sites/*` | 12 | Sites, envs, backups |
| 5 | Portal Migration Service | `2_2_bbws_portal_svc_migration` | `/portal/migrations/*` | 6 | WP migrations |
| 6 | Portal Billing Service | `2_2_bbws_portal_svc_billing` | `/portal/subscriptions/*` | 7 | Billing, PayFast |
| 7 | Portal Ticket Service | `2_2_bbws_portal_svc_ticket` | `/portal/tickets/*` | 5 | Tickets, follow-ups |
| 8 | Portal Notification Service | `2_2_bbws_portal_svc_notification` | `/portal/notifications/*` | 2 | Notifications |
| 9 | Marketing Service | `2_2_bbws_marketing_lambda` | `/v1.0/campaigns/*` | 1 | Campaign details |
| 10 | Contact Service | `2_2_bbws_contact_lambda` | `/v1.0/contact` | 1 | Contact form (all types) |
| 11 | Invitation Service | `2_2_bbws_invitation_lambda` | `/v1.0/invitations/*` | 3 | Accept/decline invites |
| 12 | Cart Service | `2_2_bbws_cart_lambda` | `/v1.0/cart/*`, `/v1.0/tenants/*/cart` | 4 | Shopping cart |
| 13 | Payment Service | `2_2_bbws_payment_lambda` | `/v1.0/tenants/*/orders/*/payments/*` | 3 | Payment processing |
| 14 | Newsletter Service | `2_2_bbws_newsletter_lambda` | `/v1.0/newsletter` | 1 | Newsletter subscription |
| 15 | Auth Public Service | `2_2_bbws_auth_public_lambda` | `/v1.0/auth/*` | 5 | Public registration, login, password reset |

### 5.2 Lambda Function Count

| Service | Functions | Total |
|---------|-----------|-------|
| Portal Auth | me, update-profile, enable-mfa, verify-mfa, logout | 5 |
| Organisation | list, get, update, list-users, invite | 5 |
| Tenant | list, create, get, update, list-users, invite | 6 |
| Site | list, create, get, update, delete, launch, list-envs, promote, list-backups, create-backup, restore, health | 12 |
| Migration | list, create, get, import, scrape, logs | 6 |
| Billing | get-subscription, upgrade, downgrade, list-orders, get-order, list-invoices, download-pdf | 7 |
| Ticket | list, create, get, list-followups, add-followup | 5 |
| Notification | list, mark-read | 2 |
| Marketing | get-campaign | 1 |
| Contact | submit-contact | 1 |
| Invitation | get-invitation, accept-invitation, decline-invitation | 3 |
| Cart | get-cart, add-item, update-item, update-cart | 4 |
| Payment | initiate-payment, webhook, get-payment | 3 |
| Newsletter | subscribe | 1 |
| Auth Public | register, login, forgot-password, reset-password, verify-email | 5 |
| **Total** | | **66** |

---

## 7. API Endpoints

### 7.1 API Structure

**Base URL (PROD)**: `https://portal-api.kimmyai.io/v1.0`
**Base URL (SIT)**: `https://sit.portal-api.kimmyai.io/v1.0`
**Base URL (DEV)**: `https://dev.portal-api.kimmyai.io/v1.0`
**Auth**: Cognito Customer Pool JWT (required for `/portal/*` endpoints)
**Prefix**: `/portal/` (authenticated) and `/v1.0/` (public/mixed)

### 7.2 HATEOAS Resource Hierarchy

The API follows HATEOAS principles for resource navigation. Each resource response includes `_links` for related resources.

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         HATEOAS RESOURCE HIERARCHY                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  /portal/auth/me (User)                                                     │
│       │                                                                     │
│       └─── _links: { organisations, tenants, settings }                    │
│                                                                             │
│  /portal/organisations                                                       │
│       │                                                                     │
│       └─── /portal/organisations/{orgId}                                    │
│                │                                                            │
│                ├─── _links: { self, users, tenants }                       │
│                │                                                            │
│                ├─── /portal/organisations/{orgId}/users                     │
│                │        └─── _links: { self, invite }                      │
│                │                                                            │
│                └─── /portal/organisations/{orgId}/tenants                   │
│                                                                             │
│  /portal/tenants                                                             │
│       │                                                                     │
│       └─── /portal/tenants/{tenantId}                                       │
│                │                                                            │
│                ├─── _links: { self, users, sites, subscription, tickets }  │
│                │                                                            │
│                ├─── /portal/tenants/{tenantId}/sites                        │
│                │        │                                                   │
│                │        └─── /portal/tenants/{tenantId}/sites/{siteId}      │
│                │                │                                           │
│                │                ├─── _links: { self, environments, backups }│
│                │                │                                           │
│                │                ├─── .../environments                       │
│                │                │        └─── .../environments/{env}/promote│
│                │                │                                           │
│                │                └─── .../backups                            │
│                │                         └─── .../backups/{id}/restore      │
│                │                                                            │
│                ├─── /portal/tenants/{tenantId}/dns-sites                    │
│                │        └─── .../dns-sites/{id}/records                     │
│                │                                                            │
│                └─── /portal/tenants/{tenantId}/migrations                   │
│                                                                             │
│  /portal/subscription                                                        │
│       │                                                                     │
│       ├─── _links: { self, upgrade, downgrade, orders, invoices }          │
│       │                                                                     │
│       └─── /portal/subscription/orders                                      │
│                └─── /portal/subscription/orders/{id}/invoices               │
│                         └─── .../invoices/{id}/pdf                          │
│                                                                             │
│  /portal/tickets                                                             │
│       │                                                                     │
│       └─── /portal/tickets/{ticketId}                                       │
│                │                                                            │
│                ├─── _links: { self, followups }                            │
│                │                                                            │
│                └─── /portal/tickets/{ticketId}/followups                    │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 7.3 API Response Format

All API responses follow a consistent format with HATEOAS links:

```json
{
  "data": { ... },
  "meta": {
    "timestamp": "2026-01-20T12:00:00Z",
    "requestId": "uuid"
  },
  "_links": {
    "self": { "href": "/portal/tenants/123" },
    "sites": { "href": "/portal/tenants/123/sites" },
    "users": { "href": "/portal/tenants/123/users" }
  }
}
```

### 7.4 Portal Auth Endpoints (Authenticated)

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/portal/auth/me` | Get current user |
| PUT | `/portal/auth/me` | Update profile |
| POST | `/portal/auth/mfa/enable` | Enable MFA |
| POST | `/portal/auth/mfa/verify` | Verify MFA code |
| POST | `/portal/auth/logout` | Logout |

### 7.5 Public Auth Endpoints (No Auth Required)

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v1.0/auth/register` | Customer registration |
| POST | `/v1.0/auth/login` | Login (redirect to private portal) |
| POST | `/v1.0/auth/forgot-password` | Password reset request |
| POST | `/v1.0/auth/reset-password` | Set new password |
| POST | `/v1.0/auth/verify-email` | Email verification |

### 7.6 Marketing Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/v1.0/campaigns/{code}` | Get campaign details (includes status, validity) |

### 7.7 Contact Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v1.0/contact` | Submit contact form (all types: general, sales, support) |

### 7.8 Newsletter Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v1.0/newsletter` | Subscribe to newsletter |

### 7.9 Invitation Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/v1.0/invitations/{token}` | Get invitation details |
| POST | `/v1.0/invitations/{token}/accept` | Accept invitation |
| POST | `/v1.0/invitations/{token}/decline` | Decline invitation |

### 7.10 Cart Endpoints (Anonymous)

Anonymous users get a cookie-based cart ID.

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/v1.0/cart/{cartId}` | Get cart by cookie ID |
| POST | `/v1.0/cart/{cartId}/items` | Add item to cart |
| PUT | `/v1.0/cart/{cartId}/items/{itemId}` | Update cart item (quantity, or active=false to remove) |
| PUT | `/v1.0/cart/{cartId}` | Update cart (active=false to clear) |

### 7.11 Cart Endpoints (Logged-in Users)

Logged-in users have cart associated with their tenant.

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/v1.0/tenants/{tenantId}/cart` | Get tenant cart |
| POST | `/v1.0/tenants/{tenantId}/cart/items` | Add item to cart |
| PUT | `/v1.0/tenants/{tenantId}/cart/items/{itemId}` | Update cart item (quantity, or active=false to remove) |
| PUT | `/v1.0/tenants/{tenantId}/cart` | Update cart (active=false to clear) |

### 7.12 Payment Endpoints

Payments hang off orders.

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v1.0/tenants/{tenantId}/orders/{orderId}/payments` | Initiate PayFast payment |
| GET | `/v1.0/tenants/{tenantId}/orders/{orderId}/payments/{paymentId}` | Get payment status |
| POST | `/v1.0/payments/payfast/webhook` | PayFast ITN callback |

### 7.13 Organisation Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/portal/organisations` | List my organisations |
| GET | `/portal/organisations/{orgId}` | Get organisation |
| PUT | `/portal/organisations/{orgId}` | Update organisation |
| GET | `/portal/organisations/{orgId}/users` | List org users |
| POST | `/portal/organisations/{orgId}/users/invite` | Invite user |

### 7.14 Tenant Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/portal/tenants` | List my tenants |
| POST | `/portal/tenants` | Create tenant |
| GET | `/portal/tenants/{tenantId}` | Get tenant |
| PUT | `/portal/tenants/{tenantId}` | Update tenant |
| GET | `/portal/tenants/{tenantId}/users` | List tenant users |
| POST | `/portal/tenants/{tenantId}/users/invite` | Invite user |

### 7.15 Site Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/portal/tenants/{tenantId}/sites` | List sites |
| POST | `/portal/tenants/{tenantId}/sites` | Create site |
| GET | `/portal/tenants/{tenantId}/sites/{siteId}` | Get site |
| PUT | `/portal/tenants/{tenantId}/sites/{siteId}` | Update site |
| DELETE | `/portal/tenants/{tenantId}/sites/{siteId}` | Delete site |
| POST | `/portal/tenants/{tenantId}/sites/{siteId}/launch` | Launch site |
| GET | `/portal/tenants/{tenantId}/sites/{siteId}/environments` | List environments |
| POST | `/portal/tenants/{tenantId}/sites/{siteId}/environments/{env}/promote` | Promote |
| GET | `/portal/tenants/{tenantId}/sites/{siteId}/backups` | List backups |
| POST | `/portal/tenants/{tenantId}/sites/{siteId}/backups` | Create backup |
| POST | `/portal/tenants/{tenantId}/sites/{siteId}/backups/{id}/restore` | Restore |
| GET | `/portal/tenants/{tenantId}/sites/{siteId}/health` | Health status |

### 7.16 Billing Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/portal/subscription` | Get my subscription |
| POST | `/portal/subscription/upgrade` | Upgrade plan |
| POST | `/portal/subscription/downgrade` | Downgrade plan |
| GET | `/portal/subscription/orders` | List orders |
| GET | `/portal/subscription/orders/{id}` | Get order |
| GET | `/portal/subscription/orders/{id}/invoices` | List invoices |
| GET | `/portal/subscription/orders/{id}/invoices/{id}/pdf` | Download PDF |

### 7.17 Ticket Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/portal/tickets` | List my tickets |
| POST | `/portal/tickets` | Create ticket |
| GET | `/portal/tickets/{ticketId}` | Get ticket |
| GET | `/portal/tickets/{ticketId}/followups` | List follow-ups |
| POST | `/portal/tickets/{ticketId}/followups` | Add reply |

---

## 8. Authentication

### 8.1 JWT Authorization

All endpoints require a valid Cognito JWT in the `Authorization` header:

```
Authorization: Bearer <jwt_token>
```

### 8.2 Lambda Authorizer

The Lambda Authorizer:
1. Validates JWT signature with Cognito
2. Extracts user claims (user_id, email, roles)
3. Enforces tenant isolation (user can only access their own data)
4. Returns IAM policy for allowed actions

### 8.3 User Roles

| Role | Permissions |
|------|-------------|
| `super-admin` | Full access, manage other admins, billing |
| `admin` | Manage sites, users (except super-admin) |
| `user` | Create/edit sites and content |
| `viewer` | Read-only access |

### 8.4 Authentication Screens (Shared with Public Portal)

These screens are entry points from the Public Portal that lead to the Private Portal:

| # | Screen ID | Screen Name | Description |
|---|-----------|-------------|-------------|
| 1 | CPP-006 | Register | Customer registration (creates Cognito user + tenant) |
| 2 | CPP-007 | Login | Login form (redirects to Private Portal on success) |
| 3 | CPP-008 | Forgot Password | Password reset request |
| 4 | CPP-009 | Reset Password | Set new password (from email link) |
| 5 | CPP-010 | Verify Email | Email verification (from registration link) |
| 6 | CPP-011 | Accept Invitation | Accept org/tenant invite |

> **Note**: These screens are hosted on the Public Portal URL but lead to authenticated Private Portal access.

### 8.5 Authentication Workflow

```
┌─────────────────────────────────────────────────────────────────┐
│                  AUTHENTICATION WORKFLOW                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  REGISTRATION FLOW (CPP-006)                                    │
│  ├── 1. User submits registration form                          │
│  ├── 2. Lambda calls Cognito CreateUser                         │
│  ├── 3. Tenant created with status=UNVALIDATED                  │
│  ├── 4. Verification email sent via SES                         │
│  ├── 5. User clicks verification link (CPP-010)                 │
│  ├── 6. Cognito confirms user, tenant status=REGISTERED         │
│  └── 7. Redirect to Login (CPP-007)                             │
│                                                                 │
│  LOGIN FLOW (CPP-007)                                           │
│  ├── 1. User submits email/password                             │
│  ├── 2. Lambda calls Cognito InitiateAuth                       │
│  ├── 3. Cognito returns JWT (access + refresh tokens)           │
│  ├── 4. If MFA enabled: redirect to MFA challenge               │
│  ├── 5. JWT stored in localStorage/cookie                       │
│  └── 6. Redirect to Private Portal dashboard                    │
│                                                                 │
│  PASSWORD RESET FLOW (CPP-008 → CPP-009)                        │
│  ├── 1. User enters email on CPP-008                            │
│  ├── 2. Lambda calls Cognito ForgotPassword                     │
│  ├── 3. Reset email sent with verification code                 │
│  ├── 4. User clicks link to CPP-009                             │
│  ├── 5. User enters new password + verification code            │
│  └── 6. Lambda calls Cognito ConfirmForgotPassword              │
│                                                                 │
│  INVITATION ACCEPTANCE (CPP-011)                                │
│  ├── 1. User clicks invitation link                             │
│  ├── 2. Lambda validates invitation token                       │
│  ├── 3. If existing Cognito user: link to org/tenant            │
│  ├── 4. If new user: redirect to registration                   │
│  └── 5. On success: redirect to Private Portal                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 8.6 Cognito Configuration

| Setting | Value |
|---------|-------|
| User Pool | `bbws-customer-pool` |
| App Client | `bbws-customer-portal` |
| MFA | Optional (user choice) |
| Password Policy | Min 10 chars, uppercase, lowercase, number, special |
| Token Validity | Access: 1 hour, Refresh: 30 days |
| Email | SES verified domain |

### 8.7 JWT Token Structure

```json
{
  "sub": "user-uuid",
  "email": "user@example.com",
  "custom:tenant_id": "tenant-uuid",
  "custom:org_id": "org-uuid",
  "custom:roles": ["admin"],
  "iss": "https://cognito-idp.af-south-1.amazonaws.com/...",
  "exp": 1704067200
}
```

---

## 9. DynamoDB Schema

### 9.1 Entity PK/SK Patterns

| Entity | PK | SK |
|--------|----|----|
| Organisation | `ORG#{org_id}` | `METADATA` |
| OrgUser | `ORG#{org_id}` | `USER#{user_id}` |
| Tenant | `TENANT#{tenant_id}` | `METADATA` |
| TenantUser | `TENANT#{tenant_id}` | `USER#{user_id}` |
| Site | `TENANT#{tenant_id}` | `SITE#{site_id}` |
| Backup | `SITE#{site_id}` | `BACKUP#{timestamp}` |
| Migration | `TENANT#{tenant_id}` | `MIGRATION#{migration_id}` |
| Subscription | `TENANT#{tenant_id}` | `SUBSCRIPTION` |
| Order | `ORDER#{order_id}` | `METADATA` |
| Invoice | `TENANT#{tenant_id}` | `INVOICE#{invoice_id}` |
| Ticket | `TENANT#{tenant_id}` | `TICKET#{ticket_id}` |
| FollowUp | `TICKET#{ticket_id}` | `FOLLOWUP#{timestamp}` |

### 9.2 GSIs

| GSI Name | PK | SK | Purpose |
|----------|----|----|---------|
| UserEmailIndex | email | entity_type | Find user across orgs/tenants |
| OrgTenantsIndex | org_id | tenant_id | List tenants in org |
| TenantOrdersIndex | tenant_id | created_at | List orders by tenant |
| TicketStatusIndex | status | created_at | Filter tickets by status |

---

## 10. Infrastructure

### 10.1 AWS Services

| Service | Purpose |
|---------|---------|
| S3 | SPA hosting |
| CloudFront | CDN |
| API Gateway | REST API |
| Lambda | Backend services |
| DynamoDB | Database |
| Cognito | Authentication |
| SES | Email notifications |
| SQS | Async processing |

### 10.2 Cron Jobs (3 Total)

| # | Job | Schedule | Description |
|---|-----|----------|-------------|
| 1 | Site Health Check | rate(5 min) | Check site availability |
| 2 | Billing | Daily | Subscription renewal, invoices |
| 3 | Invitation Expiry | Daily | Mark expired invitations |

---

## 11. Repositories

### 11.1 Repository List (21 Total)

| # | Repo | Type | Description |
|---|------|------|-------------|
| 1 | `2_2_bbws_portal_private` | Frontend | React SPA |
| 2 | `2_2_bbws_portal_svc_auth` | Backend | Auth service (portal) |
| 3 | `2_2_bbws_portal_svc_organisation` | Backend | Organisation service |
| 4 | `2_2_bbws_portal_svc_tenant` | Backend | Tenant service |
| 5 | `2_2_bbws_portal_svc_site` | Backend | Site service |
| 6 | `2_2_bbws_portal_svc_migration` | Backend | Migration service |
| 7 | `2_2_bbws_portal_svc_billing` | Backend | Billing service |
| 8 | `2_2_bbws_portal_svc_ticket` | Backend | Ticket service |
| 9 | `2_2_bbws_portal_svc_notification` | Backend | Notification service |
| 10 | `2_2_bbws_auth_public_lambda` | Backend | Public auth service (registration, login, password) |
| 11 | `2_2_bbws_marketing_lambda` | Backend | Marketing service (Python) |
| 12 | `2_2_bbws_contact_lambda` | Backend | Contact service (Python) |
| 13 | `2_2_bbws_invitation_lambda` | Backend | Invitation service (Python) |
| 14 | `2_2_bbws_cart_lambda` | Backend | Cart service (Python) |
| 15 | `2_2_bbws_payment_lambda` | Backend | Payment service (Python) |
| 16 | `2_2_bbws_newsletter_lambda` | Backend | Newsletter service (Python) |
| 17 | `2_2_bbws_portal_cron_site_health` | Cron | Site health checks |
| 18 | `2_2_bbws_portal_cron_billing` | Cron | Subscription renewal |
| 19 | `2_2_bbws_portal_cron_invitation` | Cron | Invitation expiry |
| 20 | `2_2_bbws_dynamodb_schemas` | Database | DynamoDB table schemas, GSIs, migrations |
| 21 | `2_2_bbws_operations` | Operations | Dashboards, Alerts, Budgets, Config, Guardrails, Firewall, SCPs etc |

---

## 12. Implementation Plan

### 12.1 Phase 1 Milestones

| # | Milestone | Deliverables |
|---|-----------|--------------|
| 1.1 | Infrastructure | API Gateway, Lambda, DynamoDB |
| 1.2 | Auth Service | Profile, MFA endpoints |
| 1.3 | Tenant Services | Org, Tenant, Site services |
| 1.4 | Frontend Scaffold | React + routing + auth |
| 1.5 | Dashboard & Account | 3 screens |
| 1.6 | Organisation Screens | 5 screens |
| 1.7 | Tenant Screens | 5 screens |
| 1.8 | Site Screens | 10 screens |
| 1.9 | Migration Screens | 6 screens |
| 1.10 | Billing Integration | PayFast, 7 screens |
| 1.11 | Support Screens | 5 screens |
| 1.12 | Testing & QA | E2E, integration tests |

---

## 13. LLDs Reference

> **Naming Convention**: LLDs follow the pattern `{BRS}.{Sequence}_LLD_{Name}.md` (e.g., `2.2.1_LLD_Portal_Auth.md`). Repositories follow `2_2_bbws_{name}_lambda`.

### 13.1 Technical LLDs (16 Documents)

| # | LLD Name | Repository | Epic | Description | Status |
|---|----------|------------|------|-------------|--------|
| 1 | 2.2.1_LLD_Portal_Frontend.md | `2_2_bbws_portal_private` | All | React SPA, protected routes | TO CREATE |
| 2 | 2.2.2_LLD_Portal_Auth.md | `2_2_bbws_portal_svc_auth` | 3,4 | JWT, MFA, session, profile | TO CREATE |
| 3 | 2.2.3_LLD_Portal_Organisation.md | `2_2_bbws_portal_svc_organisation` | 5 | Organisation CRUD, user management | TO CREATE |
| 4 | **2.5_LLD_Tenant_Management.md** | `2_bbws_tenant_lambda` | **6** | Tenant lifecycle, org hierarchy, users | **EXISTS** |
| 5 | **2.6_LLD_WordPress_Site_Management.md** | `2_bbws_wordpress_site_management_lambda` | **7** | Sites API, templates, plugins, async ops | **EXISTS** |
| 6 | **2.7_LLD_WordPress_Instance_Management.md** | `2_bbws_tenants_instances_lambda` | **7** | AWS infra provisioning (ECS, EFS, RDS) | **EXISTS** |
| 7 | 2.2.4_LLD_Portal_Migration.md | `2_2_bbws_portal_svc_migration` | 7 | WP migrator (Mode A & B) | TO CREATE |
| 8 | 2.2.5_LLD_Portal_Billing.md | `2_2_bbws_portal_svc_billing` | 8 | Subscription management | TO CREATE |
| 9 | 2.2.6_LLD_Portal_Ticket.md | `2_2_bbws_portal_svc_ticket` | 9 | Support tickets, follow-ups | TO CREATE |
| 10 | 2.2.7_LLD_Portal_Notification.md | `2_2_bbws_portal_svc_notification` | All | Email & in-app notifications | TO CREATE |
| 11 | 2.1.2_LLD_Auth_Lambda.md | `2_1_bbws_auth_public_lambda` | 1,3 | Public auth (register, login, password) | EXISTS |
| 12 | 2.1.6_LLD_Invitation_Lambda.md | `2_1_bbws_invitation_lambda` | 2 | Invitation accept/decline | EXISTS |
| 13 | 2.1.8_LLD_Order_Lambda.md | `2_bbws_order_lambda` | 8 | Order processing | EXISTS |
| 14 | 2.1.9_LLD_Payment_Lambda.md | `2_bbws_payment_lambda` | 8 | PayFast integration | EXISTS |
| 15 | Cognito_Tenant_Pools_LLD.md | - | 1,3 | Cognito pool configuration | EXISTS |
| 16 | 2.1.1_LLD_Frontend_Architecture.md | `2_1_bbws_customer_portal_public` | - | Public portal frontend (reference) | EXISTS |

### 13.2 Shared Infrastructure LLDs

| # | LLD Name | Description | Status |
|---|----------|-------------|--------|
| 15 | 2.1.8_LLD_S3_and_DynamoDB.md | DynamoDB schemas, S3 buckets | EXISTS |
| 16 | 2.1.12_LLD_Event_Architecture.md | EventBridge, SQS, async processing | EXISTS |
| 17 | DNS_LLD.md | Route 53 DNS configuration | EXISTS |
| 18 | VPC_LLD.md | Network infrastructure | EXISTS |

### 13.3 Operational Runbooks (12 Documents)

| # | Runbook Name | Description | Status |
|---|--------------|-------------|--------|
| 19 | 2.1.11_OPS_Deployment_Runbook.md | Deployment procedures | EXISTS |
| 20 | 2.1.12_OPS_Monitoring_Runbook.md | API monitoring, CloudWatch | EXISTS |
| 21 | 2.1.13_OPS_Incident_Response_Runbook.md | Outage response procedures | EXISTS |
| 22 | 2.1.14_OPS_Security_Runbook.md | Security incident handling | EXISTS |
| 23 | 2.1.15_OPS_Troubleshooting_Runbook.md | General troubleshooting | EXISTS |
| 24 | 2.2.1_OPS_User_Management_Runbook.md | User account issues | TO CREATE |
| 25 | 2.2.2_OPS_Site_Provisioning_Runbook.md | Site creation troubleshooting | TO CREATE |
| 26 | 2.2.3_OPS_Migration_Runbook.md | Migration troubleshooting | TO CREATE |
| 27 | 2.2.4_OPS_Backup_Restore_Runbook.md | Backup/restore procedures | TO CREATE |
| 28 | 2.2.5_OPS_Environment_Promotion_Runbook.md | DEV→SIT→PROD promotion | TO CREATE |
| 29 | 2.2.6_OPS_Billing_Runbook.md | Payment & billing issues | TO CREATE |
| 30 | 2.2.7_OPS_WordPress_Health_Runbook.md | WP health monitoring | TO CREATE |

### 13.4 LLD Creation Priority

| Priority | LLDs | Epic | Reason | Status |
|----------|------|------|--------|--------|
| P0 | 2.2.2_LLD_Portal_Auth.md | 3,4 | Core authentication for all Epics | TO CREATE |
| P0 | 2.2.3_LLD_Portal_Organisation.md | 5 | Organisation Management | TO CREATE |
| - | 2.5_LLD_Tenant_Management.md | 6 | Tenant Management | **EXISTS** |
| - | 2.6_LLD_WordPress_Site_Management.md | 7 | Site Management API | **EXISTS** |
| - | 2.7_LLD_WordPress_Instance_Management.md | 7 | Site Infra Provisioning | **EXISTS** |
| P1 | 2.2.1_LLD_Portal_Frontend.md | All | Frontend architecture | TO CREATE |
| P1 | 2.2.5_LLD_Portal_Billing.md | 8 | Billing & Subscriptions | TO CREATE |
| P2 | 2.2.4_LLD_Portal_Migration.md | 7 | WordPress Migrations | TO CREATE |
| P2 | 2.2.6_LLD_Portal_Ticket.md | 9 | Support Tickets | TO CREATE |
| P2 | 2.2.7_LLD_Portal_Notification.md | All | Cross-cutting notifications | TO CREATE |

---

## 14. UX/UI Design Reference

This section references the UX design documentation that informs the UI implementation.

### 14.1 UX Documentation

| Document | Description | Location |
|----------|-------------|----------|
| **01_User_Journey_Map.md** | User personas, journey flows, and touchpoints for all user types | `UX/customer_self_service_ux/` |
| **02_Wireframes_Screens.md** | Complete ASCII wireframes for all 40 screens covering 65 user stories | `UX/customer_self_service_ux/` |
| **03_Accessibility_Components.md** | WCAG 2.1 AA compliance guidelines, component library, and design tokens | `UX/customer_self_service_ux/` |

### 14.2 Screen Routes

| Screen | Route | Epic | User Stories |
|--------|-------|------|--------------|
| Registration | `/register` | 1 | US 1.1-1.4 |
| Email Verification | `/verify-email` | 1 | US 1.5-1.8 |
| Welcome/Onboarding | `/welcome` | 1 | US 1.9-1.10 |
| Invitation Response | `/invitations/:token` | 2 | US 2.1-2.4 |
| Login | `/login` | 3 | US 3.1-3.3 |
| Forgot Password | `/forgot-password` | 3 | US 3.4-3.5 |
| Reset Password | `/reset-password` | 3 | US 3.6-3.7 |
| User Profile | `/profile` | 3 | US 3.8-3.10 |
| Dashboard | `/dashboard` | 4 | US 4.1 |
| Account Settings | `/settings` | 4 | US 4.2-4.3 |
| MFA Setup | `/settings/mfa` | 4 | US 4.3 |
| Organisation Overview | `/organisation` | 5 | US 5.1 |
| Organisation Settings | `/organisation/settings` | 5 | US 5.2 |
| Organisation Users | `/organisation/users` | 5 | US 5.3-5.8 |
| Invite Org User | `/organisation/users/invite` | 5 | US 5.3 |
| Tenant List | `/tenants` | 6 | US 6.1 |
| Tenant Details | `/tenants/:id` | 6 | US 6.3 |
| Tenant Settings | `/tenants/:id/settings` | 6 | US 6.3 |
| Tenant Users | `/tenants/:id/users` | 6 | US 6.4 |
| Invite Tenant User | `/tenants/:id/users/invite` | 6 | US 6.4 |
| Sites List | `/tenants/:tenantId/sites` | 7 | US 7.1 |
| Create Site | `/tenants/:tenantId/sites/new` | 7 | US 7.1 |
| Site Details | `/tenants/:tenantId/sites/:id` | 7 | US 7.2 |
| Site Settings | `/tenants/:tenantId/sites/:id/settings` | 7 | US 7.2 |
| Site Environments | `/tenants/:tenantId/sites/:id/environments` | 7 | US 7.3-7.4 |
| Promote Environment | `/tenants/:tenantId/sites/:id/environments/:env/promote` | 7 | US 7.4 |
| Site Backups | `/tenants/:tenantId/sites/:id/backups` | 7 | US 7.5-7.6 |
| Create Backup | `/tenants/:tenantId/sites/:id/backups/new` | 7 | US 7.5 |
| Restore Backup | `/tenants/:tenantId/sites/:id/backups/:backupId/restore` | 7 | US 7.6 |
| Launch Site | `/tenants/:tenantId/sites/:id/launch` | 7 | US 7.7 |
| DNS Sites List | `/tenants/:tenantId/dns-sites` | 7 | US 7.11 |
| Create DNS Site | `/tenants/:tenantId/dns-sites/new` | 7 | US 7.11 |
| DNS Site Details | `/tenants/:tenantId/dns-sites/:id` | 7 | US 7.13 |
| DNS Records | `/tenants/:tenantId/dns-sites/:id/records` | 7 | US 7.12 |
| Migrations List | `/tenants/:tenantId/migrations` | 7 | US 7.8 |
| Start Migration | `/tenants/:tenantId/migrations/new` | 7 | US 7.8 |
| Migration Mode A | `/tenants/:tenantId/migrations/:id/mode-a` | 7 | US 7.9 |
| Migration Mode B | `/tenants/:tenantId/migrations/:id/mode-b` | 7 | US 7.10 |
| Migration Progress | `/tenants/:tenantId/migrations/:id/progress` | 7 | US 7.8 |
| Migration Complete | `/tenants/:tenantId/migrations/:id/complete` | 7 | US 7.8 |
| Subscription | `/billing/subscription` | 8 | US 8.1 |
| Change Plan | `/billing/plans` | 8 | US 8.2-8.3 |
| Payment History | `/billing/history` | 8 | US 8.4 |
| Invoice Details | `/billing/invoices/:id` | 8 | US 8.5 |
| Checkout | `/billing/checkout` | 8 | US 8.6 |
| Payment Success | `/billing/success` | 8 | US 8.6 |
| Payment Failed | `/billing/failed` | 8 | US 8.6 |
| My Tickets | `/support/tickets` | 9 | US 9.1 |
| Create Ticket | `/support/tickets/new` | 9 | US 9.2 |
| Ticket Details | `/support/tickets/:id` | 9 | US 9.3-9.4 |

### 14.3 Design Principles

1. **User Journey Alignment**: Screens are organised to follow the natural user journey from registration through ongoing portal usage
2. **Progressive Disclosure**: Complex features are revealed progressively to avoid overwhelming users
3. **Consistent Navigation**: Left sidebar navigation with tenant switcher in header for context switching
4. **Mobile-First Responsive**: All screens designed with responsive breakpoints (mobile, tablet, desktop)
5. **Accessibility**: WCAG 2.1 AA compliant with semantic HTML, ARIA labels, and keyboard navigation

### 14.4 Key UI Components

| Component | Description | Used In |
|-----------|-------------|---------|
| **Tenant Switcher** | Header dropdown for switching between tenants | All authenticated screens |
| **Side Navigation** | Persistent left sidebar with collapsible menu | All authenticated screens |
| **Data Tables** | Sortable, filterable lists with pagination | Sites, Users, Invoices, Tickets |
| **Action Modals** | Confirmation dialogs for destructive actions | Delete, Promote, Restore |
| **Form Wizards** | Multi-step forms with progress indicators | Registration, Migration |
| **Status Badges** | Visual indicators for environment/ticket status | Sites, Support |
| **Environment Flow** | Visual DEV → SIT → PROD promotion pipeline | Site Dashboard |
| **Toast Notifications** | Temporary success/error messages | All screens |
| **Empty States** | Helpful messages when no data exists | Lists, Dashboard widgets |
| **Loading Skeletons** | Placeholder content during data loading | All data-dependent screens |

---

## 15. Appendices

### Appendix A: User Stories

| Story ID | User Story | Priority |
|----------|------------|----------|
| US-CP-001 | As a customer, I want to view my dashboard | P0 |
| US-CP-002 | As a customer, I want to manage my sites | P0 |
| US-CP-003 | As a customer, I want to create a new site | P0 |
| US-CP-004 | As a customer, I want to view my subscription | P0 |
| US-CP-005 | As a customer, I want to upgrade my plan | P0 |
| US-CP-006 | As a customer, I want to submit support tickets | P0 |
| US-CP-007 | As a customer, I want to manage my organisation | P1 |
| US-CP-008 | As a customer, I want to invite users | P1 |
| US-CP-009 | As a customer, I want to migrate my WordPress site | P1 |
| US-CP-010 | As a customer, I want to backup/restore sites | P1 |

---

## Related Documents

### HLD Documents
- [BBWS Customer Portal Public HLD](./BBWS_Customer_Portal_Public_HLD.md)
- [BBWS Admin Portal HLD](./BBWS_Admin_Portal_HLD.md)

### BRS Documents
- [BRS 2.2 Customer Portal Private](../BRS/2.2_BRS_Customer_Portal_Private.md) - Source requirements for this HLD
- [BRS 2.1 Customer Portal Public](../BRS/2.1_BRS_Customer_Portal_Public.md) - Public portal requirements
- [BRS 2.5 Tenant Management](../BRS/2.5_BRS_Tenant_Management.md) - Tenant management requirements

### UX Documentation
- [User Journey Map](../UX/customer_self_service_ux/01_User_Journey_Map.md) - User personas and journey flows
- [Wireframes & Screens](../UX/customer_self_service_ux/02_Wireframes_Screens.md) - Complete wireframes for all 40 screens
- [Accessibility & Components](../UX/customer_self_service_ux/03_Accessibility_Components.md) - WCAG 2.1 AA guidelines and component library

### Other
- [Master Plan](/.claude/plans/twinkling-mapping-hamster.md)

---

**End of Document**
