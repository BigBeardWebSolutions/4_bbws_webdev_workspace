# HLD 2.1.9: Payment Management

## High-Level Design Document

**Version**: 5.0
**Author**: Platform Architecture Team
**Date**: 2026-01-11
**Status**: Active

---

## Document History

| Version | Date | Changes | Owner |
|---------|------|---------|-------|
| 1.0 | 2026-01-05 | Initial HLD extracted from LLD | Platform Architecture |
| 1.1 | 2026-01-08 | Added Section 5 (API Endpoints), Section 6 (Authentication), updated Section 7 (DynamoDB with Activatable Entity Pattern), added Section 13 (Repositories), Section 14 (Business Approval), Section 15 (Implementation Plan), Section 16 (LLDs Reference) | HLD Architect |
| 5.0 | 2026-01-11 | **Documentation Reorganization**: Removed detailed API specifications (moved to LLD), removed authentication details (moved to LLD), removed detailed DynamoDB schema (moved to LLD), kept only high-level architecture, context diagrams, HATEOAS operations summary, repository lists. This HLD now follows proper HLD/LLD separation standards. | HLD Architect |

---

## Executive Summary

### Purpose

This document provides the architectural design for the Payment Management capability of the BBWS Customer Portal. It describes how the platform integrates with PayFast to process customer payments for WordPress hosting orders.

### Scope

This HLD covers the technical architecture for:
- Payment initiation and redirect to PayFast
- Instant Transaction Notification (ITN) processing
- Order status updates on payment completion
- Payment status tracking and history

### Relationship to Other Documents

| Document | Relationship |
|----------|--------------|
| **BRS 2.1.9** | Business requirements this architecture implements |
| **LLD 2.1.9** | **Detailed implementation specifications** - See this document for API specs, authentication, DynamoDB schema, environment variables, TDD requirements |
| **HLD 2.1.8** | Order Management - creates orders to be paid |
| **HLD 2.1** | Customer Portal Public - parent architecture |

> **Note**: This HLD provides architectural overview only. For implementation details including API request/response schemas, authentication matrix, DynamoDB implementation, sequence diagrams, and operational flow see **LLD 2.1.9: Payment Lambda** (`2.1.9_LLD_Payment_Lambda.md`).

---

## 1. Architecture Overview

### 1.1 Design Philosophy

| Principle | Implementation |
|-----------|----------------|
| **Redirect Model** | Customer redirected to PayFast - no card data touches our system |
| **Webhook-Driven** | Payment status via ITN callbacks from PayFast |
| **Idempotent Processing** | Duplicate ITN notifications handled safely |
| **PCI DSS Compliant** | No storage of payment card data |

### 1.2 High-Level Architecture Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              Customer Journey                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌──────────┐      ┌──────────┐      ┌──────────┐      ┌──────────┐       │
│   │ Customer │      │ Customer │      │ PayFast  │      │ Customer │       │
│   │ selects  │─────>│ redirects│─────>│ payment  │─────>│ returns  │       │
│   │ pay      │      │ to PayFast│     │ page     │      │ to portal│       │
│   └──────────┘      └──────────┘      └──────────┘      └──────────┘       │
│        │                                    │                 │             │
│        │                                    │                 │             │
│        ▼                                    ▼                 ▼             │
├─────────────────────────────────────────────────────────────────────────────┤
│                           BBWS Payment Service                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│   ┌─────────────────┐              ┌─────────────────┐                      │
│   │ Initiate        │              │ ITN Webhook     │                      │
│   │ Payment API     │              │ Handler         │                      │
│   │                 │              │                 │                      │
│   │ - Generate URL  │              │ - Validate sig  │                      │
│   │ - Create record │              │ - Update status │                      │
│   │ - Redirect      │              │ - Send email    │                      │
│   └────────┬────────┘              └────────┬────────┘                      │
│            │                                │                                │
│            └────────────────┬───────────────┘                                │
│                             │                                                │
│                    ┌────────▼────────┐                                       │
│                    │    DynamoDB     │                                       │
│                    │  Payment Table  │                                       │
│                    └─────────────────┘                                       │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ ITN Callback
                                      │
┌─────────────────────────────────────▼────────────────────────────────────────┐
│                            PayFast Gateway                                    │
│                                                                               │
│   - Handles card/EFT transactions                                            │
│   - Sends ITN notifications                                                  │
│   - Provides transaction verification                                        │
│                                                                               │
└───────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 Integration Model

| Pattern | Description |
|---------|-------------|
| **Redirect** | Customer browser redirected to PayFast hosted page |
| **ITN Callback** | PayFast server posts payment result to webhook |
| **Verification** | Platform verifies ITN with PayFast server |

---

## 2. System Context

### 2.1 Context Diagram

```
                              ┌─────────────────┐
                              │    Customer     │
                              │    (Browser)    │
                              └────────┬────────┘
                                       │
                         ┌─────────────┼─────────────┐
                         │             │             │
                         ▼             │             ▼
                 ┌───────────────┐     │     ┌───────────────┐
                 │   Customer    │     │     │    PayFast    │
                 │    Portal     │     │     │    Gateway    │
                 │ (Frontend)    │     │     │               │
                 └───────┬───────┘     │     └───────┬───────┘
                         │             │             │
                         ▼             │             │
┌──────────────────────────────────────┼─────────────┼─────────────────────────┐
│                                      │             │                          │
│                     BBWS Payment Management       │                          │
│                                      │             │                          │
│   ┌────────────┐   ┌────────────┐   │   ┌────────▼────────┐                 │
│   │  Initiate  │   │   Status   │   │   │  ITN Webhook    │                 │
│   │    API     │   │    API     │   │   │    Handler      │                 │
│   └────────────┘   └────────────┘   │   └─────────────────┘                 │
│                                      │                                        │
└──────────────────────────────────────┼────────────────────────────────────────┘
                                       │
            ┌──────────────────────────┼──────────────────────────┐
            │                          │                          │
            ▼                          ▼                          ▼
    ┌───────────────┐          ┌───────────────┐          ┌───────────────┐
    │     Order     │          │    Email      │          │    Tenant     │
    │   Management  │          │   Service     │          │  Management   │
    │   (BRS 2.1.8) │          │    (SES)      │          │   (BRS 2.5)   │
    └───────────────┘          └───────────────┘          └───────────────┘
```

### 2.2 External Integrations

| System | Integration Type | Purpose |
|--------|------------------|---------|
| **PayFast** | HTTPS Redirect + Webhook | Payment processing |
| **Order Service** | Internal API | Get order details, update status |
| **Email Service (SES)** | AWS SDK | Send payment confirmations |
| **Tenant Service** | Internal Event | Trigger provisioning on payment |

---

## 3. Component Architecture

### 3.1 Payment Initiation Service

**Responsibility**: Generate PayFast payment URL and create payment record.

| Operation | Description | Output |
|-----------|-------------|--------|
| Initiate Payment | Create payment record, generate PayFast URL | Redirect URL |
| Calculate Signature | Generate MD5 signature for PayFast | Signature string |
| Validate Order | Verify order exists and is payable | Boolean |

### 3.2 ITN Webhook Handler

**Responsibility**: Process payment notifications from PayFast.

| Operation | Description | Validation |
|-----------|-------------|------------|
| Receive ITN | Accept POST from PayFast | Source IP check |
| Validate Signature | Verify MD5 signature | Cryptographic |
| Verify Amount | Confirm amount matches order | Exact match |
| Server Verification | Confirm with PayFast API | Server-to-server |
| Update Payment | Record payment result | Idempotent |
| Update Order | Set order to PAID | Conditional |
| Send Notification | Email customer | Async |

### 3.3 Payment Status Service

**Responsibility**: Provide payment status information.

| Operation | Description |
|-----------|-------------|
| Get Payment | Retrieve payment by ID |
| Get By Order | Find payment for order |
| List Payments | Payment history for customer |

---

## 4. Key Operations

### 4.1 Payment Initiation Flow

```
┌──────────┐   ┌────────────┐   ┌──────────┐   ┌───────────┐   ┌──────────┐
│ Customer │   │   Portal   │   │ Payment  │   │  Order    │   │ PayFast  │
│          │   │  Frontend  │   │  Service │   │  Service  │   │          │
└────┬─────┘   └─────┬──────┘   └────┬─────┘   └─────┬─────┘   └────┬─────┘
     │               │               │               │               │
     │  Click Pay    │               │               │               │
     │──────────────>│               │               │               │
     │               │               │               │               │
     │               │ POST /payments│               │               │
     │               │──────────────>│               │               │
     │               │               │               │               │
     │               │               │ Get Order     │               │
     │               │               │──────────────>│               │
     │               │               │               │               │
     │               │               │ Order details │               │
     │               │               │<──────────────│               │
     │               │               │               │               │
     │               │               │ Create payment│               │
     │               │               │ record        │               │
     │               │               │               │               │
     │               │               │ Generate URL  │               │
     │               │               │ + signature   │               │
     │               │               │               │               │
     │               │ Payment URL   │               │               │
     │               │<──────────────│               │               │
     │               │               │               │               │
     │  Redirect     │               │               │               │
     │<──────────────│               │               │               │
     │               │               │               │               │
     │  Payment Page │               │               │               │
     │──────────────────────────────────────────────────────────────>│
     │               │               │               │               │
```

### 4.2 ITN Processing Flow

```
┌──────────┐   ┌──────────┐   ┌───────────┐   ┌──────────┐   ┌──────────┐
│ PayFast  │   │   ITN    │   │  Payment  │   │  Order   │   │  Email   │
│          │   │ Handler  │   │  Service  │   │ Service  │   │ Service  │
└────┬─────┘   └────┬─────┘   └─────┬─────┘   └────┬─────┘   └────┬─────┘
     │              │               │               │               │
     │ POST /webhook│               │               │               │
     │─────────────>│               │               │               │
     │              │               │               │               │
     │              │ Validate IP   │               │               │
     │              │──────────────>│               │               │
     │              │               │               │               │
     │              │ Validate sig  │               │               │
     │              │──────────────>│               │               │
     │              │               │               │               │
     │              │ Verify amount │               │               │
     │              │──────────────>│               │               │
     │              │               │               │               │
     │              │ Server verify │               │               │
     │<─────────────────────────────│               │               │
     │              │               │               │               │
     │ VALID        │               │               │               │
     │─────────────────────────────>│               │               │
     │              │               │               │               │
     │              │ Update payment│               │               │
     │              │──────────────>│               │               │
     │              │               │               │               │
     │              │               │ Update order  │               │
     │              │               │ to PAID       │               │
     │              │               │──────────────>│               │
     │              │               │               │               │
     │              │               │ Send email    │               │
     │              │               │──────────────────────────────>│
     │              │               │               │               │
     │ 200 OK       │               │               │               │
     │<─────────────│               │               │               │
```

---

## 5. Data Architecture

### 5.1 Payment Entity (High-Level)

| Attribute | Description |
|-----------|-------------|
| Payment ID | Unique identifier (UUID) |
| Order ID | Reference to order |
| Tenant ID | Customer tenant |
| Amount | Payment amount (cents) |
| Currency | ZAR |
| Status | PENDING, PROCESSING, COMPLETED, FAILED |
| PayFast Reference | pf_payment_id from PayFast |
| Payment Method | Card type or EFT |
| Error Message | Failure reason if applicable |
| ITN Data | Raw callback data for audit |
| Timestamps | Created, Updated |

> **Note**: For detailed DynamoDB schema including table structure, partition keys, sort keys, GSIs, attribute definitions, and access patterns, see **LLD 2.1.9 Section 7: DynamoDB Implementation** (`2.1.9_LLD_Payment_Lambda.md`).

### 5.2 Payment Status Flow

```
    ┌─────────────┐
    │   PENDING   │ ◄── Payment initiated
    └──────┬──────┘
           │
           │ ITN received
           ▼
    ┌─────────────┐
    │ PROCESSING  │ ◄── Being validated
    └──────┬──────┘
           │
     ┌─────┴─────┐
     │           │
     ▼           ▼
┌─────────┐  ┌─────────┐
│COMPLETED│  │ FAILED  │
└─────────┘  └─────────┘
     │
     │ (Future)
     ▼
┌─────────┐
│REFUNDED │
└─────────┘
```

---

## 6. API Endpoints (HATEOAS Operations)

### 6.1 API Structure

**Base URL (PROD)**: `https://api.kimmyai.io`
**Base URL (SIT)**: `https://sit.api.kimmyai.io`
**Base URL (DEV)**: `https://dev.api.kimmyai.io`

> **Note**: API version (`/v1.0`) is included in each endpoint path, not the base URL.

### 6.2 HATEOAS Operations: Payment

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/v1.0/payments` | Create a new payment (initiate PayFast transaction) |
| GET | `/v1.0/payments/{id}` | Get payment details by ID |
| GET | `/v1.0/payments` | List all payments (active only by default, use `?include_inactive=true` for all) |
| PUT | `/v1.0/payments/{id}` | Update payment details |
| PUT | `/v1.0/payments/{id}` | Soft delete payment (set active=false) |
| POST | `/v1.0/payments/webhook/itn` | PayFast ITN (Instant Transaction Notification) callback handler |
| GET | `/v1.0/payments/order/{orderId}` | Get payments by order ID |

> **Note**: For detailed API specifications including request schemas, response schemas, validation rules, error responses, and complete request/response examples for each endpoint, see **LLD 2.1.9 Section 6: REST API Operations** (`2.1.9_LLD_Payment_Lambda.md`).

---

## 7. Non-Functional Requirements

### 7.1 Performance

| Metric | Target | Rationale |
|--------|--------|-----------|
| Payment Initiation | < 500ms P95 | User experience |
| ITN Processing | < 1000ms P95 | PayFast timeout |
| URL Generation | < 200ms | Redirect delay |

### 7.2 Availability

| Metric | Target | Rationale |
|--------|--------|-----------|
| Payment API | 99.9% | Revenue critical |
| ITN Endpoint | 99.99% | Must not miss notifications |

### 7.3 Security

| Control | Implementation |
|---------|----------------|
| No Card Storage | Redirect model - PayFast handles |
| Signature Validation | MD5 with passphrase |
| IP Whitelist | PayFast server IPs only |
| Server Verification | Confirm ITN with PayFast API |
| Encryption | TLS 1.2+ all connections |

---

## 8. Security Architecture

### 8.1 PayFast Integration Security

```
┌─────────────────────────────────────────────────────────────────┐
│                     Security Controls                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   1. IP Whitelist Validation                                    │
│      ┌──────────────┐                                           │
│      │ PayFast IPs  │──────> Only accept from:                  │
│      │              │        197.97.145.144/28                  │
│      │              │        197.97.145.160/28                  │
│      │              │        41.74.179.192/27                   │
│      └──────────────┘                                           │
│                                                                  │
│   2. Signature Validation                                       │
│      ┌──────────────┐                                           │
│      │ MD5 Signature│──────> Calculated with passphrase         │
│      │              │        Exact parameter order               │
│      │              │        URL encoded values                  │
│      └──────────────┘                                           │
│                                                                  │
│   3. Amount Verification                                        │
│      ┌──────────────┐                                           │
│      │ Order Amount │──────> Must match ITN amount_gross        │
│      └──────────────┘                                           │
│                                                                  │
│   4. Server-to-Server Verification                              │
│      ┌──────────────┐                                           │
│      │ PayFast API  │──────> POST to /eng/query/validate        │
│      │              │        Response must be "VALID"           │
│      └──────────────┘                                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 8.2 Credential Management

| Credential | Storage | Rotation |
|------------|---------|----------|
| Merchant ID | Secrets Manager | On compromise |
| Merchant Key | Secrets Manager | On compromise |
| Passphrase | Secrets Manager | Annual |

---

## 9. Technology Decisions

### 9.1 Technology Stack

| Component | Technology | Rationale |
|-----------|------------|-----------|
| **API Layer** | AWS Lambda + API Gateway | Serverless, auto-scaling |
| **Data Store** | DynamoDB | Fast, serverless |
| **Email** | Amazon SES | Reliable email delivery |
| **Secrets** | Secrets Manager | Secure credential storage |
| **Monitoring** | CloudWatch | Integrated logging/metrics |

### 9.2 Key Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Payment Gateway | PayFast | South African leader, ZAR native |
| Integration Model | Redirect | PCI DSS compliance, simplicity |
| Notification | ITN Webhook | Real-time, reliable |
| Data Model | Single table | Payment lifecycle is simple |

---

## 10. Error Handling

### 10.1 Error Scenarios

| Scenario | Handling |
|----------|----------|
| Order not found | 404, log warning |
| Order already paid | 400, return existing payment |
| Invalid signature | 400, log security alert |
| Amount mismatch | 400, log fraud alert |
| PayFast unavailable | Retry with backoff |
| Duplicate ITN | Return 200, no-op |

### 10.2 Retry Strategy

| Operation | Retries | Backoff |
|-----------|---------|---------|
| PayFast verification | 3 | Exponential |
| Email send | 3 | Fixed 1s |
| Order update | 3 | Exponential |

---

## 11. Monitoring

### 11.1 Key Metrics

| Metric | Alert Threshold |
|--------|-----------------|
| Payment Success Rate | < 95% |
| ITN Processing Time | > 2s P95 |
| Failed Payments | > 5/hour |
| Invalid Signature | Any |

### 11.2 Dashboards

| Dashboard | Content |
|-----------|---------|
| Payment Overview | Success rate, volume, revenue |
| Error Analysis | Failed payments by reason |
| Security | Invalid signatures, IP violations |

---

## 12. Repositories

### 12.1 Repository List

Following the naming convention: `[HLD_Prefix]_[project]_[service]_lambda`

| # | Repository | Type | Description |
|---|------------|------|-------------|
| 1 | `2_bbws_payment_lambda` | Backend | Payment service with PayFast integration (Python 3.12) |
| 2 | `2_1_bbws_dynamodb_schemas` | Database | Shared DynamoDB table schemas and GSIs |
| 3 | `2_1_bbws_operations` | Operations | CloudWatch dashboards, alarms, budgets, WAF rules |

### 12.2 Repository Structure

```
2_bbws_payment_lambda/
├── src/
│   ├── handlers/                 # 7 Lambda handlers
│   │   ├── initiate_payment.py
│   │   ├── get_payment.py
│   │   ├── list_tenant_payments.py
│   │   ├── update_payment.py
│   │   ├── payfast_itn.py
│   │   ├── list_refunds.py
│   │   └── create_refund.py
│   ├── services/                 # Business logic
│   │   ├── payment_service.py
│   │   └── refund_service.py
│   ├── repositories/             # DynamoDB access
│   │   ├── payment_repository.py
│   │   └── refund_repository.py
│   ├── models/                   # Pydantic models
│   ├── validators/               # Input validation
│   ├── exceptions/               # Custom exceptions
│   └── utils/                    # Utilities
│       ├── payfast_client.py
│       ├── response_builder.py
│       └── logger.py
├── tests/
│   ├── conftest.py              # Root fixtures
│   ├── unit/                    # Unit tests (80%+ coverage)
│   ├── integration/             # Integration tests
│   ├── e2e/                     # E2E tests
│   ├── proxies/                 # API proxy tests
│   └── bootstrap/               # Test data seeding
├── terraform/                    # Infrastructure as Code
│   ├── main.tf
│   ├── lambda.tf
│   ├── api_gateway.tf
│   ├── api_gateway_integration.tf
│   ├── iam.tf
│   ├── cloudwatch.tf
│   └── environments/
│       ├── dev.tfvars
│       ├── sit.tfvars
│       └── prod.tfvars
├── .github/workflows/           # CI/CD
│   ├── deploy-dev.yml           # Auto-deploy on main
│   ├── deploy-sit.yml           # Manual with approval
│   └── deploy-prod.yml          # Manual with strict approval
├── requirements.txt
├── requirements-dev.txt
├── pytest.ini
├── mypy.ini
├── CLAUDE.md
└── README.md
```

---

## 13. Business Approval Requirements

### 13.1 Artefacts Requiring Business Approval

The following artefacts **MUST** have Business Owner (BO) approval before deployment:

| Category | Artefacts | Approval Required |
|----------|-----------|-------------------|
| **Email Templates** | Payment confirmation email, payment failed email | BO Sign-off |
| **Customer Messaging** | Payment error messages, success messages, email content | BO Sign-off |
| **Payment Flow** | Payment initiation flow, redirect behavior, return handling | BO Sign-off |

### 13.2 Business Approval Process

```
┌─────────────────────────────────────────────────────────────────┐
│              BUSINESS APPROVAL PROCESS                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. DEVELOPMENT                                                 │
│     └── Dev team completes payment integration                 │
│                                                                 │
│  2. DEV REVIEW                                                  │
│     └── Technical review (security, error handling)            │
│                                                                 │
│  3. STAGING DEPLOYMENT                                          │
│     └── Deploy to SIT for business review                      │
│                                                                 │
│  4. BUSINESS OWNER REVIEW                                       │
│     ├── BO reviews payment flow in SIT (sandbox mode)          │
│     ├── BO tests email notifications                           │
│     ├── BO provides feedback or approval                       │
│     └── Iterate until BO sign-off obtained                     │
│                                                                 │
│  5. PRODUCTION DEPLOYMENT                                       │
│     └── Only after BO sign-off documented                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 14. Implementation Plan

### 14.1 Development Approach

**Backend-First Approach**: Payment integration requires backend implementation first due to security and PayFast integration requirements.

**Reference Implementation**: Follow patterns from `2_bbws_product_lambda` (deployed to PROD, tested, working).

### 14.2 Milestones (with Business Owner Gates)

> **IMPORTANT**: Each milestone requires **Business Owner (BO) Review** before proceeding to the next milestone. No milestone is considered complete without documented BO sign-off.

| # | Milestone | Deliverables | Tech Review | BO Review |
|---|-----------|--------------|-------------|-----------|
| 0.1 | DynamoDB Schema | Payment table schema + GSIs | Dev Review | **BO Sign-off Required** |
| 0.2 | Payment Initiation | Create payment, generate PayFast URL | Dev Review | **BO Sign-off Required** |
| 0.3 | ITN Webhook Handler | Process PayFast callbacks, validation | Dev Review | **BO Sign-off Required** |
| 0.4 | Payment Status API | Get/list payment endpoints | Dev Review | **BO Sign-off Required** |
| 0.5 | Email Notifications | Payment confirmation emails | Dev Review | **BO Sign-off Required** |
| 0.6 | Integration Testing | Full flow testing with PayFast sandbox | QA Review | **BO Approval Required** |
| 0.7 | UAT | User Acceptance Testing in SIT | QA Review | **BO Final Approval** |
| 0.8 | Production | Live deployment with PayFast production credentials | Tech Lead | **BO Go-Live Approval** |

---

## 15. LLDs Reference

### 15.1 Parent HLD Information

| Attribute | Value |
|-----------|-------|
| HLD Document | `2.1.9_HLD_Payment_Management.md` |
| HLD Version | v5.0 |
| HLD Prefix | `2.1.9` |
| Total LLDs | 1 technical + 2 operational |

### 15.2 Technical LLDs

Following the naming convention: `[HLD_Prefix]_LLD_[Name].md`

| LLD ID | LLD Name | Description | Repository | Status |
|--------|----------|-------------|------------|--------|
| 2.1.9 | `2.1.9_LLD_Payment_Lambda.md` | **Payment service implementation with PayFast integration**. Contains: detailed API specifications (request/response schemas, validation rules, error codes), authentication matrix, DynamoDB implementation (table structure, GSIs, access patterns), environment variables, TDD requirements, sequence diagrams, operations flow. | `2_bbws_payment_lambda` | v5.0 (Implementation-ready) |

> **Implementation Note**: All detailed implementation specifications have been moved to the LLD as part of v5.0 documentation reorganization. Developers should reference the LLD for:
> - Complete API request/response schemas
> - Authentication and authorization rules
> - DynamoDB table design and GSI patterns
> - Environment variable configuration
> - Test-Driven Development requirements
> - Detailed sequence diagrams and operations flow

### 15.3 Operational Runbooks

Following the naming convention: `[HLD_Prefix]_OPS_[Name].md`

| OPS ID | Runbook Name | Description | Status |
|--------|--------------|-------------|--------|
| 2.1.9.1 | `2.1.9_OPS_Payment_Monitoring.md` | CloudWatch dashboards, alarms for payment failures | Draft |
| 2.1.9.2 | `2.1.9_OPS_PayFast_Integration_Troubleshooting.md` | Troubleshooting ITN issues, signature failures | Draft |

---

## 16. References

| Document | Path |
|----------|------|
| BRS 2.1.9: Payment Management | `BRS/2.1.9_BRS_Payment_Management.md` |
| **LLD 2.1.9: Payment Lambda** (v5.0) | `LLDs/2.1.9_LLD_Payment_Lambda.md` |
| HLD 2.1: Customer Portal Public | `HLDs/2.1_BBWS_Customer_Portal_Public_HLD_V1.1.md` |
| PayFast Developer Docs | https://developers.payfast.co.za/ |

---

**End of Document**

**Reorganization Summary (v5.0)**:
- ✅ Removed detailed API specifications (356 lines) → Moved to LLD Section 6
- ✅ Removed authentication details (27 lines) → Moved to LLD Section 8
- ✅ Removed detailed DynamoDB schema (52 lines) → Moved to LLD Section 7
- ✅ Kept high-level architecture, context diagrams, HATEOAS operations summary
- ✅ Kept repositories list, business approval process, implementation plan
- ✅ Added explicit references to LLD for implementation details
- ✅ HLD now follows proper HLD/LLD separation standards
