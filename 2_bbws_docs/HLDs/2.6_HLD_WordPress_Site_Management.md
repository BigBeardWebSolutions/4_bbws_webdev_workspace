# HLD 2.6: WordPress Site Management

## High-Level Design Document

**Version**: 1.2
**Author**: Platform Architecture Team
**Date**: 2026-02-17
**Status**: Draft

---

## Document History

| Version | Date | Changes | Owner |
|---------|------|---------|-------|
| 1.0 | 2026-01-05 | Initial HLD extracted from BRS 2.6 restructure | Platform Architecture |
| 1.1 | 2026-01-13 | Added Related Repositories section | Platform Architecture |
| 1.2 | 2026-02-17 | HLD remediation: removed API specs (moved to OpenAPI), added Platform Services, corrected Related Repositories to actual repo names | Platform Architecture |

---

## Executive Summary

### Purpose

This document provides the architectural design for the WordPress Site Management capability of the BBWS platform. It describes how the platform enables customers to manage their WordPress sites, templates, and plugins within their provisioned environment.

### Scope

This HLD defines the architectural boundaries and design for:
- WordPress site lifecycle architecture (create, configure, clone, promote, delete)
- Template marketplace integration and application patterns
- Plugin management and security validation architecture
- Asynchronous operation processing for long-running tasks
- WordPress proxy layer for secure container communication

> **Note:** For detailed API specifications, see `docs/openapi/`. For implementation details, see `docs/lld/`.

### Relationship to Other Documents

| Document | Relationship |
|----------|--------------|
| **BRS 2.6** | Business requirements this architecture implements |
| **LLD 2.6** | Detailed implementation specifications |
| **HLD 2.7** | Instance Management - provisions the environment this operates within |
| **HLD 2.5** | Tenant Management - provides tenant context |
| **HLD 2.0** | Platform architecture - shared infrastructure |

---

## 1. Architecture Overview

### 1.1 Design Philosophy

The WordPress Site Management architecture follows these principles:

| Principle | Implementation |
|-----------|----------------|
| **Container per Tenant** | Each customer has dedicated WordPress containers for isolation |
| **Proxy Pattern** | Platform API acts as intelligent proxy to WordPress REST API |
| **Async for Long Operations** | Template applications and bulk operations use queue-based processing |
| **Secure by Default** | All communications use internal networking with authenticated access |

### 1.2 High-Level Component Diagram

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           BBWS Platform                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐  │
│  │   Sites     │    │  Templates  │    │   Plugins   │    │    Async    │  │
│  │   Service   │    │   Service   │    │   Service   │    │  Processor  │  │
│  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘    └──────┬──────┘  │
│         │                  │                  │                  │          │
│         └──────────────────┼──────────────────┼──────────────────┘          │
│                            │                  │                              │
│                   ┌────────▼──────────────────▼────────┐                    │
│                   │        WordPress Proxy Layer        │                    │
│                   └────────────────┬───────────────────┘                    │
│                                    │                                         │
├────────────────────────────────────┼─────────────────────────────────────────┤
│                                    │                                         │
│  ┌─────────────────────────────────▼─────────────────────────────────────┐  │
│  │                    Application Load Balancer                           │  │
│  └─────────────────────────────────┬─────────────────────────────────────┘  │
│                                    │                                         │
│    ┌───────────────────────────────┼───────────────────────────────────┐    │
│    │                               │                                    │    │
│    ▼                               ▼                                    ▼    │
│  ┌─────────┐                   ┌─────────┐                        ┌─────────┐│
│  │Tenant A │                   │Tenant B │                        │Tenant N ││
│  │WordPress│                   │WordPress│          ...           │WordPress││
│  └────┬────┘                   └────┬────┘                        └────┬────┘│
│       │                             │                                  │     │
│       ▼                             ▼                                  ▼     │
│  ┌─────────┐                   ┌─────────┐                        ┌─────────┐│
│  │Tenant A │                   │Tenant B │                        │Tenant N ││
│  │   EFS   │                   │   EFS   │                        │   EFS   ││
│  │ Storage │                   │ Storage │                        │ Storage ││
│  └─────────┘                   └─────────┘                        └─────────┘│
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 1.3 Container Architecture Model

The platform uses a **one ECS Task per tenant** model:

| Component | Architecture | Rationale |
|-----------|--------------|-----------|
| **Compute** | Dedicated ECS Task per tenant | Complete process isolation |
| **Storage** | EFS Access Point per tenant | Filesystem isolation with shared infrastructure |
| **Database** | Database per tenant (shared RDS) | Logical isolation, cost-efficient |
| **Networking** | Shared ALB with path-based routing | Cost-efficient traffic distribution |

---

## 2. System Context

### 2.1 Context Diagram

```
                              ┌─────────────────┐
                              │   Tenant Admin  │
                              │   (Customer)    │
                              └────────┬────────┘
                                       │
                                       ▼
┌──────────────────────────────────────────────────────────────────────────┐
│                                                                           │
│                        BBWS WordPress Site Management                     │
│                                                                           │
│    ┌───────────┐    ┌───────────┐    ┌───────────┐    ┌───────────┐     │
│    │   Sites   │    │ Templates │    │  Plugins  │    │   Async   │     │
│    │  Service  │    │  Service  │    │  Service  │    │ Processor │     │
│    └───────────┘    └───────────┘    └───────────┘    └───────────┘     │
│                                                                           │
└───────────────────────────────────┬───────────────────────────────────────┘
                                    │
            ┌───────────────────────┼───────────────────────┐
            │                       │                       │
            ▼                       ▼                       ▼
    ┌───────────────┐      ┌───────────────┐      ┌───────────────┐
    │    Tenant     │      │   Instance    │      │   Template    │
    │  Management   │      │  Management   │      │  Repository   │
    │   (HLD 2.5)   │      │   (HLD 2.7)   │      │   (Internal)  │
    └───────────────┘      └───────────────┘      └───────────────┘
```

### 2.2 External Integrations

| System | Integration Type | Purpose |
|--------|------------------|---------|
| **Tenant Management (HLD 2.5)** | Internal API | Validate tenant context, user permissions |
| **Instance Management (HLD 2.7)** | Internal API | Access WordPress container endpoints |
| **Template Repository** | Internal | Curated template library |
| **WordPress.org** | External (read-only) | Plugin marketplace data |

---

## 3. Component Architecture

### 3.1 Sites Service

**Responsibility**: Manage WordPress site lifecycle within a tenant environment.

| Operation | Description | Complexity |
|-----------|-------------|------------|
| Create Site | Initialize new WordPress site in tenant's environment | Synchronous |
| Get Site | Retrieve site details and configuration | Synchronous |
| List Sites | Return all sites for a tenant | Synchronous |
| Update Site | Modify site settings | Synchronous |
| Clone Site | Duplicate site within same environment | Asynchronous |
| Promote Site | Move site between environments (dev > staging > prod) | Asynchronous |
| Delete Site | Remove site and associated content | Synchronous |

### 3.2 Templates Service

**Responsibility**: Manage template discovery, preview, and application.

| Operation | Description | Complexity |
|-----------|-------------|------------|
| Browse Templates | List available templates from marketplace | Synchronous |
| Get Template Details | Retrieve template metadata and preview | Synchronous |
| Preview Template | Generate preview of template on specific site | Asynchronous |
| Apply Template | Install template on site | Asynchronous |
| Rollback Template | Restore previous theme | Asynchronous |

### 3.3 Plugins Service

**Responsibility**: Manage plugin lifecycle with security validation.

| Operation | Description | Complexity |
|-----------|-------------|------------|
| List Marketplace | Browse approved plugins | Synchronous |
| List Installed | Get installed plugins for site | Synchronous |
| Install Plugin | Install approved plugin | Asynchronous |
| Activate/Deactivate | Toggle plugin state | Synchronous |
| Update Plugin | Apply plugin update | Asynchronous |
| Uninstall Plugin | Remove plugin from site | Synchronous |

### 3.4 Async Processor

**Responsibility**: Handle long-running operations with progress tracking.

| Capability | Description |
|------------|-------------|
| Operation Queuing | Accept operation requests and return tracking ID |
| Progress Tracking | Report operation status (pending, in_progress, completed, failed) |
| Result Delivery | Provide operation result when complete |
| Retry Handling | Automatic retry with exponential backoff |
| Dead Letter Handling | Capture failed operations for investigation |

---

## 4. Integration Points

### 4.1 WordPress REST API Integration

The platform acts as an intelligent proxy to the WordPress REST API:

| Integration Pattern | Description |
|--------------------|-------------|
| **Authentication** | Application Passwords stored in Secrets Manager |
| **Request Routing** | Tenant ID maps to specific WordPress container endpoint |
| **Response Transformation** | Normalize WordPress responses for platform consistency |
| **Error Handling** | Convert WordPress errors to platform error codes |

### 4.2 Internal Service Integration

| Service | Integration | Purpose |
|---------|-------------|---------|
| **Tenant Management (HLD 2.5)** | REST | Validate tenant exists and user has permissions |
| **Instance Management (HLD 2.7)** | REST | Get WordPress container endpoint for tenant |
| **State Store** | DynamoDB | Track site metadata, operation status |
| **Message Queue** | SQS | Async operation processing |

### 4.3 External Integration

| External System | Integration | Purpose |
|-----------------|-------------|---------|
| **WordPress.org Plugin Directory** | REST API (read-only) | Plugin discovery and metadata |
| **Template Repository** | Internal S3 | Curated template storage |

---

## 5. Non-Functional Requirements

### 5.1 Performance

| Metric | Target | Rationale |
|--------|--------|-----------|
| API Response Time (sync) | < 500ms P95 | User experience |
| Site Creation Time | < 60 seconds | Workflow efficiency |
| Template Application | < 5 minutes | Background processing acceptable |
| Plugin Installation | < 2 minutes | Background processing acceptable |

### 5.2 Availability

| Metric | Target | Rationale |
|--------|--------|-----------|
| API Availability | 99.9% | Business-critical operations |
| Async Processor Availability | 99.9% | Operations must complete |
| Queue Message Durability | 99.999999999% | No lost operations |

### 5.3 Scalability

| Dimension | Target | Approach |
|-----------|--------|----------|
| Concurrent Tenants | 100+ | Horizontal scaling of API |
| Sites per Tenant | 50 | WordPress multisite within container |
| Concurrent Operations | 20 per tenant | Queue-based throttling |

---

## 6. Security Architecture

### 6.1 Tenant Isolation

| Layer | Isolation Mechanism |
|-------|---------------------|
| **API** | JWT claims enforce tenant scope |
| **Data** | DynamoDB partition key includes tenant ID |
| **Compute** | Separate ECS tasks per tenant |
| **Storage** | EFS access points per tenant |
| **Queue** | Messages tagged with tenant ID |

### 6.2 Security Controls

| Control | Implementation |
|---------|----------------|
| Authentication | JWT tokens from Cognito |
| Authorization | Tenant isolation via token claims |
| Data Encryption | TLS in transit, KMS at rest |
| Credential Storage | Secrets Manager for WordPress passwords |
| Network Isolation | Private subnets, no public access |

---

## 7. Technology Decisions

### 7.1 Technology Stack

| Component | Technology | Rationale |
|-----------|------------|-----------|
| **API Layer** | AWS Lambda + API Gateway | Serverless, auto-scaling |
| **Async Processing** | SQS + Lambda | Decoupled, reliable |
| **State Store** | DynamoDB | Serverless, fast, scalable |
| **WordPress Proxy** | Internal ALB | Secure internal routing |
| **Secrets** | AWS Secrets Manager | Secure credential storage |

### 7.2 Key Architecture Decisions

| Decision | Choice | Rationale |
|----------|--------|-----------|
| Sync vs Async | Sync for fast ops, Async for long ops | User experience vs reliability |
| API Gateway Type | HTTP API | Cost-effective, sufficient features |
| Queue Type | Standard SQS | At-least-once delivery acceptable |
| DynamoDB Mode | On-demand | Variable traffic, cost optimization |

---

## 8. Constraints

| Constraint | Impact | Mitigation |
|------------|--------|------------|
| WordPress REST API limitations | Some operations require WP-CLI | Container exec capability |
| Plugin marketplace external dependency | Availability risk | Cache plugin metadata |
| Template size limits | Large templates slow to apply | Streaming transfer |
| Concurrent operation limits | Rate limiting needed | Queue-based throttling |

---

## 9. Platform Services

| Service | HLD | Repo | Description |
|---------|-----|------|-------------|
| Tenant Management | 2.5 | `2_bbws_tenant_management` | Tenant lifecycle and metadata |
| User Management | 2.5.1 | `2_bbws_user_management` | User profiles, directory, roles |
| Organization Management | 2.5.2 | `2_bbws_organization_management` | Org hierarchy (Division > Group > Team) |
| Site Management | 2.6 | `2_bbws_site_management` | WordPress site lifecycle |
| Instance Management | 2.7 | `2_bbws_instance_management` | Environment provisioning |
| Auth Management | 2.1.2 | `2_bbws_auth_management` | Registration, login, sessions |

---

## 10. Related Repositories

| Repository | Purpose |
|------------|---------|
| `2_bbws_tenant_management` | Tenant lifecycle service |
| `2_bbws_user_management` | User profile and role service |
| `2_bbws_organization_management` | Organization hierarchy service |
| `2_bbws_site_management` | WordPress site management service |
| `2_bbws_instance_management` | Environment provisioning service |
| `2_bbws_auth_management` | Authentication service |
| `2_bbws_ecs_terraform` | Shared ECS infrastructure as code |
| `2_bbws_ecs_operations` | Dashboards, alerts, runbooks |
| `2_bbws_wordpress_container` | WordPress Docker image |
| `2_bbws_agents` | AI agents and utilities |
| `2_bbws_docs` | Central documentation |

---

## 11. References

| Document | Path |
|----------|------|
| BRS 2.6: WordPress Site Management | `BRS/2.6_BRS_WordPress_Site_Management.md` |
| LLD 2.6: WordPress Technical Management | `LLDs/2.6_LLD_WordPress_Technical_Management.md` |
| HLD 2.0: BBWS ECS WordPress | `HLDs/2.0_BBWS_ECS_WordPress_HLD.md` |
| HLD 2.7: WordPress Instance Management | `HLDs/2.7_HLD_WordPress_Instance_Management.md` |
| Site API OpenAPI Spec | `docs/openapi/wp_technical_api_openapi.yaml` |

---

**End of Document**
