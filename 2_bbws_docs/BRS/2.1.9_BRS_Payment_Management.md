# BRS 2.1.9: Payment Management

**Version**: 1.0
**Document ID**: BRS-2.1.9
**Created**: 2026-01-05
**Last Updated**: 2026-01-05
**Status**: Draft
**Author**: Platform Architecture Team
**Reviewed By**: TBD
**Approved By**: TBD

---

## Document Control

| Version | Date | Author | Changes |
|---------|------|--------|---------|
| 1.0 | 2026-01-05 | Platform Architecture | Initial version extracted from LLD |

---

## Table of Contents

1. [Executive Summary](#1-executive-summary)
2. [Business Problem](#2-business-problem)
3. [Business Value](#3-business-value)
4. [Stakeholders](#4-stakeholders)
5. [Scope Definition](#5-scope-definition)
6. [Business Capabilities](#6-business-capabilities)
7. [Business Rules](#7-business-rules)
8. [Success Criteria](#8-success-criteria)
9. [Risks and Mitigations](#9-risks-and-mitigations)
10. [References](#10-references)
11. [Sign-Off](#11-sign-off)

---

## 1. Executive Summary

### 1.1 Purpose

The **Payment Management** capability enables the BBWS Customer Portal to securely accept online payments from customers purchasing WordPress hosting packages. This capability provides a seamless checkout experience while ensuring compliance with payment security standards.

### 1.2 Business Context

Customers need to pay for their WordPress hosting subscriptions through the Customer Portal. The platform integrates with PayFast, South Africa's leading online payment gateway, to process credit card, debit card, and EFT payments. This integration enables immediate payment confirmation and automated order fulfilment.

### 1.3 Key Benefits

| Benefit | Business Impact |
|---------|-----------------|
| **Instant Payment** | Customers pay immediately, no waiting for manual processing |
| **Multiple Payment Methods** | Credit card, debit card, EFT - customer choice |
| **Automated Confirmation** | Order status updates automatically on payment |
| **Secure Processing** | PCI DSS compliant - no card data stored on platform |
| **South African Focus** | PayFast is trusted local gateway with ZAR support |

### 1.4 Document Relationship

| Document | Focus Area |
|----------|------------|
| **BRS 2.1.8: Order Management** | Creating and managing customer orders |
| **BRS 2.1.9: Payment Management (This)** | Processing payments for orders |
| **BRS 2.5: Tenant Management** | Activating tenant after payment |

---

## 2. Business Problem

### 2.1 Current State

| Problem | Impact |
|---------|--------|
| **Manual Payment Processing** | Staff must manually verify bank transfers |
| **Delayed Order Fulfilment** | Customers wait for payment confirmation |
| **Payment Disputes** | No automated record of payment attempts |
| **Limited Payment Options** | Customers cannot pay by card online |
| **Cash Flow Delays** | Waiting for bank transfers to clear |

### 2.2 Desired State

| Goal | Outcome |
|------|---------|
| **Automated Payment** | Payments processed instantly via PayFast |
| **Immediate Confirmation** | Order status updates within seconds of payment |
| **Payment History** | Complete audit trail of all payment attempts |
| **Multiple Methods** | Card, EFT, and instant EFT options |
| **Faster Cash Flow** | Funds settled within 2 business days |

### 2.3 Why Now

| Driver | Business Pressure |
|--------|-------------------|
| **Customer Expectation** | Online shoppers expect card payment options |
| **Competition** | Competitors offer instant online checkout |
| **Operational Efficiency** | Manual payment processing is not scalable |
| **Revenue Recognition** | Need real-time payment status for accounting |

---

## 3. Business Value

### 3.1 Quantifiable Benefits

| Metric | Before | After | Improvement |
|--------|--------|-------|-------------|
| **Payment Processing Time** | 1-3 days | Instant | 99%+ reduction |
| **Manual Verification Effort** | 30 min/order | 0 min/order | 100% reduction |
| **Payment Success Rate** | 70% (abandoned) | 90%+ | 20%+ improvement |
| **Cash Flow (time to funds)** | 3-5 days | 2 days | 40% faster |

### 3.2 Annual Savings (at 500 orders/year)

| Cost Category | Before | After | Savings |
|---------------|--------|-------|---------|
| **Manual Verification** | R125,000 | R0 | R125,000 |
| **Payment Disputes** | R25,000 | R5,000 | R20,000 |
| **Lost Sales (abandonment)** | R150,000 | R50,000 | R100,000 |
| **Total Annual Savings** | | | **R245,000** |

*Assumptions: R500/hour admin time, 30 min verification per order*

### 3.3 Strategic Benefits

| Benefit | Strategic Value |
|---------|-----------------|
| **Professional Image** | Modern checkout experience builds trust |
| **Scalability** | Process unlimited payments without adding staff |
| **Customer Satisfaction** | Instant confirmation improves experience |
| **Financial Visibility** | Real-time payment reporting |

---

## 4. Stakeholders

### 4.1 Business Stakeholders

| Stakeholder | Interest | Benefit |
|-------------|----------|---------|
| **Finance Manager** | Revenue tracking, reconciliation | Automated payment records |
| **Sales Team** | Order conversion | Reduced cart abandonment |
| **Customer Service** | Payment inquiries | Clear payment status visibility |
| **Operations** | Order fulfilment | Automatic trigger on payment |

### 4.2 Customer Stakeholders

| Stakeholder | Interest | Benefit |
|-------------|----------|---------|
| **Customer** | Easy payment | Multiple options, instant confirmation |
| **Customer** | Security | Trusted payment gateway, no card storage |

---

## 5. Scope Definition

### 5.1 In Scope

| Capability | Description |
|------------|-------------|
| **Payment Initiation** | Customer selects payment method and redirects to PayFast |
| **Payment Processing** | PayFast handles card/EFT transaction |
| **Payment Notification** | Receive payment confirmation from PayFast |
| **Order Update** | Update order status on successful payment |
| **Payment History** | Record all payment attempts for audit |
| **Email Confirmation** | Send payment receipt to customer |
| **Payment Status Check** | Allow customer to view payment status |

### 5.2 Out of Scope

| Capability | Handled By | Reference |
|------------|------------|-----------|
| Order creation | Order Management | BRS 2.1.8 |
| Refund processing | Manual (Phase 2) | TBC-003 |
| Recurring billing | Future Phase | TBC-002 |
| Multi-currency | Not required | ZAR only |
| Credit facility | Not offered | Pay upfront |

### 5.3 Capability Boundaries

```
+------------------+     +------------------+     +------------------+
|   BRS 2.1.8      |     |   BRS 2.1.9      |     |   BRS 2.5        |
|   Order Mgmt     |     |   Payment Mgmt   |     |   Tenant Mgmt    |
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
| Create order     |---->| Initiate payment |---->| Activate tenant  |
|                  |     |                  |     |                  |
| Order details    |     | Process via      |     | Provision        |
|                  |     | PayFast          |     | WordPress        |
| Order status     |<----| Update order     |     |                  |
|                  |     | on payment       |     |                  |
+------------------+     +------------------+     +------------------+
```

---

## 6. Business Capabilities

### 6.1 Epic 1: Payment Initiation

**Business Objective**: Enable customers to initiate payment for their order through a secure checkout experience.

#### User Stories

| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-2.1.9-001 | Customer | pay for my order online | I can complete my purchase immediately |
| US-2.1.9-002 | Customer | choose my payment method | I can pay using my preferred option |
| US-2.1.9-003 | Customer | see the payment amount clearly | I know exactly what I'm paying |
| US-2.1.9-004 | Customer | return to my order after payment | I can see my confirmed order |

#### Business Outcomes

- Customer redirected to PayFast within 2 seconds
- All order details pre-filled on PayFast page
- Customer can return to portal after payment
- Payment link expires after 24 hours for security

---

### 6.2 Epic 2: Payment Processing

**Business Objective**: Receive and validate payment confirmations from PayFast to update order status automatically.

#### User Stories

| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-2.1.9-005 | System | receive payment confirmation | I can update the order status |
| US-2.1.9-006 | System | validate payment authenticity | I only process legitimate payments |
| US-2.1.9-007 | System | handle payment failures | customers are notified of issues |
| US-2.1.9-008 | Finance Manager | have complete payment records | I can reconcile with bank statements |

#### Business Outcomes

- Payment status updated within 30 seconds of transaction
- Failed payments recorded with reason
- Complete audit trail for all transactions
- Duplicate notifications handled safely

---

### 6.3 Epic 3: Payment Communication

**Business Objective**: Keep customers informed about their payment status through timely notifications.

#### User Stories

| ID | As a... | I want to... | So that... |
|----|---------|--------------|------------|
| US-2.1.9-009 | Customer | receive payment confirmation email | I have proof of payment |
| US-2.1.9-010 | Customer | be notified if payment fails | I can retry or use another method |
| US-2.1.9-011 | Customer | view my payment history | I can track my transactions |
| US-2.1.9-012 | Finance Manager | receive alerts for large payments | I can verify significant transactions |

#### Business Outcomes

- Confirmation email sent within 1 minute of payment
- Failed payment email includes retry instructions
- Payment history accessible in customer portal
- Admin alerted for payments over R10,000

---

## 7. Business Rules

### 7.1 Payment Policies

| Rule ID | Rule | Rationale |
|---------|------|-----------|
| BR-PAY-001 | Payment is required before order fulfilment | Ensures revenue before provisioning |
| BR-PAY-002 | All payments are in South African Rand (ZAR) | Local market focus |
| BR-PAY-003 | No customer card data is stored on platform | PCI DSS compliance |
| BR-PAY-004 | Payment confirmation must be verified | Prevents fraudulent order activation |
| BR-PAY-005 | Failed payments do not cancel orders | Customer can retry |

### 7.2 Amount Rules

| Rule ID | Rule | Rationale |
|---------|------|-----------|
| BR-PAY-006 | Minimum payment amount is R50 | Payment gateway requirement |
| BR-PAY-007 | Maximum single payment is R500,000 | Risk management |
| BR-PAY-008 | Payment amount must match order total | Prevents partial payments |

### 7.3 Status Rules

| Rule ID | Rule | Rationale |
|---------|------|-----------|
| BR-PAY-009 | Only PENDING orders can be paid | Prevents duplicate payments |
| BR-PAY-010 | Completed payments cannot be reversed in system | Refunds handled separately |
| BR-PAY-011 | Payment status is final once confirmed | Audit integrity |

### 7.4 Security Policies

| Rule ID | Rule | Rationale |
|---------|------|-----------|
| BR-PAY-012 | Payment notifications must be from PayFast servers | Fraud prevention |
| BR-PAY-013 | Payment signatures must be validated | Ensures authenticity |
| BR-PAY-014 | Payment records retained for 7 years | Legal compliance |

---

## 8. Success Criteria

### 8.1 Operational Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| **Payment Success Rate** | > 95% | Completed / Initiated |
| **Payment Processing Time** | < 5 seconds | Notification to status update |
| **Email Delivery Rate** | > 99% | Delivered / Sent |
| **Duplicate Handling** | 100% | No double-charges |

### 8.2 Customer Experience Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| **Checkout Completion** | > 80% | Completed / Started |
| **Payment Inquiry Tickets** | < 5/month | Support tickets |
| **Customer Satisfaction** | > 4/5 | Post-purchase survey |

### 8.3 Financial Metrics

| Metric | Target | Measurement Method |
|--------|--------|-------------------|
| **Reconciliation Accuracy** | 100% | PayFast vs system match |
| **Payment Dispute Rate** | < 1% | Disputes / Transactions |
| **Settlement Time** | < 3 days | Payment to bank account |

---

## 9. Risks and Mitigations

### 9.1 Business Risks

| ID | Risk | Probability | Impact | Mitigation |
|----|------|-------------|--------|------------|
| R-001 | PayFast service unavailable | Low | Critical | Retry mechanism, status page monitoring |
| R-002 | Payment notification lost | Low | High | Server-to-server verification, polling fallback |
| R-003 | Fraudulent transactions | Low | High | Signature validation, amount verification |
| R-004 | Customer disputes payment | Low | Medium | Complete transaction records, email confirmations |

### 9.2 Compliance Risks

| ID | Risk | Probability | Impact | Mitigation |
|----|------|-------------|--------|------------|
| R-005 | PCI DSS violation | Low | Critical | No card data stored, use PayFast redirect |
| R-006 | Audit trail incomplete | Low | High | Log all transactions, 7-year retention |

---

## 10. References

### 10.1 Related Business Documents

| Document | Relationship |
|----------|--------------|
| BRS 2.1.8: Order Management | Upstream - creates orders to be paid |
| BRS 2.5: Tenant Management | Downstream - activated after payment |
| BRS 2.1: Customer Portal Public | Parent capability |

### 10.2 Technical Documents

| Document | Content |
|----------|---------|
| HLD 2.1.9: Payment Management | Architectural design |
| LLD 2.1.9: Payment Lambda | Implementation details |
| PayFast Developer Docs | Integration specifications |

---

## 11. Sign-Off

| Role | Name | Signature | Date |
|------|------|-----------|------|
| Product Owner | | | |
| Finance Manager | | | |
| Compliance Officer | | | |

---

**End of Document**

---
---

# APPENDIX A: UX/UI Payment Flow - Consolidated Checkout Experience (v1.1)

**Appendix Date:** January 13, 2026
**Purpose:** Visual guide showing complete PayFast payment integration with consolidated checkout experience
**Source Document:** `/Users/tebogotseka/Documents/agentic_work/0_playpen/2_LLD_payments_integration_experiments/UXUI_payment_flow_with_screens_v1.1.md`

**Note:** This appendix supplements BRS 2.1.9 Payment Management by providing detailed screen-by-screen mockups, customer journey flows, technical implementation details, and backend processing sequences. It demonstrates the recommended single-page checkout approach (v1.1) that consolidates the checkout form and payment review into one screen for improved user experience and higher conversion rates.

---

# Complete PayFast Payment Flow - Screen-by-Screen Visual Guide

**Document Version:** 1.1
**Date:** January 13, 2026
**Author:** Big Beard Web Solutions
**Changes:** Consolidated Screen 2 (Checkout) + Screen 3 (Payment Review) into single checkout page

---

## Table of Contents

1. [Overview](#overview)
2. [Customer Journey Flow Diagram](#customer-journey-flow-diagram)
3. [Screen-by-Screen Breakdown](#screen-by-screen-breakdown)
4. [Data Mapping & Traceability](#data-mapping--traceability)
5. [Backend Processing Flow](#backend-processing-flow)
6. [Error Handling & Graceful Failures](#error-handling--graceful-failures)
7. [Technical Implementation Details](#technical-implementation-details)
8. [Changes from v1.0](#changes-from-v10)

---

## Overview

This document provides a complete visual guide for the PayFast payment integration with **consolidated checkout experience** (v1.1). The checkout form and payment review have been combined into a single screen for improved UX and faster conversion.

### Key Requirements

- âœ… **TransactionID generated when customer clicks "Pay Now"** (avoids database clutter)
- âœ… **Invoice Number generated** at same time and stored in DynamoDB
- âœ… **Single checkout page** with live order summary (improved UX)
- âœ… **PayFast Reference Numbers mapped** to our internal IDs
- âœ… **S3 storage** for transaction records
- âœ… **DynamoDB updates** for order status
- âœ… **Email notifications** with all reference numbers
- âœ… **Graceful error handling** at every step

---
## Customer Journey Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CUSTOMER PAYMENT JOURNEY (v1.1)                  â”‚
â”‚                    5 Screens (reduced from 7)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Screen 1    â”‚
â”‚   PRICING     â”‚
â”‚   PAGE        â”‚
â”‚               â”‚
â”‚ - View plans  â”‚
â”‚ - Compare     â”‚
â”‚ - Select      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Customer clicks
        â”‚ "Select Plan"
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Screen 2    â”‚       â”‚  BACKEND: Generate IDs NOW!     â”‚
â”‚   CHECKOUT    â”‚â—„â”€â”€â”€â”€â”€â”€â”‚  (when "Pay Now" clicked)       â”‚
â”‚   (COMBINED)  â”‚       â”‚  - TransactionID (TXN-xxx)      â”‚
â”‚               â”‚       â”‚  - InvoiceNumber (INV-xxx)      â”‚
â”‚ Left Column:  â”‚       â”‚  - Create order record          â”‚
â”‚ - Customer    â”‚       â”‚  - Store in DynamoDB (PROCESSINGâ”‚
â”‚   details     â”‚       â”‚  - Build PayFast payload        â”‚
â”‚ - Billing     â”‚       â”‚  - Generate signature           â”‚
â”‚   address     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚               â”‚
â”‚ Right Column: â”‚
â”‚ - Order       â”‚
â”‚   Summary     â”‚
â”‚ - Total       â”‚
â”‚               â”‚
â”‚ [ PAY NOW ] â”€â”€â”¼â”€â”€â”€ Customer clicks "Pay Now"
â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Browser submits form to PayFast
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Screen 3    â”‚       â”‚  PAYFAST FRONTEND               â”‚
â”‚   PAYFAST     â”‚â—„â”€â”€â”€â”€â”€â”€â”‚  - Browser redirected           â”‚
â”‚   PAYMENT     â”‚       â”‚  - PayFast loads form           â”‚
â”‚   PAGE        â”‚       â”‚  - Sandbox warning displayed    â”‚
â”‚               â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ âš ï¸ SANDBOX    â”‚
â”‚               â”‚
â”‚ Choose Method:â”‚
â”‚ â—‹ Card        â”‚
â”‚ â—‹ EFT         â”‚
â”‚ â— Wallet      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚ Customer selects method
        â”‚ and completes payment
        â–¼
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                        â”‚
        â–¼                     â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PAYFAST       â”‚   â”‚ PAYFAST BACKEND â”‚    â”‚ PAYFAST FRONTEND â”‚
â”‚ PROCESSES     â”‚   â”‚ (ITN Server)    â”‚    â”‚ (Redirect)       â”‚
â”‚ PAYMENT       â”‚   â”‚                 â”‚    â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                       â”‚
        â”‚ Payment Success    â”‚ ITN Callback          â”‚ Browser Redirect
        â”‚                    â”‚ (Server-to-Server)    â”‚ (User-Facing)
        â”‚                    â–¼                       â–¼
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           â”‚ LAMBDA ITN      â”‚    â”‚ Screen 4        â”‚
        â”‚           â”‚ HANDLER         â”‚    â”‚ PROCESSING...   â”‚
        â”‚           â”‚                 â”‚    â”‚                 â”‚
        â”‚           â”‚ - Validate      â”‚    â”‚ "Confirming     â”‚
        â”‚           â”‚ - Store S3      â”‚    â”‚  payment..."    â”‚
        â”‚           â”‚ - Update DDB    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                    â”‚                      â”‚
        â”‚                    â–¼                      â”‚
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚           â”‚ S3 BUCKET       â”‚             â”‚
        â”‚           â”‚ Transaction     â”‚             â”‚
        â”‚           â”‚ Record Saved    â”‚             â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                    â”‚                      â”‚
        â”‚                    â–¼                      â”‚
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚           â”‚ DYNAMODB        â”‚             â”‚
        â”‚           â”‚ Order Status:   â”‚             â”‚
        â”‚           â”‚ PAID            â”‚             â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                    â”‚                      â”‚
        â”‚                    â–¼                      â”‚
        â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
        â”‚           â”‚ EMAIL SERVICE   â”‚             â”‚
        â”‚           â”‚ Send confirmation            â”‚
        â”‚           â”‚ with all refs   â”‚             â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
        â”‚                                           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Screen 5    â”‚
                    â”‚   SUCCESS     â”‚
                    â”‚   PAGE        â”‚
                    â”‚               â”‚
                    â”‚ âœ… Payment    â”‚
                    â”‚    Successful â”‚
                    â”‚               â”‚
                    â”‚ TransactionID:â”‚
                    â”‚ TXN-123456    â”‚
                    â”‚               â”‚
                    â”‚ Invoice:      â”‚
                    â”‚ INV-123456    â”‚
                    â”‚               â”‚
                    â”‚ PayFast Ref:  â”‚
                    â”‚ 2953133       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Screen-by-Screen Breakdown

### Screen 1: Pricing Page

**URL:** `https://dev.kimmyai.io/buy/index.html`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BIG BEARD WEB SOLUTIONS                    [Home] [About] [Contact]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚              Choose Your Perfect Package                       â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚   ENTRY    â”‚  â”‚   BASIC    â”‚  â”‚ PROFESSIONALâ”‚  â”‚ENTERPRISEâ”‚â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚ â­ POPULAR â”‚  â”‚          â”‚â”‚
â”‚  â”‚  from R95  â”‚  â”‚  R1,500    â”‚  â”‚  R5,000    â”‚  â”‚ R15,000  â”‚â”‚
â”‚  â”‚  per year  â”‚  â”‚  once-off  â”‚  â”‚  per year  â”‚  â”‚ per year â”‚â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚          â”‚â”‚
â”‚  â”‚ Domain     â”‚  â”‚ Landing    â”‚  â”‚ Up to 5    â”‚  â”‚ Up to 10 â”‚â”‚
â”‚  â”‚ only       â”‚  â”‚ page +     â”‚  â”‚ sites      â”‚  â”‚ sites    â”‚â”‚
â”‚  â”‚            â”‚  â”‚ hosting    â”‚  â”‚            â”‚  â”‚          â”‚â”‚
â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚  â”‚          â”‚â”‚
â”‚  â”‚[SELECT]    â”‚  â”‚[SELECT]    â”‚  â”‚[SELECT]    â”‚  â”‚[SELECT]  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Customer Action:** Clicks [SELECT] on Professional plan

**What Happens:**
1. React Router navigates to `/checkout`
2. `selectedPlan` passed via router state
3. Combined checkout page loads (no database operations yet)

---

### Screen 2: Combined Checkout Page (NEW in v1.1)

**URL:** `https://dev.kimmyai.io/buy/checkout`

**Desktop Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Pricing                      Secure Checkout                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ðŸ‘¤ Customer Information                 â”‚  â”‚ ðŸ“‹ Order Summary                â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ Full Name *                             â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”‚ Professional Plan           â”‚ â”‚â”‚
â”‚  â”‚ â”‚ Tebogo Tseka                      â”‚   â”‚  â”‚ â”‚                             â”‚ â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â”‚ â€¢ Up to 5 WordPress sites   â”‚ â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚ â”‚ â€¢ Unlimited backups         â”‚ â”‚â”‚
â”‚  â”‚ Email Address *                         â”‚  â”‚ â”‚ â€¢ SSL certificates          â”‚ â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”‚ â€¢ 24/7 support              â”‚ â”‚â”‚
â”‚  â”‚ â”‚ tebogo@example.com                â”‚   â”‚  â”‚ â”‚ â€¢ Annual billing            â”‚ â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ Phone Number *                          â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â”‚ Subtotal:        R5,000.00  â”‚ â”‚â”‚
â”‚  â”‚ â”‚ +27821234567                      â”‚   â”‚  â”‚ â”‚ Tax:                   R0.00 â”‚ â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚ â”‚ Total:           R5,000.00  â”‚ â”‚â”‚
â”‚  â”‚ Company Name (Optional)                 â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ â”‚ Open Learn Academy                â”‚   â”‚  â”‚ ðŸ” Secure Payment               â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚ â€¢ Your transaction ID will be   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   generated when you click      â”‚â”‚
â”‚                                                â”‚   "Pay Now"                     â”‚â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                 â”‚â”‚
â”‚  â”‚ ðŸ“ Billing Address (Optional)           â”‚  â”‚ â€¢ You'll be redirected to       â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚   PayFast to complete payment   â”‚â”‚
â”‚  â”‚ Street Address                          â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ â€¢ All reference numbers will    â”‚â”‚
â”‚  â”‚ â”‚ 123 Main Street                   â”‚   â”‚  â”‚   be provided after payment     â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚â”‚
â”‚  â”‚ City                    Postal Code     â”‚  â”‚ â”‚                             â”‚ â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”‚      [ PAY NOW R5,000 â†’ ]   â”‚ â”‚â”‚
â”‚  â”‚ â”‚ Johannesburg     â”‚  â”‚ 2001         â”‚ â”‚  â”‚ â”‚                             â”‚ â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚â”‚
â”‚  â”‚                                         â”‚  â”‚                                 â”‚â”‚
â”‚  â”‚ Country                                 â”‚  â”‚ By clicking "Pay Now" you agree â”‚â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚ to our Terms of Service and     â”‚â”‚
â”‚  â”‚ â”‚ South Africa                â–¼     â”‚   â”‚  â”‚ Privacy Policy                  â”‚â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                                                    â”‚
â”‚  ðŸ’¬ Additional Notes (Optional)                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Need domain registration or migration services? Let us know here...        â”‚   â”‚
â”‚  â”‚                                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                    â”‚
â”‚  ðŸ”’ Payments secured by PayFast                                                   â”‚
â”‚                                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mobile Layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back        Checkout              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  ðŸ“‹ Order Summary                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Professional Plan             â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚ â€¢ Up to 5 sites               â”‚  â”‚
â”‚  â”‚ â€¢ Unlimited backups           â”‚  â”‚
â”‚  â”‚ â€¢ SSL included                â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚ Total: R5,000.00              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  ðŸ‘¤ Customer Information            â”‚
â”‚                                     â”‚
â”‚  Full Name *                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Tebogo Tseka                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  Email Address *                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ tebogo@example.com            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  Phone Number *                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ +27821234567                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  Company (Optional)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Open Learn Academy            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  â–¼ Billing Address (Optional)       â”‚
â”‚                                     â”‚
â”‚  Additional Notes (Optional)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  ðŸ” Your transaction ID will be     â”‚
â”‚  generated when you click Pay Now   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    [ PAY NOW R5,000 â†’ ]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  By clicking Pay Now you agree to   â”‚
â”‚  our Terms & Privacy Policy         â”‚
â”‚                                     â”‚
â”‚  ðŸ”’ Secured by PayFast              â”‚
â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Features:**
- âœ… Single page checkout (no separate review screen)
- âœ… Live order summary visible at all times
- âœ… Customer fills form and clicks "Pay Now" directly
- âœ… No database operations until "Pay Now" is clicked
- âœ… Responsive design (two-column desktop, stacked mobile)

**Sample Payloads**
```python
# 1. Generate IDs NOW (when customer clicks "Pay Now")
transaction_id = f"TXN-{timestamp}"  # Generated with the order by order API: TXN-1768156198885
invoice_number = f"INV-{timestamp}"  # This will only be generated after payment is received:INV-1768156198885
payment_id = f"PAY-{timestamp}-{random.randint(1000, 9999)}"  # PAY-1768156198885-0489

# 2. Create order record in DynamoDB
order_record = {
    "order_id": order_id,
    "transaction_id": transaction_id,
    "invoice_number": invoice_number,
    "payment_id": payment_id,
    "status": "PROCESSING",
    "plan_id": "PROD-003",
    "plan_name": "Professional",
    "amount": 5000.00,
    "currency": "ZAR",
    "created_at": "order_date",
    "updated_at": now,
    "customer": customer_data,
    "status": "PROCESSING"
}


# 3. Build PayFast payload with our reference numbers
payfast_data = {
    "merchant_id": "10044478",
    "merchant_key": "wxc5ty3stw0wl",
    "return_url": "https://dev.kimmyai.io/buy/payment/success",
    "cancel_url": "https://dev.kimmyai.io/buy/payment/cancel",
    "notify_url": "https://ip3sziqcod.execute-api.eu-west-1.amazonaws.com/dev/v1.0/payfast",

    # Our internal references
    "m_payment_id": payment_id,

    # Transaction details
    "amount": "5000.00",
    "item_name": "Product Id",
    "item_description": f"Product Description",

    # Custom tracking fields
    "custom_str1": transaction_id,   # TransactionID
    "custom_str2": order_id,    # Invoice Number
    "custom_str3": "PROD-003",        # Product ID
    "custom_str4": customer_email,    # Customer email for reference
}

# 4. Generate signature
signature = generate_signature(payfast_data, passphrase) # The signature will need a dedicated util and clear understand of key storage.

# 5. Auto-submit form to PayFast (browser redirect)
```

**Customer Action:** Clicks "PAY NOW" â†’ Backend generates IDs â†’ Browser redirects to PayFast

---

### Screen 3: PayFast Payment Page

**URL:** `https://sandbox.payfast.co.za/eng/process/finish/{token}`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Secured and powered by PayFast             â”‚
â”‚                                                                â”‚
â”‚  âš ï¸ You're in the sandbox. This is a testing environment     â”‚
â”‚     used to ensure correct integration with PayFast. If       â”‚
â”‚     unexpected, please contact the merchant you are trying    â”‚
â”‚     to pay to resolve the matter.                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Professional - BigBeard Website                              â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ Subtotal:         R 5,000.00           â”‚                  â”‚
â”‚  â”‚ Wallet funds:    -R 5,000.00           â”‚                  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚                  â”‚
â”‚  â”‚ Payment total:    R 0.00               â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                â”‚
â”‚  Choose payment method:                                        â”‚
â”‚                                                                â”‚
â”‚  â—‹ Credit/Debit Card                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚    â”‚ Card Number  [                    ]â”‚                    â”‚
â”‚    â”‚ Expiry (MM/YY) [  /  ]  CVV [   ] â”‚                    â”‚
â”‚    â”‚ Name on Card [                    ]â”‚                    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                â”‚
â”‚  â—‹ EFT (Electronic Funds Transfer)                            â”‚
â”‚    Select your bank...                                        â”‚
â”‚                                                                â”‚
â”‚  â— Wallet (Sandbox)                                           â”‚
â”‚    Balance: R10,000.00                                        â”‚
â”‚                                                                â”‚
â”‚                 [ CANCEL ]    [ PAY NOW ]                      â”‚
â”‚                                                                â”‚
â”‚  Payment Reference: PAY-1768156198885-0489                    â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Points:**
- PayFast receives our `m_payment_id` (PAY-1768156198885-0489)
- Customer sees payment reference on PayFast page
- PayFast will generate their own `pf_payment_id` (e.g., 2953133)

**Customer Action:** Selects "Wallet" and clicks "PAY NOW"

---

### Screen 4: Processing Payment (Loading State)

**URL:** `https://sandbox.payfast.co.za/eng/process/finish/{token}` (then redirects)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Secured and powered by PayFast             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                                                                â”‚
â”‚                      â­• Processing...                           â”‚
â”‚                                                                â”‚
â”‚                                                                â”‚
â”‚                  Your payment is being processed               â”‚
â”‚                                                                â”‚
â”‚                  Please do not close this window               â”‚
â”‚                                                                â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**What Happens Behind the Scenes:**

```
Timeline:
T+0s    Customer clicks PAY NOW on PayFast
T+1s    PayFast processes payment
T+2s    PayFast payment COMPLETE
T+2s    â”Œâ”€ PayFast Frontend: Prepares redirect
        â””â”€ PayFast Backend: Sends ITN to Lambda

T+3s    â”Œâ”€ Browser redirects to success page
        â””â”€ Lambda receives ITN POST request

T+4s    Lambda validates ITN (4 security checks)

T+5s    Lambda stores transaction in S3

T+6s    Lambda updates DynamoDB order status

T+7s    Lambda triggers email notification

T+8s    Lambda returns 200 OK to PayFast
```

---

### Screen 5: Payment Success Page

**URL:** `https://dev.kimmyai.io/buy/payment/success?m_payment_id=PAY-1768156198885-0489&pf_payment_id=2953133`

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BIG BEARD WEB SOLUTIONS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                         âœ…                                      â”‚
â”‚                                                                â”‚
â”‚                  Payment Successful!                           â”‚
â”‚                                                                â”‚
â”‚  Thank you for your purchase. Your payment has been            â”‚
â”‚  processed successfully and your order is being prepared.      â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ“‹ Order Details                                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚ â”‚ TransactionID       â”‚ Invoice Number               â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ TXN-1768156198885   â”‚ INV-1768156198885            â”‚  â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚ â”‚ PayFast Reference   â”‚ Amount                       â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ 2953133             â”‚ R5,000.00                    â”‚  â”‚ â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚ â”‚ Product             â”‚ Status                       â”‚  â”‚ â”‚
â”‚  â”‚ â”‚ Professional        â”‚ âœ… PAID                       â”‚  â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ“§ What happens next?                                    â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ âœ“ You'll receive a confirmation email shortly           â”‚ â”‚
â”‚  â”‚   (Check your inbox: tebogo@example.com)                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ âœ“ Your website and domain will be provisioned           â”‚ â”‚
â”‚  â”‚   automatically within 24 hours                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ âœ“ You'll get login credentials via email               â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ âœ“ Our team will contact you to complete the setup      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚           [ RETURN TO HOME ]    [ CONTACT SUPPORT ]            â”‚
â”‚                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                â”‚
â”‚  Need help?                                                    â”‚
â”‚  Contact us at support@bigbeard.co.za or call                 â”‚
â”‚  +27 (0)11 123 4567                                           â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Key Features:**
- âœ… All reference numbers displayed
- âœ… PayFast reference mapped to our TransactionID
- âœ… Invoice Number shown for accounting
- âœ… Status updated to PAID
- âœ… Email confirmation mentioned

---

### Email Confirmation (Screen 6 - Not shown to user directly)

**Subject:** Payment Confirmed - Invoice #INV-1768156198885

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  From: noreply@bigbeard.co.za                                  â”‚
â”‚  To: tebogo@example.com                                        â”‚
â”‚  Subject: Payment Confirmed - Invoice #INV-1768156198885       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚  Hi Tebogo Tseka,                                              â”‚
â”‚                                                                â”‚
â”‚  Thank you for your payment! We've received your payment       â”‚
â”‚  and your order is being processed.                            â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Payment Details                                          â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ TransactionID:     TXN-1768156198885                     â”‚ â”‚
â”‚  â”‚ Invoice Number:    INV-1768156198885                     â”‚ â”‚
â”‚  â”‚ PayFast Reference: 2953133                               â”‚ â”‚
â”‚  â”‚ Payment ID:        PAY-1768156198885-0489                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ Date & Time:       January 13, 2026 at 20:30 SAST       â”‚ â”‚
â”‚  â”‚ Amount Paid:       R5,000.00 ZAR                         â”‚ â”‚
â”‚  â”‚ Payment Method:    PayFast Wallet                        â”‚ â”‚
â”‚  â”‚ Status:            âœ… PAID                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Order Summary                                            â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ Product:           Professional Plan                     â”‚ â”‚
â”‚  â”‚ Description:       Up to 5 sites with unlimited backups â”‚ â”‚
â”‚  â”‚ Billing Cycle:     Annual                               â”‚ â”‚
â”‚  â”‚ Next Renewal:      January 13, 2027                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  ðŸ“„ Invoice                                                    â”‚
â”‚  Your invoice is attached to this email (INV-1768156198885.pdf)â”‚
â”‚                                                                â”‚
â”‚  ðŸš€ What happens next?                                         â”‚
â”‚                                                                â”‚
â”‚  1. Our team will provision your WordPress sites within 24    â”‚
â”‚     hours                                                      â”‚
â”‚  2. You'll receive login credentials via email                â”‚
â”‚  3. We'll set up your domain and SSL certificates            â”‚
â”‚  4. You'll get access to your admin dashboard                â”‚
â”‚                                                                â”‚
â”‚  Need help? Reply to this email or contact:                   â”‚
â”‚  ðŸ“§ support@bigbeard.co.za                                    â”‚
â”‚  ðŸ“ž +27 (0)11 123 4567                                        â”‚
â”‚                                                                â”‚
â”‚  Best regards,                                                 â”‚
â”‚  Big Beard Web Solutions Team                                 â”‚
â”‚                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  This is an automated message. Please do not reply directly.  â”‚
â”‚  Use support@bigbeard.co.za for assistance.                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Mapping & Traceability

### Reference Number Mapping Table

| Our System | PayFast System | Purpose | Generated When | Example |
|-----------|---------------|---------|----------------|---------|
| **TransactionID** | `m_payment_id` (our custom field) | Primary tracking ID | Screen 2 (Checkout - when clicking "Pay Now") | `TXN-1768156198885` |
| **Invoice Number** | Stored in `custom_str2` | Accounting reference | Screen 2 (Checkout - when clicking "Pay Now") | `INV-1768156198885` |
| **Payment ID** | `m_payment_id` (submitted to PayFast) | PayFast submission ID | Screen 2 (Checkout - same time as TransactionID) | `PAY-1768156198885-0489` |
| **PayFast Reference** | `pf_payment_id` (PayFast generates) | PayFast internal ID | Screen 3 (After payment) | `2953133` |

### Database Schema (DynamoDB)

**Table:** `orders`

```json
{
  "PK": "ORDER#TXN-1768156198885",
  "SK": "INVOICE#INV-1768156198885",

  "transaction_id": "TXN-1768156198885",
  "invoice_number": "INV-1768156198885",
  "payment_id": "PAY-1768156198885-0489",
  "pf_payment_id": "2953133",

  "status": "PAID",
  "status_history": [
    {"status": "PROCESSING", "timestamp": "2026-01-13T18:29:00Z", "note": "Order created when customer clicked 'Pay Now'"},
    {"status": "PAID", "timestamp": "2026-01-13T18:30:13Z", "note": "Payment confirmed via PayFast ITN"}
  ],

  "plan": {
    "id": "PROD-003",
    "name": "Professional",
    "amount": 5000.00,
    "currency": "ZAR"
  },

  "customer": {
    "name": "Tebogo Tseka",
    "email": "tebogo@example.com",
    "phone": "+27821234567",
    "company": "Open Learn Academy"
  },

  "payment_details": {
    "method": "payfast_wallet",
    "amount_gross": 5000.00,
    "amount_fee": -115.00,
    "amount_net": 4885.00,
    "payment_date": "2026-01-13T18:30:13Z"
  },

  "s3_transaction_file": "s3://bbws-payfast-responses-dev/payfast-itn/2026/01/13/PAY-1768156198885-0489_2953133.json",

  "created_at": "2026-01-13T18:29:00Z",
  "updated_at": "2026-01-13T18:30:13Z"
}
```

---

## Backend Processing Flow

### Sequence Diagram: Complete Transaction Flow (v1.1)

```
Customer    Frontend    Lambda      PayFast    PayFast    S3      DynamoDB    Email
Browser     React App   Checkout    Frontend   Backend    Bucket  Table       Service
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚â”€â”€Selectâ”€â”€â”€>â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚  Plan      â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚<â”€â”€â”€Showâ”€â”€â”€â”€â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚  Combined  â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚  Checkout  â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚â”€â”€Fill Form>â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚â”€â”€Pay Nowâ”€â”€>â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚â”€â”€Generate IDsâ”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚  (TXN-xxx, INV-xxx)    â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚                        â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚<â”€â”€IDsâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚                        â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚          â”‚
   â”‚            â”‚  Create Order (status: PROCESSING)        â”‚         â”‚          â”‚
   â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚         â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚â”€â”€Build PayFast Formâ”€â”€>â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚  + signature           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€POST Formâ”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€PayFast Pageâ”€â”€â”€â”€â”€â”€â”€â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚â”€â”€Selectâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚  Method &  â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚  Pay Now   â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â”Œâ”€â”€Process Paymentâ”€â”€â” â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â”‚                   â”‚ â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚         â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â”Œâ”€â”€â”€â”€Redirectâ”€â”€â”     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â”‚              â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€Send ITNâ”€â”€â”€â”€â”€â”€â”€â”€>â”‚        â”‚
   â”‚            â”‚           â”‚          â”‚    â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€POST ITNâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â”‚    â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚â”€â”€Validate ITNâ”€>â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚  (4 checks)   â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚                â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚         â”‚          â”‚
   â”‚            â”‚           â”‚  Store Transaction JSON       â”‚         â”‚          â”‚
   â”‚            â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚         â”‚          â”‚
   â”‚            â”‚           â”‚                â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚
   â”‚            â”‚           â”‚  Update Order (status: PAID)          â”‚          â”‚
   â”‚            â”‚           â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚
   â”‚            â”‚           â”‚                â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚            â”‚           â”‚  Trigger Email (TXN, INV, PF_REF)             â”‚
   â”‚            â”‚           â”‚                â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚â”€â”€200 OKâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚                â”‚         â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚          â””â”€â”€â”€â”€â”€Redirectâ”€â”€â”€â”€â”   â”‚        â”‚          â”‚
   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€GET /payment/successâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚   â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚â”€â”€Get Order Statusâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚
   â”‚            â”‚<â”€â”€â”€Order Data (PAID, all refs)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚     â”‚        â”‚          â”‚
   â”‚<â”€â”€â”€Showâ”€â”€â”€â”€â”‚           â”‚           â”‚          â”‚     â”‚        â”‚          â”‚
   â”‚  Success   â”‚           â”‚           â”‚          â”‚     â”‚        â”‚          â”‚
   â”‚  + All IDs â”‚           â”‚           â”‚          â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚     â”‚        â”‚          â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚     â”‚        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚     â”‚        â”‚  Email   â”‚
   â”‚            â”‚           â”‚           â”‚          â”‚     â”‚        â”‚  Sent    â”‚
```

---

## Error Handling & Graceful Failures

### Error Scenario 1: Payment Cancelled by Customer

**Screen: Payment Cancelled**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BIG BEARD WEB SOLUTIONS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                         âš ï¸                                      â”‚
â”‚                                                                â”‚
â”‚                  Payment Cancelled                             â”‚
â”‚                                                                â”‚
â”‚  Your payment was cancelled and no charges have been made      â”‚
â”‚  to your account.                                              â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ“‹ Your Reference Numbers                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ TransactionID:     TXN-1768156198885                     â”‚ â”‚
â”‚  â”‚ Invoice Number:    INV-1768156198885                     â”‚ â”‚
â”‚  â”‚ Status:            CANCELLED                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ What happened?                                           â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ You chose to cancel the payment or closed the payment   â”‚ â”‚
â”‚  â”‚ window before completing the transaction.               â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ No charges were made. Your payment method has not been  â”‚ â”‚
â”‚  â”‚ charged.                                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  Would you like to:                                            â”‚
â”‚                                                                â”‚
â”‚           [ TRY AGAIN ]       [ RETURN TO HOME ]               â”‚
â”‚                                                                â”‚
â”‚  Need help? Contact us at support@bigbeard.co.za              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Action:**
```python
# DynamoDB update
dynamodb.update_item(
    Key={"PK": f"ORDER#{transaction_id}"},
    UpdateExpression="SET #status = :status, cancellation_reason = :reason, updated_at = :timestamp",
    ExpressionAttributeValues={
        ":status": "CANCELLED",
        ":reason": "Customer cancelled payment on PayFast",
        ":timestamp": datetime.utcnow().isoformat()
    }
)
```

---

### Error Scenario 2: Payment Failed (Insufficient Funds)

**Screen: Payment Failed**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BIG BEARD WEB SOLUTIONS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                         âŒ                                      â”‚
â”‚                                                                â”‚
â”‚                    Payment Failed                              â”‚
â”‚                                                                â”‚
â”‚  We couldn't process your payment. Please try again with      â”‚
â”‚  a different payment method.                                   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ“‹ Your Reference Numbers                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ TransactionID:     TXN-1768156198885                     â”‚ â”‚
â”‚  â”‚ Invoice Number:    INV-1768156198885                     â”‚ â”‚
â”‚  â”‚ Status:            FAILED                                â”‚ â”‚
â”‚  â”‚ Reason:            Insufficient funds                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Common reasons for payment failure:                      â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ â€¢ Insufficient funds in your account                    â”‚ â”‚
â”‚  â”‚ â€¢ Card expired or invalid                               â”‚ â”‚
â”‚  â”‚ â€¢ Payment limit exceeded                                â”‚ â”‚
â”‚  â”‚ â€¢ Bank declined the transaction                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  What you can do:                                              â”‚
â”‚                                                                â”‚
â”‚  â€¢ Try again with a different payment method                  â”‚
â”‚  â€¢ Contact your bank to authorize the payment                â”‚
â”‚  â€¢ Use a different card or bank account                      â”‚
â”‚                                                                â”‚
â”‚           [ TRY AGAIN ]       [ CONTACT SUPPORT ]              â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Backend Action:**
```python
# ITN handler receives payment_status = "FAILED"
if payment_status == "FAILED":
    # Update DynamoDB
    dynamodb.update_item(
        Key={"PK": f"ORDER#{transaction_id}"},
        UpdateExpression="SET #status = :status, failure_reason = :reason, pf_payment_id = :pf_id, updated_at = :timestamp",
        ExpressionAttributeValues={
            ":status": "FAILED",
            ":reason": itn_data.get("reason", "Payment failed"),
            ":pf_id": itn_data.get("pf_payment_id"),
            ":timestamp": datetime.utcnow().isoformat()
        }
    )

    # Store failed transaction in S3 for audit
    s3.put_object(
        Bucket="bbws-payfast-responses-dev",
        Key=f"payfast-itn-failed/2026/01/13/{payment_id}_{pf_payment_id}.json",
        Body=json.dumps(itn_data)
    )
```

---

### Error Scenario 3: Lambda ITN Handler Fails

**PayFast Behavior:**
- PayFast will retry ITN up to 5 times over 24 hours
- Retry intervals: 5 mins â†’ 15 mins â†’ 1 hour â†’ 6 hours â†’ 24 hours

**Customer Experience:**
- Customer sees success on PayFast page
- Customer redirected to our success page
- Success page shows "Processing..." status
- After Lambda retry succeeds, status updates to "PAID"

**Screen: Processing Status**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BIG BEARD WEB SOLUTIONS                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                â”‚
â”‚                         ðŸ”„                                     â”‚
â”‚                                                                â”‚
â”‚              Payment Processing in Progress                    â”‚
â”‚                                                                â”‚
â”‚  Your payment was successful on PayFast, and we're            â”‚
â”‚  confirming the transaction with our system.                   â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ðŸ“‹ Your Reference Numbers                                â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚ TransactionID:     TXN-1768156198885                     â”‚ â”‚
â”‚  â”‚ Invoice Number:    INV-1768156198885                     â”‚ â”‚
â”‚  â”‚ PayFast Reference: 2953133                               â”‚ â”‚
â”‚  â”‚ Status:            PROCESSING â³                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  â±ï¸ This usually takes a few seconds...                        â”‚
â”‚                                                                â”‚
â”‚  What's happening:                                             â”‚
â”‚  â€¢ PayFast has confirmed your payment âœ…                       â”‚
â”‚  â€¢ We're updating our records (may take a moment)            â”‚
â”‚  â€¢ You'll receive an email confirmation shortly              â”‚
â”‚                                                                â”‚
â”‚  âš ï¸ Please save your reference numbers above                  â”‚
â”‚                                                                â”‚
â”‚  If this takes longer than 5 minutes, please contact:         â”‚
â”‚  ðŸ“§ support@bigbeard.co.za                                    â”‚
â”‚  ðŸ“ž +27 (0)11 123 4567                                        â”‚
â”‚  Reference: TXN-1768156198885                                 â”‚
â”‚                                                                â”‚
â”‚                   [ REFRESH STATUS ]                           â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**JavaScript Auto-Refresh:**
```javascript
// Poll order status every 5 seconds
setInterval(async () => {
    const response = await fetch(`/api/order/status/${transactionId}`);
    const data = await response.json();

    if (data.status === "PAID") {
        window.location.reload(); // Refresh to show success page
    }
}, 5000);
```

---

## Technical Implementation Details

### Frontend Component: CombinedCheckoutPage.tsx

```typescript
import React, { useState } from 'react';
import { useLocation, useNavigate } from 'react-router-dom';
import { submitToPayFast, createOrder } from '../services/payfastService';

interface CheckoutFormData {
  fullName: string;
  email: string;
  phone: string;
  company?: string;
  address?: {
    street: string;
    city: string;
    postalCode: string;
    country: string;
  };
  notes?: string;
}

const CombinedCheckoutPage: React.FC = () => {
  const location = useLocation();
  const navigate = useNavigate();
  const selectedPlan = location.state?.selectedPlan;

  const [formData, setFormData] = useState<CheckoutFormData>({
    fullName: '',
    email: '',
    phone: '',
    company: '',
    notes: ''
  });

  const [isProcessing, setIsProcessing] = useState(false);
  const [errors, setErrors] = useState<Record<string, string>>({});

  // Form validation
  const validateForm = (): boolean => {
    const newErrors: Record<string, string> = {};

    if (!formData.fullName.trim()) {
      newErrors.fullName = 'Full name is required';
    }

    if (!formData.email.trim()) {
      newErrors.email = 'Email is required';
    } else if (!/\S+@\S+\.\S+/.test(formData.email)) {
      newErrors.email = 'Email is invalid';
    }

    if (!formData.phone.trim()) {
      newErrors.phone = 'Phone number is required';
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  // Handle form input changes
  const handleInputChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));

    // Clear error for this field
    if (errors[name]) {
      setErrors(prev => ({
        ...prev,
        [name]: ''
      }));
    }
  };

  // Handle "Pay Now" click
  const handlePayNow = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!validateForm()) {
      return;
    }

    setIsProcessing(true);

    try {
      // 1. Create order and generate IDs on backend
      const orderResponse = await createOrder({
        plan_id: selectedPlan.id,
        plan_name: selectedPlan.name,
        amount: selectedPlan.amount,
        customer: formData
      });

      // 2. Submit to PayFast (auto-redirects browser)
      await submitToPayFast(orderResponse.payfast_form_data);

    } catch (error) {
      console.error('Error processing payment:', error);
      setErrors({ submit: 'Failed to process payment. Please try again.' });
      setIsProcessing(false);
    }
  };

  if (!selectedPlan) {
    navigate('/');
    return null;
  }

  return (
    <div className="checkout-container">
      <div className="checkout-header">
        <button onClick={() => navigate('/')} className="back-button">
          â† Back to Pricing
        </button>
        <h1>Secure Checkout</h1>
      </div>

      <div className="checkout-layout">
        {/* Left Column: Customer Information Form */}
        <div className="customer-details">
          <form onSubmit={handlePayNow}>
            <section className="form-section">
              <h2>ðŸ‘¤ Customer Information</h2>

              <div className="form-group">
                <label htmlFor="fullName">Full Name *</label>
                <input
                  type="text"
                  id="fullName"
                  name="fullName"
                  value={formData.fullName}
                  onChange={handleInputChange}
                  disabled={isProcessing}
                  className={errors.fullName ? 'error' : ''}
                />
                {errors.fullName && <span className="error-message">{errors.fullName}</span>}
              </div>

              <div className="form-group">
                <label htmlFor="email">Email Address *</label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  value={formData.email}
                  onChange={handleInputChange}
                  disabled={isProcessing}
                  className={errors.email ? 'error' : ''}
                />
                {errors.email && <span className="error-message">{errors.email}</span>}
              </div>

              <div className="form-group">
                <label htmlFor="phone">Phone Number *</label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  value={formData.phone}
                  onChange={handleInputChange}
                  disabled={isProcessing}
                  className={errors.phone ? 'error' : ''}
                />
                {errors.phone && <span className="error-message">{errors.phone}</span>}
              </div>

              <div className="form-group">
                <label htmlFor="company">Company Name (Optional)</label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  value={formData.company}
                  onChange={handleInputChange}
                  disabled={isProcessing}
                />
              </div>
            </section>

            <section className="form-section">
              <h2>ðŸ“ Billing Address (Optional)</h2>
              {/* Billing address fields */}
            </section>

            <section className="form-section">
              <h2>ðŸ’¬ Additional Notes (Optional)</h2>
              <textarea
                name="notes"
                value={formData.notes}
                onChange={handleInputChange}
                disabled={isProcessing}
                placeholder="Need domain registration or migration services? Let us know here..."
                rows={3}
              />
            </section>

            {errors.submit && (
              <div className="error-banner">{errors.submit}</div>
            )}
          </form>
        </div>

        {/* Right Column: Order Summary */}
        <div className="order-summary">
          <div className="summary-box">
            <h2>ðŸ“‹ Order Summary</h2>

            <div className="plan-details">
              <h3>{selectedPlan.name}</h3>
              <ul>
                {selectedPlan.features.map((feature: string, index: number) => (
                  <li key={index}>â€¢ {feature}</li>
                ))}
              </ul>
            </div>

            <div className="price-breakdown">
              <div className="price-row">
                <span>Subtotal:</span>
                <span>R{selectedPlan.amount.toFixed(2)}</span>
              </div>
              <div className="price-row">
                <span>Tax:</span>
                <span>R0.00</span>
              </div>
              <hr />
              <div className="price-row total">
                <span>Total:</span>
                <span>R{selectedPlan.amount.toFixed(2)}</span>
              </div>
            </div>

            <div className="security-notice">
              <h3>ðŸ” Secure Payment</h3>
              <ul>
                <li>â€¢ Your transaction ID will be generated when you click "Pay Now"</li>
                <li>â€¢ You'll be redirected to PayFast to complete payment</li>
                <li>â€¢ All reference numbers will be provided after payment</li>
              </ul>
            </div>

            <button
              type="submit"
              onClick={handlePayNow}
              disabled={isProcessing}
              className="pay-now-button"
            >
              {isProcessing ? (
                <>â³ Processing...</>
              ) : (
                <>PAY NOW R{selectedPlan.amount.toFixed(2)} â†’</>
              )}
            </button>

            <p className="terms-notice">
              By clicking "Pay Now" you agree to our Terms of Service and Privacy Policy
            </p>
          </div>

          <div className="payment-security">
            ðŸ”’ Payments secured by PayFast
          </div>
        </div>
      </div>
    </div>
  );
};

export default CombinedCheckoutPage;
```

### Backend: Order Creation API

```python
import time
import random
from datetime import datetime
import boto3
from fastapi import FastAPI, HTTPException
from pydantic import BaseModel

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('orders')

app = FastAPI()

class CustomerData(BaseModel):
    fullName: str
    email: str
    phone: str
    company: str = ""
    notes: str = ""

class OrderRequest(BaseModel):
    plan_id: str
    plan_name: str
    amount: float
    customer: CustomerData

@app.post("/api/orders/create")
async def create_order(request: OrderRequest):
    """
    Create order with TransactionID and Invoice Number
    Called when customer clicks "Pay Now" on combined checkout page
    This ensures we only create database records for committed payment attempts
    """
    timestamp = int(time.time())

    # Generate unique IDs
    transaction_id = f"TXN-{timestamp}"
    invoice_number = f"INV-{timestamp}"
    payment_id = f"PAY-{timestamp}-{random.randint(1000, 9999)}"

    # Create order record
    order = {
        "PK": f"ORDER#{transaction_id}",
        "SK": f"INVOICE#{invoice_number}",
        "transaction_id": transaction_id,
        "invoice_number": invoice_number,
        "payment_id": payment_id,
        "status": "PROCESSING",
        "plan": {
            "id": request.plan_id,
            "name": request.plan_name,
            "amount": request.amount,
            "currency": "ZAR"
        },
        "customer": {
            "name": request.customer.fullName,
            "email": request.customer.email,
            "phone": request.customer.phone,
            "company": request.customer.company
        },
        "notes": request.customer.notes,
        "status_history": [
            {
                "status": "PROCESSING",
                "timestamp": datetime.utcnow().isoformat(),
                "note": "Order created when customer clicked 'Pay Now'"
            }
        ],
        "created_at": datetime.utcnow().isoformat(),
        "updated_at": datetime.utcnow().isoformat(),
        "ttl": int(time.time()) + (7 * 24 * 60 * 60)  # 7 days TTL for unpaid orders
    }

    # Store in DynamoDB
    table.put_item(Item=order)

    # Build PayFast form data
    payfast_data = build_payfast_payload(
        transaction_id=transaction_id,
        invoice_number=invoice_number,
        payment_id=payment_id,
        amount=request.amount,
        plan_name=request.plan_name,
        customer_name=request.customer.fullName,
        customer_email=request.customer.email
    )

    return {
        "transaction_id": transaction_id,
        "invoice_number": invoice_number,
        "payment_id": payment_id,
        "status": "PROCESSING",
        "payfast_form_data": payfast_data
    }

def build_payfast_payload(transaction_id, invoice_number, payment_id, amount,
                         plan_name, customer_name, customer_email):
    """Build PayFast payment form data"""
    payfast_data = {
        "merchant_id": "10044478",
        "merchant_key": "wxc5ty3stw0wl",
        "return_url": "https://dev.kimmyai.io/buy/payment/success",
        "cancel_url": "https://dev.kimmyai.io/buy/payment/cancel",
        "notify_url": "https://ip3sziqcod.execute-api.eu-west-1.amazonaws.com/dev/v1.0/payfast",

        # Payment details
        "m_payment_id": payment_id,
        "amount": f"{amount:.2f}",
        "item_name": f"{plan_name} - Invoice #{invoice_number}",
        "item_description": f"{plan_name} for {customer_name}",

        # Custom tracking fields
        "custom_str1": transaction_id,
        "custom_str2": invoice_number,
        "custom_str3": plan_name,
        "custom_str4": customer_email,

        # Customer details
        "name_first": customer_name.split()[0] if customer_name else "",
        "name_last": " ".join(customer_name.split()[1:]) if len(customer_name.split()) > 1 else "",
        "email_address": customer_email,
    }

    # Generate signature
    passphrase = "jt7NOE43FZPn"
    signature = generate_signature(payfast_data, passphrase)
    payfast_data["signature"] = signature

    return payfast_data

def generate_signature(data: dict, passphrase: str) -> str:
    """Generate PayFast signature"""
    import hashlib
    import urllib.parse

    # Create parameter string
    params = []
    for key in sorted(data.keys()):
        if key != 'signature':
            params.append(f"{key}={urllib.parse.quote_plus(str(data[key]))}")

    param_string = "&".join(params)

    # Add passphrase
    param_string += f"&passphrase={urllib.parse.quote_plus(passphrase)}"

    # Generate MD5 hash
    return hashlib.md5(param_string.encode()).hexdigest()
```

### Backend: PayFast ITN Handler

```python
@app.post("/payfast/notify")
async def payfast_notify(request: Request):
    """
    ITN Handler with complete traceability
    """
    form_data = await request.form()
    itn_data = dict(form_data)

    # Extract our custom tracking fields
    transaction_id = itn_data.get('custom_str1', '')  # TXN-xxx
    invoice_number = itn_data.get('custom_str2', '')  # INV-xxx
    product_id = itn_data.get('custom_str3', '')      # Plan name
    customer_email = itn_data.get('custom_str4', '')  # Email

    # Extract PayFast fields
    payment_id = itn_data.get('m_payment_id', '')     # PAY-xxx (we sent this)
    pf_payment_id = itn_data.get('pf_payment_id', '') # 2953133 (PayFast generated)
    payment_status = itn_data.get('payment_status', '')

    # Security checks (signature, IP, amount, server confirmation)
    # ... (validation code)

    if payment_status == 'COMPLETE':
        # Update DynamoDB
        dynamodb.update_item(
            TableName='orders',
            Key={
                "PK": f"ORDER#{transaction_id}",
                "SK": f"INVOICE#{invoice_number}"
            },
            UpdateExpression="""
                SET #status = :status,
                    pf_payment_id = :pf_id,
                    payment_details = :payment,
                    updated_at = :timestamp,
                    #ttl = :ttl
            """,
            ExpressionAttributeNames={
                "#status": "status",
                "#ttl": "ttl"
            },
            ExpressionAttributeValues={
                ":status": "PAID",
                ":pf_id": pf_payment_id,
                ":payment": {
                    "payment_id": payment_id,
                    "pf_payment_id": pf_payment_id,
                    "amount_gross": float(itn_data.get('amount_gross', 0)),
                    "amount_fee": float(itn_data.get('amount_fee', 0)),
                    "amount_net": float(itn_data.get('amount_net', 0)),
                    "payment_date": datetime.utcnow().isoformat()
                },
                ":timestamp": datetime.utcnow().isoformat(),
                ":ttl": int(time.time()) + (365 * 24 * 60 * 60)  # Keep for 1 year
            }
        )

        # Store full transaction in S3
        s3_key = f"payfast-itn/{datetime.utcnow().strftime('%Y/%m/%d')}/{payment_id}_{pf_payment_id}.json"
        s3.put_object(
            Bucket='bbws-payfast-responses-dev',
            Key=s3_key,
            Body=json.dumps({
                "transaction_id": transaction_id,
                "invoice_number": invoice_number,
                "payment_id": payment_id,
                "pf_payment_id": pf_payment_id,
                "status": payment_status,
                "itn_data": itn_data,
                "processed_at": datetime.utcnow().isoformat()
            }, indent=2)
        )

        # Trigger email notification
        await send_payment_confirmation_email(
            email=customer_email,
            transaction_id=transaction_id,
            invoice_number=invoice_number,
            pf_payment_id=pf_payment_id,
            amount=itn_data.get('amount_gross', '0.00')
        )

    return PlainTextResponse("OK", status_code=200)
```

---

## Summary

This flow ensures:

âœ… **TransactionID generated when customer commits** (when clicking "Pay Now" on combined checkout)
âœ… **No database clutter** from abandoned checkouts (IDs only created when customer proceeds to payment)
âœ… **Single-page checkout** with live order summary (improved UX, faster conversion)
âœ… **Customer sees all information at once** (form + order summary side-by-side)
âœ… **PayFast receives and returns** our references
âœ… **Full traceability** between systems
âœ… **DynamoDB updated** at each stage (starting with PROCESSING status)
âœ… **S3 storage** for audit trail
âœ… **Email confirmation** with all IDs
âœ… **Graceful error handling** at every step

**Key Mapping:**
- Our TransactionID â†’ PayFast `m_payment_id` (custom_str1)
- Our Invoice Number â†’ PayFast `custom_str2`
- PayFast generates â†’ `pf_payment_id` (e.g., 2953133)
- All references tracked in DynamoDB and S3

**Architecture Benefits:**
- Clean database: No PENDING records for abandoned checkout forms
- Customer commitment: IDs only generated after customer clicks "Pay Now"
- Better tracking: Status starts at PROCESSING (actual payment attempt), not PENDING (form filled)
- Improved UX: Single-page checkout reduces friction and increases conversion
- Mobile-friendly: Responsive design works on all screen sizes

---

## Changes from v1.0

### Major Changes

1. **Consolidated Checkout Experience**
   - **Old (v1.0)**: Screen 2 (Checkout Form) â†’ Screen 3 (Payment Review) â†’ Screen 4 (PayFast)
   - **New (v1.1)**: Screen 2 (Combined Checkout) â†’ Screen 3 (PayFast)
   - **Impact**: Reduced from 7 screens to 5 screens, one less click to payment

2. **Screen Layout**
   - **Old (v1.0)**: Separate checkout and review screens
   - **New (v1.1)**: Two-column layout with form (left) and order summary (right)
   - **Impact**: Customer sees all information at once, better transparency

3. **Mobile Experience**
   - **Old (v1.0)**: Two separate mobile screens
   - **New (v1.1)**: Single stacked layout with order summary at top
   - **Impact**: Less navigation, faster mobile checkout

### Unchanged Elements

- TransactionID generation timing: Still occurs when "Pay Now" is clicked
- Database strategy: Still avoids creating records for abandoned checkouts
- PayFast integration: No changes to ITN handler or payment flow
- Error handling: All error scenarios remain the same
- Email notifications: No changes to confirmation emails
- Data mapping: Same reference number correlations

### Performance Improvements

- **Conversion Rate**: Expected 10-15% improvement (industry standard for single-page checkout)
- **Load Time**: One fewer page load = faster time to payment
- **Bounce Rate**: Reduced exit points = fewer abandoned carts

### Implementation Complexity

- **Frontend**: Medium complexity increase (more sophisticated form component)
- **Backend**: No changes to order creation or ITN handling
- **Testing**: Fewer screens to test = simpler QA process

---

**Document Status:** Complete
**Last Updated:** January 13, 2026
**Maintained By:** Big Beard Web Solutions
