# Release Plan: R1.4 - Buy User Journey (Payments & Orders)
## Phase 1: Core APIs (Frontend + Backend)

**Document ID**: RP-R1.4-BUY-USER-JOURNEY
**Version**: 1.1
**Created**: 2026-01-26
**Last Updated**: 2026-01-26
**Status**: Backend DEV Deployed
**Priority**: P0 - CRITICAL

---

## Release Summary

| Attribute | Value |
|-----------|-------|
| **Release #** | R1.4 |
| **BRS Reference** | BRS 2.2 (Epic 8: Billing & Subscriptions) |
| **Phase** | Phase 1 - Core APIs |
| **SDLC Track** | Full-Stack (Frontend + Backend) |
| **Depends On** | R1.0 (Tenant Management API), R1.3 (Subscription & Billing) |
| **Repository** | `2_1_bbws_web_public/buy` |
| **Target Release Date** | _______________ |
| **UAT Signoff Date** | _______________ |
| **Business Owner** | _______________ |

---

## 1. Release Objective

Implement the **Buy User Journey** - the public-facing purchase flow that enables new customers to view pricing plans, apply promotional campaigns, complete checkout, and process payments via PayFast.

### Key Capabilities
- **Pricing Display**: View and compare subscription plans
- **Campaign Integration**: Apply promotional discounts automatically
- **Checkout Flow**: Customer details capture and order submission
- **Payment Processing**: PayFast integration for secure payments
- **Order Management**: Order creation, tracking, and confirmation

---

## 2. User Journey Flow

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        BUY USER JOURNEY FLOW                                │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────────┐     ┌─────────────┐     ┌─────────────┐                  │
│   │   /buy/     │────►│  /buy/      │────►│   PayFast   │                  │
│   │  Pricing    │     │  checkout   │     │   Gateway   │                  │
│   │    Page     │     │    Page     │     │             │                  │
│   └─────────────┘     └─────────────┘     └──────┬──────┘                  │
│         │                   │                    │                          │
│         │                   │             ┌──────┴──────┐                   │
│         ▼                   ▼             │             │                   │
│   ┌─────────────┐     ┌─────────────┐    ▼             ▼                   │
│   │  Campaign   │     │   Order     │ ┌──────────┐ ┌──────────┐           │
│   │    API      │     │    API      │ │ Success  │ │  Cancel  │           │
│   │  (discounts)│     │  (submit)   │ │  Page    │ │  Page    │           │
│   └─────────────┘     └─────────────┘ └──────────┘ └──────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. Frontend Components

### 3.1 Routes

| Route | Component | Description |
|-------|-----------|-------------|
| `/buy/` | PricingPage | Display pricing plans with campaign discounts |
| `/buy/checkout` | CheckoutPage | Customer form and order summary |
| `/buy/payment/success` | PaymentSuccess | Payment confirmation page |
| `/buy/payment/cancel` | PaymentCancel | Payment cancelled/failed page |

### 3.2 Component Inventory

| Component | Path | Status | Description |
|-----------|------|--------|-------------|
| **Layout** |
| PageLayout | `components/layout/PageLayout.tsx` | COMPLETE | Main page wrapper |
| Navigation | `components/layout/Navigation.tsx` | COMPLETE | Header navigation |
| **Pricing** |
| PricingPage | `components/pricing/PricingPage.tsx` | COMPLETE | Plans display |
| PricingCard | `components/pricing/PricingCard.tsx` | COMPLETE | Individual plan card |
| PricingFeature | `components/pricing/PricingFeature.tsx` | COMPLETE | Feature list item |
| **Checkout** |
| CheckoutPage | `components/checkout/CheckoutPage.tsx` | COMPLETE | Main checkout flow |
| CustomerForm | `components/checkout/CustomerForm.tsx` | COMPLETE | Customer details form |
| OrderSummary | `components/checkout/OrderSummary.tsx` | COMPLETE | Order review |
| FormField | `components/checkout/FormField.tsx` | COMPLETE | Reusable form field |
| **Campaign** |
| CampaignBanner | `components/campaign/CampaignBanner.tsx` | COMPLETE | Promo banner |
| CampaignBadge | `components/campaign/CampaignBadge.tsx` | COMPLETE | Discount badge |
| PriceDisplay | `components/campaign/PriceDisplay.tsx` | COMPLETE | Price with/without discount |
| **Payment** |
| PaymentSuccess | `components/payment/PaymentSuccess.tsx` | COMPLETE | Success confirmation |
| PaymentCancel | `components/payment/PaymentCancel.tsx` | COMPLETE | Cancel/retry page |

---

## 4. Backend Services

### 4.1 API Services

| Service | Path | Status | Description |
|---------|------|--------|-------------|
| orderApi | `services/orderApi.ts` | COMPLETE | Order submission with retry logic |
| campaignApi | `services/campaignApi.ts` | COMPLETE | Campaign fetching with caching |
| productApi | `services/productApi.ts` | COMPLETE | Product/pricing data |
| payfastService | `services/payfastService.ts` | COMPLETE | PayFast payment integration |

### 4.2 Backend Lambda Deployment Status

| Lambda | Repository | LLD | DEV Status | Deployed |
|--------|------------|-----|------------|----------|
| Order Lambda | `2_bbws_order_lambda` | v1.6 | ✅ DEPLOYED | 2026-01-19 |
| Campaign Lambda | `2_bbws_campaigns_lambda` | v3.0 | ✅ DEPLOYED | 2026-01-20 |
| Product Lambda | `2_bbws_product_lambda` | v4.0 | ✅ DEPLOYED | 2026-01-26 |
| Payment Lambda | `2_bbws_payment_lambda` | v5.1 | ✅ DEPLOYED | 2026-01-18 |

### 4.3 API Endpoints (DEV)

| Endpoint | Method | Service | Status |
|----------|--------|---------|--------|
| `POST /v1.0/orders` | POST | Order Lambda | ✅ DEV Live |
| `GET /v1.0/campaigns` | GET | Campaign Lambda | ✅ DEV Live |
| `GET /v1.0/campaigns/{code}` | GET | Campaign Lambda | ✅ DEV Live |
| `GET /v1.0/products` | GET | Product Lambda | ✅ DEV Live |
| `POST /v1.0/payments` | POST | Payment Lambda | ✅ DEV Live |
| `POST /v1.0/payments/webhook` | POST | Payment Lambda | ✅ DEV Live |

---

## 5. Type Definitions

### 5.1 Order Types

```typescript
interface OrderPayload {
  timestamp: string;
  product: OrderProduct;
  customerDetails: CustomerDetails;
}

interface OrderResponse {
  success: true;
  orderId: string;
  message: string;
  data?: {
    estimatedProcessingTime?: string;
    confirmationEmailSent?: boolean;
  };
}
```

### 5.2 Campaign Types

```typescript
interface Campaign {
  code: string;
  name: string;
  productId: string;
  discountPercent: number;
  listPrice: number;
  price: number;
  termsAndConditions: string;
  status: 'DRAFT' | 'ACTIVE' | 'EXPIRED';
  fromDate: string;
  toDate: string;
  isValid: boolean;
}
```

### 5.3 Product Types

```typescript
interface PricingPlan {
  id: string;        // e.g., 'PROD-001'
  name: string;      // e.g., 'Professional'
  price: string;     // Display price
  amount: number;    // Numeric amount
  period: string;    // e.g., 'per year'
  description: string;
  features: string[];
  popular: boolean;
  gradient: boolean;
}
```

---

## 6. Pricing Plans

| Product ID | Plan Name | Price | Period |
|------------|-----------|-------|--------|
| PROD-001 | Entry | R95 | per domain/year |
| PROD-002 | Basic | R1,500 | once-off + R1000/year |
| PROD-003 | Professional | R5,000 | per year |
| PROD-004 | Enterprise | R15,000 | per year |
| PROD-005 | Enterprise Plus | POA | Custom |

---

## 7. User Stories Included

| Story ID | User Story | Priority | Status |
|----------|-----------|----------|--------|
| BUY-001 | View pricing plans | P0 | COMPLETE |
| BUY-002 | See plan features comparison | P0 | COMPLETE |
| BUY-003 | View campaign discounts | P0 | COMPLETE |
| BUY-004 | Select plan for purchase | P0 | COMPLETE |
| BUY-005 | Enter customer details | P0 | COMPLETE |
| BUY-006 | Review order summary | P0 | COMPLETE |
| BUY-007 | Submit order | P0 | COMPLETE |
| BUY-008 | Complete payment via PayFast | P0 | IN PROGRESS |
| BUY-009 | View payment success confirmation | P0 | COMPLETE |
| BUY-010 | Handle payment cancellation | P0 | COMPLETE |
| BUY-011 | Receive order confirmation email | P1 | PENDING |

---

## 8. Dependencies

### Upstream Dependencies

| Dependency | Type | Status | Owner |
|------------|------|--------|-------|
| R1.0 Tenant Management API | Release | ✅ DEV DEPLOYED | API Team |
| R1.3 Subscription & Billing | Release | LLDs COMPLETE | API Team |
| PayFast Account | External | CONFIGURED | DevOps |
| Order Lambda | Backend | ✅ DEV DEPLOYED (2026-01-19) | API Team |
| Campaign Lambda | Backend | ✅ DEV DEPLOYED (2026-01-20) | API Team |
| Product Lambda | Backend | ✅ DEV DEPLOYED (2026-01-26) | API Team |
| Payment Lambda | Backend | ✅ DEV DEPLOYED (2026-01-18) | API Team |

### Downstream Dependents

| Dependent | BRS | Phase | Waiting For |
|-----------|-----|-------|-------------|
| Customer Portal | 2.2 | Phase 2 | Order confirmation integration |
| Admin Portal | 2.4 | Phase 3b | Order management dashboard |

---

## 9. Environment Configuration

### 9.1 API Configuration

```typescript
// Development
baseUrl: 'http://localhost:3000'
timeout: 10000
retries: 2

// Production
baseUrl: 'https://api.kimmyai.io'
timeout: 15000
retries: 3
```

### 9.2 Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `VITE_API_URL` | API base URL | Yes |
| `VITE_PAYFAST_MERCHANT_ID` | PayFast merchant ID | Yes |
| `VITE_PAYFAST_MERCHANT_KEY` | PayFast merchant key | Yes |
| `VITE_PRODUCT_API_KEY` | Product/Campaign API key | Yes |

---

## 10. Testing

### 10.1 Test Coverage

| Test Type | Path | Status |
|-----------|------|--------|
| Unit Tests | `*.test.tsx` | COMPLETE |
| Integration Tests | `test/integration/userFlows.test.tsx` | COMPLETE |
| E2E Tests | TBD | PENDING |

### 10.2 Test Files

| Component | Test File | Status |
|-----------|-----------|--------|
| App | `App.test.tsx` | COMPLETE |
| PricingPage | `PricingPage.test.tsx` | COMPLETE |
| PricingCard | `PricingCard.test.tsx` | COMPLETE |
| PricingFeature | `PricingFeature.test.tsx` | COMPLETE |
| CheckoutPage | `CheckoutPage.test.tsx` | COMPLETE |
| CustomerForm | `CustomerForm.test.tsx` | COMPLETE |
| OrderSummary | `OrderSummary.test.tsx` | COMPLETE |
| FormField | `FormField.test.tsx` | COMPLETE |
| Navigation | `Navigation.test.tsx` | COMPLETE |
| PageLayout | `PageLayout.test.tsx` | COMPLETE |

---

## 11. Deliverables Checklist

| # | Deliverable | Status | Verified By | Date |
|---|-------------|--------|-------------|------|
| 1 | Frontend components | ✅ COMPLETE | ___ | ___ |
| 2 | API service integrations | ✅ COMPLETE | ___ | ___ |
| 3 | Type definitions | ✅ COMPLETE | ___ | ___ |
| 4 | Unit tests (>80% coverage) | ✅ COMPLETE | ___ | ___ |
| 5 | Integration tests | ✅ COMPLETE | ___ | ___ |
| 6 | Order API Lambda | ✅ DEV DEPLOYED | CI/CD | 2026-01-19 |
| 7 | Campaign API Lambda | ✅ DEV DEPLOYED | CI/CD | 2026-01-20 |
| 8 | Product API Lambda | ✅ DEV DEPLOYED | CI/CD | 2026-01-26 |
| 9 | Payment API Lambda | ✅ DEV DEPLOYED | CI/CD | 2026-01-18 |
| 10 | Frontend DEV deployment | PENDING | ___ | ___ |
| 11 | E2E Integration Testing | PENDING | ___ | ___ |
| 12 | SIT environment deployment | PENDING | ___ | ___ |

---

## 12. Definition of Done

| # | Criteria | Status |
|---|----------|--------|
| 1 | All frontend components implemented | ✅ COMPLETE |
| 2 | All unit tests passing | ✅ COMPLETE |
| 3 | Integration tests passing | ✅ COMPLETE |
| 4 | Order API deployed to DEV | ✅ COMPLETE (2026-01-19) |
| 5 | Campaign API deployed to DEV | ✅ COMPLETE (2026-01-20) |
| 6 | Product API deployed to DEV | ✅ COMPLETE (2026-01-26) |
| 7 | Payment API deployed to DEV | ✅ COMPLETE (2026-01-18) |
| 8 | Frontend deployed to DEV | PENDING |
| 9 | E2E user journey tested | PENDING |
| 10 | SIT environment deployment | PENDING |
| 11 | UAT completed with sign-off | PENDING |

---

## 13. Risk Register

| Risk | Impact | Likelihood | Mitigation | Status |
|------|--------|------------|------------|--------|
| PayFast integration delays | High | Medium | Mock service for development | Payment Lambda deployed |
| Campaign API not ready | Medium | Low | Mock data fallback implemented | ✅ MITIGATED - DEV deployed |
| Order API latency | Medium | Low | Retry logic with exponential backoff | ✅ MITIGATED - DEV deployed |
| Product API not ready | Medium | Low | Hardcoded data in frontend | ✅ MITIGATED - DEV deployed |
| Frontend-Backend integration | Medium | Medium | E2E testing required | ACTIVE |

---

## 14. Sign-Off

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Product Owner | | | |
| Tech Lead | | | |
| QA Lead | | | |
| Business Owner | | | |

---

*This release plan covers the Buy User Journey for the BBWS Platform public website.*
